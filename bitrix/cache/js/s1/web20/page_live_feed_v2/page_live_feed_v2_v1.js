
; /* Start:"a:4:{s:4:"full";s:63:"/bitrix/components/bitrix/desktop/script.min.js?169761435611184";s:6:"source";s:43:"/bitrix/components/bitrix/desktop/script.js";s:3:"min";s:47:"/bitrix/components/bitrix/desktop/script.min.js";s:3:"map";s:47:"/bitrix/components/bitrix/desktop/script.map.js";}"*/
var allGagdgetHolders=[];function getGadgetHolder(e){return allGagdgetHolders[e]}function BXGadget(gadgetHolderID,allGadgets){var _this=this;BX.addCustomEvent("onAjaxFailure",(function(e){if(e=="auth"){top.location=top.location.href}}));_this.gadgetHolderID=gadgetHolderID;_this.allGadgets=allGadgets;allGagdgetHolders[_this.gadgetHolderID]=_this;_this.menuItems=[];if(!BX.Type.isUndefined(window.arGDGroups)){for(var gr_id in window.arGDGroups){if(window.arGDGroups.hasOwnProperty(gr_id)){var items=[];for(var _gid in window.arGDGroups[gr_id]["GADGETS"]){if(window.arGDGroups[gr_id]["GADGETS"].hasOwnProperty(_gid)){var gid=window.arGDGroups[gr_id]["GADGETS"][_gid];for(var i in _this.allGadgets){if(_this.allGadgets[i]["ID"].toUpperCase()==gid.toUpperCase()){_this.allGadgets[i]["ONCLICK"]="getGadgetHolder('"+_this.gadgetHolderID+"').Add('"+_this.allGadgets[i]["ID"]+"')";items[items.length]=_this.allGadgets[i];break}}}}}_this.menuItems[gr_id]={ID:gr_id,TEXT:'<div style="text-align: left;"><b>'+window.arGDGroups[gr_id]["NAME"]+"</b><br>"+window.arGDGroups[gr_id]["DESCRIPTION"]+"</div>",MENU:items}}}_this.gdList=Array();_this.gdCols=Array();_this.__GDList=function(){_this.gdList=Array();_this.gdCols=Array();var e=document.getElementById("GDHolder_"+_this.gadgetHolderID).rows[0].cells;var t,i,s,a;for(a=0;a<e.length;a++){if(e[a].id.substring(0,1)=="s"){i=Array();t=e[a].childNodes;for(s in t){if(t.hasOwnProperty(s)){if(!t[s])continue;if(t[s].tagName&&(t[s].tagName.toUpperCase()=="TABLE"||t[s].tagName.toUpperCase()=="DIV")&&t[s].id.substring(0,1)=="t"){i[i.length]=t[s]}}}_this.gdList[_this.gdCols.length]=i;e[a].realPos=jsUtils.GetRealPos(e[a]);_this.gdCols[_this.gdCols.length]=e[a]}}};_this.gdDrag=false;_this.mousePos={x:0,y:0};_this.zind=0;_this.tmpDiv=false;_this.DragStart=function(e,t){if(t){if(t.srcElement&&t.srcElement.tagName.toLowerCase()=="a")return false;if(t.originalTarget&&t.originalTarget.tagName.toLowerCase()=="a")return false}_this.__GDList();var i=BX("t"+e);var s=jsUtils.GetRealPos(i);var a=BX("d"+e);a.style.display="block";a.width=i.offsetWidth+"px";a.style.height=i.offsetHeight+"px";i.style.position="absolute";i.style.width=a.offsetWidth+"px";i.style.height=a.offsetHeight+"px";i.style.border="1px solid #777777";_this.zind=i.style.zIndex;i.style.zIndex="10000";i.style.left=s["left"]+20+"px";i.style.top=s["top"]+"px";i.style.MozOpacity=.6;i.style.opacity=.6;i.style.filter="gray() alpha(opacity=60)";_this.gdDrag=e;_this.tmpDiv=document.createElement("DIV");_this.tmpDiv.style.display="none";_this.tmpDiv.innerHTML="";i.parentNode.insertBefore(_this.tmpDiv,i);document.body.appendChild(i);BX.ZIndexManager.register(i);_this.mousePos.x=t.clientX+document.body.scrollLeft;_this.mousePos.y=t.clientY+document.body.scrollTop;return false};_this.onMouseMove=function(e){if(_this.gdDrag===false)return;var t=document.getElementById("t"+_this.gdDrag);var i=e.clientX+document.body.scrollLeft;var s=e.clientY+document.body.scrollTop;t.style.left=parseInt(t.style.left)+i-_this.mousePos.x+"px";t.style.top=parseInt(t.style.top)+s-_this.mousePos.y+"px";var a=jsUtils.GetRealPos(t),d,r,n,o=false,l;var g=a.left+(a.right-a.left)/2,p=a.top+(a.bottom-a.top)/2;for(r=0;r<_this.gdCols.length;r++){d=_this.gdCols[r].realPos;if(d.left<=g&&d.right>=g){for(n in _this.gdList[r]){if(_this.gdList[r].hasOwnProperty(n)){if(_this.gdList[r][n].id==t.id)l=jsUtils.GetRealPos(document.getElementById("d"+_this.gdDrag));else l=jsUtils.GetRealPos(_this.gdList[r][n]);if(p<l.bottom){o=_this.gdList[r][n];_this.tmpDiv=document.createElement("DIV");_this.tmpDiv.style.display="none";_this.tmpDiv.innerHTML="";if(_this.gdList[r][n].id==t.id)document.getElementById("d"+_this.gdDrag).parentNode.insertBefore(_this.tmpDiv,document.getElementById("d"+_this.gdDrag));else o.parentNode.insertBefore(_this.tmpDiv,o);break}}}if(!o){o="last"}break}}if(o){var h=document.getElementById("d"+_this.gdDrag);h.parentNode.removeChild(h);if(o=="last")_this.gdCols[r].appendChild(h);else _this.tmpDiv.parentNode.insertBefore(h,_this.tmpDiv)}_this.mousePos.x=i;_this.mousePos.y=s};_this.onMouseUp=function(e){if(_this.gdDrag===false)return;var t=BX("t"+_this.gdDrag);t.style.MozOpacity=1;t.style.opacity=1;t.style.filter="";t.style.position="static";t.style.border="0px";t.style.width="";t.style.height="";t.style.zIndex=_this.zind;var i=BX("d"+_this.gdDrag);i.style.display="none";BX.ZIndexManager.unregister(t);t.parentNode.removeChild(t);i.parentNode.insertBefore(t,i);_this.gdDrag=false;if(!_this.sendWait){_this.sendWait=true;setTimeout("getGadgetHolder('"+_this.gadgetHolderID+"').SendUpdatedInfo();",1e3)}};_this.GetPosString=function(){var e=document.getElementById("GDHolder_"+_this.gadgetHolderID).rows[0].cells;var t,i,s;var a="",d=-1,r=0;for(s=0;s<e.length;s++){if(e[s].id.substring(0,1)=="s"){d++;r=0;t=e[s].childNodes;for(i in t){if(t.hasOwnProperty(i)){if(!t[i])continue;if(t[i].tagName&&(t[i].tagName.toUpperCase()=="TABLE"||t[i].tagName.toUpperCase()=="DIV")&&t[i].id.substring(0,1)=="t"){a=a+"&POS["+d+"]["+r+"]="+encodeURIComponent(t[i].id.substring(1))+(t[i].className.indexOf(" gdhided")>0?"*H":"");r++}}}}}return a};_this.GetPos=function(){var e=document.getElementById("GDHolder_"+_this.gadgetHolderID).rows[0].cells;var t,i,s;var a=[],d=-1,r=0;for(s=0;s<e.length;s++){if(e[s].id.substring(0,1)=="s"){d++;r=0;t=e[s].childNodes;for(i in t){if(t.hasOwnProperty(i)){if(!t[i])continue;if(t[i].tagName&&(t[i].tagName.toUpperCase()=="TABLE"||t[i].tagName.toUpperCase()=="DIV")&&t[i].id.substring(0,1)=="t"){if(typeof a[d]=="undefined"){a[d]=[]}a[d][r]=t[i].id.substring(1)+(t[i].className.indexOf(" gdhided")>0?"*H":"");r++}}}}}return a};_this.SendUpdatedInfo=function(e){e=e||"update_position";if(!!_this.sendUpdate||_this.gdDrag!==false){setTimeout("getGadgetHolder('"+_this.gadgetHolderID+"').SendUpdatedInfo('"+e+"');",500);return}_this.sendUpdate=true;_this.sendWait=false;BX.ajax({url:updateURL,method:"POST",dataType:"html",data:{sessid:BX.bitrix_sessid(),gd_ajax:_this.gadgetHolderID,gd_ajax_action:e,POS:_this.GetPos()},onsuccess:function(t){_this.sendUpdate=false;if(e=="clear_settings"){window.location=window.location}},onfailure:function(e){_this.sendUpdate=false;alert(langGDError1)}})};_this.Add=function(e){var t=document.getElementById("GDHolderForm_"+_this.gadgetHolderID);t["gid"].value=e;t["action"].value="add";t.submit()};_this.UpdSettings=function(e){var t=document.getElementById("GDHolderForm_"+_this.gadgetHolderID);t["gid"].value=e;t["action"].value="update";function i(e,i){var s;if(typeof i=="object"||i instanceof Array){for(var a in i){if(i.hasOwnProperty(a)){s=document.createElement("INPUT");s.type="hidden";s.name="settings["+e+"][]";s.value=i[a];t.appendChild(s)}}}else{s=document.createElement("INPUT");s.type="hidden";s.name="settings["+e+"]";s.value=i;t.appendChild(s)}}var s=document.getElementById("dset"+e);var a,d="";for(var r=0;r<s._inputs.length;r++){a=document.getElementById(e+"_"+s._inputs[r]);if(a){if(a.tagName.toUpperCase()=="SELECT"&&a.multiple){var n=[];for(var o=0;o<a.options.length;o++)if(a.options[o].selected)n.push(a.options[o].value);i(s._inputs[r],n)}else if(a.tagName.toUpperCase()=="INPUT"&&a.type.toUpperCase()=="CHECKBOX")i(s._inputs[r],a.checked?"Y":"N");else i(s._inputs[r],a.value)}}t.submit()};_this.SetForAll=function(){langGDConfirm=langGDConfirm1;if(arguments[0]){if(arguments[0]=="SU")langGDConfirm=langGDConfirmUser;if(arguments[0]=="SG")langGDConfirm=langGDConfirmGroup}if(!confirm(langGDConfirm))return;_this.SendUpdatedInfo("save_default")};_this.ClearUserSettings=function(){_this.SendUpdatedInfo("clear_settings")};_this.ClearUserSettingsConfirm=function(){if(!confirm(langGDClearConfirm))return;_this.SendUpdatedInfo("clear_settings")};_this.Delete=function(e){var t=document.getElementById("t"+e);if(t)t.parentNode.removeChild(t);var i=document.getElementById("d"+e);if(i)i.parentNode.removeChild(i);if(!_this.sendWait){_this.sendWait=true;setTimeout("getGadgetHolder('"+_this.gadgetHolderID+"').SendUpdatedInfo();",500)}return false};_this.Hide=function(e,t){var i=document.getElementById("t"+e);if(!i)return;if(i.className.indexOf(" gdhided")>0)i.className="data-table-gadget";else i.className="data-table-gadget gdhided";if(!_this.sendWait){_this.sendWait=true;setTimeout("getGadgetHolder('"+_this.gadgetHolderID+"').SendUpdatedInfo();",500)}return false};_this.CloseSettingsForm=function(e){var t=document.getElementById("dset"+e);t.style.display="none"};BXGadget.prototype.ShowSettings=function(id,t){var dS=document.getElementById("dset"+id);var is_selected="";t=t||"get_settings";_this=this;if(dS.style.display!="none"){dS.style.display="none";return}BX.ajax({url:updateURL,method:"POST",dataType:"html",data:{sessid:BX.bitrix_sessid(),gd_ajax:_this.gadgetHolderID,gid:id,gd_ajax_action:t},onsuccess:function(data){var before=(new Date).getTime();var dSet=document.getElementById("dset"+id);dSet.innerHTML="";dSet._inputs=[];try{eval("var gdObject = "+data)}catch(e){return}var param,param_id;var oEl;for(param_id in gdObject){if(gdObject.hasOwnProperty(param_id)){param=gdObject[param_id];var str="";var input_id=id+"_"+param_id;param["TYPE"]=param["TYPE"]||"STRING";if(!param["VALUE"]&&param["DEFAULT"]!="undefined")param["VALUE"]=param["DEFAULT"];if(param["TYPE"]=="STRING"){str=param["NAME"]+':<br><input type="text" id="'+input_id+'" size="40" value="'+jsUtils.htmlspecialchars(param["VALUE"])+'"><br>'}else if(param["TYPE"]=="LIST"){var aR=[];for(var vid in param["VALUES"]){if(param["VALUES"].hasOwnProperty(vid)){if(param["MULTIPLE"]=="Y"){is_selected="";if(param["VALUE"]instanceof Array){for(var k=0;k<param["VALUE"].length;k++){if(param["VALUE"][k]==vid){is_selected=" selected";break}}}else is_selected=param["VALUE"]==vid?" selected":""}else is_selected=param["VALUE"]==vid?" selected":"";aR.push('<option value="'+vid+'" '+is_selected+">"+param["VALUES"][vid]+"</option>")}}str=param["NAME"]+':<br><select style="width:100%" id="'+input_id+'" '+(param["MULTIPLE"]=="Y"?'multiple="multiple"':"")+">"+aR.join("")+"</select>"}else if(param["TYPE"]=="CHECKBOX"){str=param["NAME"]+': <input type="checkbox" id="'+input_id+'" value="Y" '+(param["VALUE"]=="Y"?" checked":"")+"><br>"}oEl=document.createElement("DIV");oEl.className="gdsettrow";oEl.innerHTML=str;dSet.appendChild(oEl);dSet._inputs[dSet._inputs.length]=param_id}}oEl=document.createElement("DIV");oEl.className="gdsettrow";oEl.innerHTML='<input type="button" value="OK" onclick="getGadgetHolder(\''+_this.gadgetHolderID+"').UpdSettings('"+id+'\');"> <input type="button" value="'+langGDCancel+'" onclick="getGadgetHolder(\''+_this.gadgetHolderID+"').CloseSettingsForm('"+id+"');\">";dSet.appendChild(oEl);dSet.style.display="block"},onfailure:function(e){alert(langGDError2)}});return false};BXGadget.prototype.ShowAddGDMenu=function(e){this.menu=new PopupMenu("gadgets_float_menu");this.menu.Create(1e3);if(this.menu.IsVisible())return;this.menu.SetItems(this.menuItems);this.menu.BuildItems();var t=jsUtils.GetRealPos(e);t["bottom"]+=1;this.menu.PopupShow(t)};jsUtils.addEvent(document.body,"mousemove",_this.onMouseMove);jsUtils.addEvent(document.body,"mouseup",_this.onMouseUp)}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?16976176062527";s:6:"source";s:78:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
var waitDiv = null;
var waitPopup = null;
var waitTimeout = null;
var waitTime = 500;

function __SASSetAdmin()
{
	__SASShowWait();
	BX.ajax({
		url: '/bitrix/components/bitrix/socialnetwork.admin.set/ajax.php',
		method: 'POST',
		dataType: 'json',
		data: {'ACTION': 'SET', 'sessid': BX.bitrix_sessid(), 'site': BX.util.urlencode(BX.message('SASSiteId'))},
		onsuccess: function(data) { __SASProcessAJAXResponse(data); }
	});
}

function __SASProcessAJAXResponse(data)
{
	if (data["SUCCESS"] != "undefined" && data["SUCCESS"] == "Y")
	{
		BX.reload();
		return false;
	}
	else if (data["ERROR"] != "undefined" && data["ERROR"].length > 0)
	{
		if (data["ERROR"].indexOf("SESSION_ERROR", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorSessionWrong'));
			BX.reload();
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_ADMIN", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorNotAdmin'));
			return false;
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_AUTH", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorCurrentUserNotAuthorized'));
			return false;
		}
		else if (data["ERROR"].indexOf("SONET_MODULE_NOT_INSTALLED", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorModuleNotInstalled'));
			return false;
		}
		else
		{
			__SASShowError(data["ERROR"]);
			return false;		
		}
	}
}
				
function __SASShowError(errorText) 
{
	__SASCloseWait();

	var errorPopup = new BX.PopupWindow('sas-error' + Math.random(), window, {
		autoHide: true,
		lightShadow: false,
		zIndex: 2,
		content: BX.create('DIV', {props: {'className': 'sonet-adminset-error-text-block'}, html: errorText}),
		closeByEsc: true,
		closeIcon: true
	});
	errorPopup.show();

}

function __SASShowWait(timeout)
{
	if (timeout !== 0)
	{
		return (waitTimeout = setTimeout(function(){
			__SASShowWait(0)
		}, 50));
	}

	if (!waitPopup)
	{
		waitPopup = new BX.PopupWindow('sas_wait', window, {
			autoHide: true,
			lightShadow: true,
			zIndex: 2,
			content: BX.create('DIV', {
				props: {
					className: 'sonet-adminset-wait-cont'
				},
				children: [
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-icon'
						}
					}),
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-text'
						},
						html: BX.message('SASWaitTitle')
					})
				]
			})
		});
	}
	else
		waitPopup.setBindElement(window);

	waitPopup.show();
}

function __SASCloseWait()
{
	if (waitTimeout)
	{
		clearTimeout(waitTimeout);
		waitTimeout = null;
	}

	if (waitPopup)
		waitPopup.close();
}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/socialnetwork.log.ex/templates/.default/script.min.js?16976176072044";s:6:"source";s:75:"/bitrix/components/bitrix/socialnetwork.log.ex/templates/.default/script.js";s:3:"min";s:79:"/bitrix/components/bitrix/socialnetwork.log.ex/templates/.default/script.min.js";s:3:"map";s:79:"/bitrix/components/bitrix/socialnetwork.log.ex/templates/.default/script.map.js";}"*/
function __logGetNextPageLinkEntities(e,i){if(!!window.__logGetNextPageFormName&&!!e&&!!i&&!!window["UC"]&&!!window["UC"][window.__logGetNextPageFormName]&&!!window["UC"][window.__logGetNextPageFormName].linkEntity){window["UC"][window.__logGetNextPageFormName].linkEntity(e);for(var t in i){if(!!t&&i.hasOwnProperty(t)&&!!i[t]){window["UC"][window.__logGetNextPageFormName].entitiesCorrespondence[t]=i[t]}}}}function __logChangeFavorites(e,i,t,n,o){BX.Livefeed.FeedInstance.changeFavorites({logId:e,node:i,newState:t,fromMenu:!!n,event:o})}BitrixLF=function(){this.cmdPressed=null;this.tagEntryIdList=[];this.inlineTagNodeList=[];if(window.top!==window&&window.top.BX.Tasks&&window.BX.Tasks&&window.BX.Tasks.CommentActionController){window.top.BX.Tasks.CommentActionController=window.BX.Tasks.CommentActionController}if(BX.Tasks&&BX.Tasks.CommentActionController){void BX.Tasks.CommentActionController.init()}};BitrixLF.prototype.init=function(e){this.cmdPressed=false;if(BX.Livefeed&&BX.Livefeed.InformerInstance){BX.Livefeed.InformerInstance.lockCounterAnimation=false}BX.addCustomEvent("onFrameDataProcessed",(function(){if(BX.Livefeed&&BX.Livefeed.InformerInstance){BX.Livefeed.InformerInstance.lockCounterAnimation=false}}));if(BX.Livefeed&&BX.Livefeed.PageInstance){BX.Livefeed.PageInstance.init();if(BX.type.isPlainObject(e)){BX.Livefeed.PageInstance.firstPageLastTS=!BX.type.isUndefined(e.firstPageLastTS)?e.firstPageLastTS:0;BX.Livefeed.PageInstance.firstPageLastId=!BX.type.isUndefined(e.firstPageLastId)?e.firstPageLastId:0;BX.Livefeed.PageInstance.useBXMainFilter=!BX.type.isUndefined(e.useBXMainFilter)?e.useBXMainFilter:"N";if(BX.type.isNotEmptyString(e.blogCommentFormUID)){BX.Livefeed.PageInstance.blogCommentFormUID=e.blogCommentFormUID}}}};BitrixLF.prototype.LazyLoadCheckVisibility=function(e){return BX.Livefeed.MoreButton.lazyLoadCheckVisibility(e)};BitrixLF.prototype.createTask=function(e){BX.Livefeed.TaskCreator.create(e)};if(typeof oLF=="undefined"){oLF=new BitrixLF;window.oLF=oLF}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:98:"/bitrix/components/bitrix/socialnetwork.log.entry/templates/.default/scripts.min.js?16976176069164";s:6:"source";s:79:"/bitrix/components/bitrix/socialnetwork.log.entry/templates/.default/scripts.js";s:3:"min";s:83:"/bitrix/components/bitrix/socialnetwork.log.entry/templates/.default/scripts.min.js";s:3:"map";s:83:"/bitrix/components/bitrix/socialnetwork.log.entry/templates/.default/scripts.map.js";}"*/
window["__logCommentsListRedefine"]=function(e,t,n,a){if(window["UC"]&&!!window["UC"][e]){BX.addCustomEvent(window["UC"][e],"OnUCListWasBuilt",function(t,n,s){if(BX(s)&&s.hasChildNodes){var i=s.firstChild,o;do{if(BX(i)&&i["getAttribute"]){o=i.getAttribute("id").replace("record-"+e+"-","").replace("-cover","");BX.onCustomEvent(window,"OnUCAddEntitiesCorrespondence",[e+"-"+o,[a,top["arLogCom"+a+o]]])}}while(i=i.nextSibling)}})}if(!!window.mplCheckForQuote)BX.bind(BX(t),"mouseup",function(t){mplCheckForQuote(t,this,e,n)})};window["__logBuildRating"]=function(e,t,n){var a="";n=!!n?n:Math.floor(Math.random()*1e5)+1;if(BX.message("sonetLShowRating")=="Y"&&!!e["RATING_TYPE_ID"]>0&&e["RATING_ENTITY_ID"]>0&&(BX.message("sonetLRatingType")=="like"&&!!window["RatingLike"]||BX.message("sonetLRatingType")=="standart_text"&&!!window["Rating"])){if(BX.message("sonetLRatingType")=="like"){var s=e["RATING_USER_VOTE_VALUE"]>0?" bx-you-like":"",i=e["RATING_USER_VOTE_VALUE"]>0?BX.message("sonetLTextLikeN"):BX.message("sonetLTextLikeY"),o=null;if(!!t["ALLOW_VOTE"]&&!!t["ALLOW_VOTE"]["RESULT"])o=BX.create("span",{props:{className:"bx-ilike-text"},html:i});a=BX.create("span",{attrs:{id:"sonet-rating-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n},props:{className:"sonet-log-comment-like rating_vote_text"},children:[BX.create("span",{props:{className:"ilike-light"},children:[BX.create("span",{props:{id:"bx-ilike-button-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n,className:"bx-ilike-button"},children:[BX.create("span",{props:{className:"bx-ilike-right-wrap"+s},children:[BX.create("span",{props:{className:"bx-ilike-right"},html:e["RATING_TOTAL_POSITIVE_VOTES"]})]}),BX.create("span",{props:{className:"bx-ilike-left-wrap"},children:[o]})]}),BX.create("span",{props:{id:"bx-ilike-popup-cont-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n,className:"bx-ilike-wrap-block"},style:{display:"none"},children:[BX.create("span",{props:{className:"bx-ilike-popup"},children:[BX.create("span",{props:{className:"bx-ilike-wait"}})]})]})]})]})}else if(BX.message("sonetLRatingType")=="standart_text"){a=BX.create("span",{attrs:{id:"sonet-rating-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n},props:{className:"sonet-log-comment-like rating_vote_text"},children:[BX.create("span",{props:{className:"bx-rating"+(!t["ALLOW_VOTE"]["RESULT"]?" bx-rating-disabled":"")+(e["RATING_USER_VOTE_VALUE"]!=0?" bx-rating-active":""),id:"bx-rating-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n,title:!t["ALLOW_VOTE"]["RESULT"]?t["ERROR_MSG"]:""},children:[BX.create("span",{props:{className:"bx-rating-absolute"},children:[BX.create("span",{props:{className:"bx-rating-question"},html:!t["ALLOW_VOTE"]["RESULT"]?BX.message("sonetLTextDenied"):BX.message("sonetLTextAvailable")}),BX.create("span",{props:{className:"bx-rating-yes "+(e["RATING_USER_VOTE_VALUE"]>0?"  bx-rating-yes-active":""),title:e["RATING_USER_VOTE_VALUE"]>0?BX.message("sonetLTextCancel"):BX.message("sonetLTextPlus")},children:[BX.create("a",{props:{className:"bx-rating-yes-count",href:"#like"},html:""+parseInt(e["RATING_TOTAL_POSITIVE_VOTES"])}),BX.create("a",{props:{className:"bx-rating-yes-text",href:"#like"},html:BX.message("sonetLTextRatingY")})]}),BX.create("span",{props:{className:"bx-rating-separator"},html:"/"}),BX.create("span",{props:{className:"bx-rating-no "+(e["RATING_USER_VOTE_VALUE"]<0?"  bx-rating-no-active":""),title:e["RATING_USER_VOTE_VALUE"]<0?BX.message("sonetLTextCancel"):BX.message("sonetLTextMinus")},children:[BX.create("a",{props:{className:"bx-rating-no-count",href:"#dislike"},html:""+parseInt(e["RATING_TOTAL_NEGATIVE_VOTES"])}),BX.create("a",{props:{className:"bx-rating-no-text",href:"#dislike"},html:BX.message("sonetLTextRatingN")})]})]})]}),BX.create("span",{props:{id:"bx-rating-popup-cont-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n+"-plus"},style:{display:"none"},children:[BX.create("span",{props:{className:"bx-ilike-popup  bx-rating-popup"},children:[BX.create("span",{props:{className:"bx-ilike-wait"}})]})]}),BX.create("span",{props:{id:"bx-rating-popup-cont-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n+"-minus"},style:{display:"none"},children:[BX.create("span",{props:{className:"bx-ilike-popup  bx-rating-popup"},children:[BX.create("span",{props:{className:"bx-ilike-wait"}})]})]})]})}}if(!!a){a=BX.create("span",{children:[a]});a=a.innerHTML+'<script>window["#OBJ#"].Set("#ID#", "#RATING_TYPE_ID#", #RATING_ENTITY_ID#, "#ALLOW_VOTE#", BX.message("sonetLCurrentUserID"), #TEMPLATE#, "light", BX.message("sonetLPathToUser"));<\/script>'.replace("#OBJ#",BX.message("sonetLRatingType")=="like"?"RatingLike":"Rating").replace("#ID#",e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n).replace("#RATING_TYPE_ID#",e["RATING_TYPE_ID"]).replace("#RATING_ENTITY_ID#",e["RATING_ENTITY_ID"]).replace("#ALLOW_VOTE#",!!t["ALLOW_VOTE"]&&!!t["ALLOW_VOTE"]["RESULT"]?"Y":"N").replace("#TEMPLATE#",BX.message("sonetLRatingType")=="like"?'{LIKE_Y:BX.message("sonetLTextLikeN"),LIKE_N:BX.message("sonetLTextLikeY"),LIKE_D:BX.message("sonetLTextLikeD")}':'{PLUS:BX.message("sonetLTextPlus"),MINUS:BX.message("sonetLTextMinus"),CANCEL:BX.message("sonetLTextCancel")}')}return a};window["__logShowCommentForm"]=function(e){if(!!window["UC"][e])window["UC"][e].reply()};function __logShowHiddenDestination(e,t,n){BX.ajax.runAction("socialnetwork.api.livefeed.logentry.getHiddenDestinations",{data:{params:{logId:e,createdById:t,pathToUser:BX.message("sonetLPathToUser"),pathToWorkgroup:BX.message("sonetLPathToGroup"),pathToDepartment:BX.message("sonetLPathToDepartment"),nameTemplate:BX.message("sonetLNameTemplate"),showLogin:BX.message("sonetLShowLogin"),destinationLimit:BX.message("sonetLDestinationLimit")}}}).then(function(e){var t=e.data.destinationList;if(!BX.type.isNotEmptyObject(t)){return}if(BX(n)){var a=n.parentNode;a.removeChild(n);var s="";for(var i in t){if(!t.hasOwnProperty(i)){continue}if(BX.type.isNotEmptyString(t[i]["TITLE"])){a.appendChild(BX.create("SPAN",{html:", "}));if(BX.type.isNotEmptyString(t[i]["CRM_PREFIX"])){a.appendChild(BX.create("SPAN",{props:{className:"feed-add-post-destination-prefix"},html:t[i]["CRM_PREFIX"]+":&nbsp;"}))}if(BX.type.isNotEmptyString(t[i]["URL"])){a.appendChild(BX.create("A",{props:{className:"feed-add-post-destination-new"+(BX.type.isNotEmptyString(t[i]["IS_EXTRANET"])&&t[i]["IS_EXTRANET"]=="Y"?" feed-post-user-name-extranet":""),href:t[i]["URL"]},html:t[i]["TITLE"]}))}else{a.appendChild(BX.create("SPAN",{props:{className:"feed-add-post-destination-new"+(BX.type.isNotEmptyString(t[i]["IS_EXTRANET"])&&t[i]["IS_EXTRANET"]=="Y"?" feed-post-user-name-extranet":"")},html:t[i]["TITLE"]}))}}}if(typeof e.data["hiddenDestinationsCount"]!="undefined"&&parseInt(e.data["hiddenDestinationsCount"])>0){e.data["hiddenDestinationsCount"]=parseInt(e.data["hiddenDestinationsCount"]);var o=e.data["hiddenDestinationsCount"]%100>10&&e.data["hiddenDestinationsCount"]%100<20?5:e.data["hiddenDestinationsCount"]%10;a.appendChild(BX.create("SPAN",{html:"&nbsp;"+BX.message("sonetLDestinationHidden"+o).replace("#COUNT#",e.data["hiddenDestinationsCount"])}))}}},function(e){})}function __logSetFollow(e){return BX.Livefeed.FeedInstance.changeFollow({logId:e})}function __logRefreshEntry(e){var t=e.node!==undefined?BX(e.node):false;var n=e.logId!==undefined?parseInt(e.logId):0;if(!t||n<=0||BX.message("sonetLEPath")===undefined){return}BX.ajax({url:BX.message("sonetLEPath").replace("#log_id#",n),method:"POST",dataType:"json",data:{log_id:n,action:"get_entry"},onsuccess:function(e){if(e["ENTRY_HTML"]!==undefined){BX.cleanNode(t);t.innerHTML=e["ENTRY_HTML"];var n=BX.processHTML(t.innerHTML,true);var a=n.SCRIPT;BX.ajax.processScripts(a,true)}},onfailure:function(e){}});return false}window.__logEditComment=function(e,t,n){BX.ajax.runAction("socialnetwork.api.livefeed.comment.getsource",{data:{params:{postId:n,commentId:t}}}).then(function(t){var a=t.data;var s={messageBBCode:a.message,messageFields:{arFiles:BX.type.isNotEmptyObject(a.UF.UF_SONET_COM_FILE)?a.UF.UF_SONET_COM_FILE.VALUE:[]}};if(BX.type.isNotEmptyObject(a.UF.UF_SONET_COM_DOC)&&BX.type.isNotEmptyString(a.UF.UF_SONET_COM_DOC.USER_TYPE_ID)){if(a.UF.UF_SONET_COM_DOC.USER_TYPE_ID=="webdav_element"){s.messageFields.arDocs=a.UF.UF_SONET_COM_DOC.VALUE}else if(a.UF.UF_SONET_COM_DOC.USER_TYPE_ID=="disk_file"){s.messageFields.arDFiles=a.UF.UF_SONET_COM_DOC.VALUE}}window.UC[window.SLEC.formKey].entitiesCorrespondence[e+"-"+a.sourceId]=[n,a.id];BX.onCustomEvent(window,"OnUCAfterRecordEdit",[e,a.sourceId,s,"EDIT"])},function(){})};(function(){BX.SocialnetworkLogEntry={};BX.SocialnetworkLogEntry.registerViewAreaList=function(e){if(typeof e=="undefined"||typeof e.containerId=="undefined"||typeof e.className=="undefined"){return}if(BX(e.containerId)){var t=BX.findChildren(BX(e.containerId),{tag:"div",className:e.className},true),n=null;for(var a=0,s=t.length;a<s;a++){if(t[a].id.length>0){n=null;if(BX.type.isNotEmptyString(e.fullContentClassName)){n=BX.findChild(t[a],{className:e.fullContentClassName})}BX.UserContentView.registerViewArea(t[a].id,n?n:null)}}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:103:"/bitrix/components/bitrix/socialnetwork.blog.post.edit/templates/.default/script.min.js?169761760650105";s:6:"source";s:83:"/bitrix/components/bitrix/socialnetwork.blog.post.edit/templates/.default/script.js";s:3:"min";s:87:"/bitrix/components/bitrix/socialnetwork.blog.post.edit/templates/.default/script.min.js";s:3:"map";s:87:"/bitrix/components/bitrix/socialnetwork.blog.post.edit/templates/.default/script.map.js";}"*/
this.BX=this.BX||{};this.BX.Socialnetwork=this.BX.Socialnetwork||{};(function(e,t,i,s,o,n){"use strict";var a=function(){function e(){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"htmlWasInserted",false);babelHelpers.defineProperty(this,"scriptsLoaded",false)}babelHelpers.createClass(e,[{key:"processCSS",value:function e(t,i){if(o.Type.isArray(t.CSS)&&t.CSS.length>0){BX.load(t.CSS,i)}else{i()}}},{key:"processExternalJS",value:function e(t,i){if(o.Type.isArray(t.JS)&&t.JS.length>0){BX.load(t.JS,i)}else{i()}}},{key:"processAjaxBlockInsertHTML",value:function e(t,i,s){i.appendChild(BX.create("DIV",{html:t.CONTENT}));this.htmlWasInserted=true;if(this.scriptsLoaded){this.processInlineJS(t,s)}}},{key:"processInlineJS",value:function e(t,i){this.scriptsLoaded=true;if(this.htmlWasInserted){BX.ajax.processRequestData(t.CONTENT,{scriptsRunFirst:false,dataType:"HTML"});i()}}}]);return e}();var r=function(){babelHelpers.createClass(e,null,[{key:"setInstance",value:function t(i){e.instance=i}},{key:"getInstance",value:function t(){return e.instance}}]);function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"lazyLoad",null);babelHelpers.defineProperty(this,"ajaxUrl","");babelHelpers.defineProperty(this,"inited",false);babelHelpers.defineProperty(this,"loaded",false);babelHelpers.defineProperty(this,"container",null);babelHelpers.defineProperty(this,"containerMicro",null);babelHelpers.defineProperty(this,"containerMicroInner",null);babelHelpers.defineProperty(this,"clickDisabled",false);babelHelpers.defineProperty(this,"lastWait",[]);babelHelpers.defineProperty(this,"animationStartHeight",0);babelHelpers.defineProperty(this,"initedEditorsList",[]);babelHelpers.defineProperty(this,"options",{});this.init(t);e.setInstance(this)}babelHelpers.createClass(e,[{key:"setOption",value:function e(t,i){if(!o.Type.isStringFilled(t)){return}this.options[t]=i}},{key:"onShow",value:function e(){if(!o.Type.isStringFilled(this.options.startVideoRecorder)||this.options.startVideoRecorder!=="Y"){return}setTimeout((function(){var e=document.getElementById("divoPostFormLHE_blogPostForm");if(!e){return}n.EventEmitter.emit(e,"OnShowLHE",new n.BaseEvent({compatData:["justShow"]}));BX.VideoRecorder.start("blogPostForm","post")}),500)}},{key:"onSliderClose",value:function e(){var t=BX.SidePanel.Instance.getTopSlider();if(!t){return}BX.SidePanel.Instance.postMessageAll(window,"SidePanel.Wrapper:onClose",{sliderData:t.getData()})}},{key:"init",value:function e(t){var i=this;if(this.inited!==true){this.inited=true;this.lazyLoad=!o.Type.isUndefined(t.lazyLoad)?!!t.lazyLoad:false;this.ajaxUrl=o.Type.isStringFilled(t.ajaxUrl)?t.ajaxUrl:"";this.container=o.Type.isDomNode(t.container)?t.container:null;this.containerMicro=o.Type.isDomNode(t.containerMicro)?t.containerMicro:null;this.containerMicroInner=o.Type.isDomNode(t.containerMicroInner)?t.containerMicroInner:null;this.successPostId=!o.Type.isUndefined(t.successPostId)&&parseInt(t.successPostId)>0?parseInt(t.successPostId):0;if(this.containerMicro){this.containerMicro.setAttribute("dropzone","copy f:*/*");var s=0;var a=function e(t){if(s>0){clearTimeout(s);s=0}t.stopPropagation();t.preventDefault()};var r=function e(t){a(t);i.containerMicro.click()};var l=function e(t){if(s<=0){s=setTimeout((function(){r(t)}),3e3)}t.stopPropagation();t.preventDefault()};this.containerMicro.addEventListener("dragover",l);this.containerMicro.addEventListener("dragenter",l);this.containerMicro.addEventListener("dragleave",a);this.containerMicro.addEventListener("dragexit",a);this.containerMicro.addEventListener("drop",a)}}var d=BX.SidePanel.Instance.getTopSlider();if(d){if(this.successPostId>0){BX.SidePanel.Instance.postMessage(window,"Socialnetwork.PostForm:onAdd",{originatorSliderId:d.getData().get("sliderId"),successPostId:this.successPostId});BX.SidePanel.Instance.close()}else if(!d.getData().get("initialized")){n.EventEmitter.subscribe(d,"BX.Socialnetwork.SidePanel.Slider:onClose",this.onSliderClose);d.getData().set("initialized",true)}}}},{key:"get",value:function e(t){var i=this;if(this.clickDisabled){return}if(this.lazyLoad&&!this.loaded){this.clickDisabled=true;this.animationStartHeight=this.containerMicro.offsetHeight;if(o.Type.isStringFilled(t.loaderType)&&t.loaderType==="tab"){this.showWaitTab()}else{this.containerMicroInner.style.display="none";this.showWait(this.containerMicro)}o.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{action:"SBPE_get_full_form",sessid:o.Loc.getMessage("bitrix_sessid")},onsuccess:function e(s){i.loaded=true;i.clickDisabled=false;i.closeWait();if(s.success){i.processAjaxBlock(s.PROPS,t.callback)}},onfailure:function e(){i.clickDisabled=false;i.closeWait();i.containerMicroInner.style.display="block"}})}else if(o.Type.isFunction(t.callback)){t.callback()}}},{key:"processAjaxBlock",value:function e(t,i){var s=this;if(!t){return}var o=new a;o.processCSS(t,(function(){o.processAjaxBlockInsertHTML(t,s.container,i)}));o.processExternalJS(t,(function(){o.processInlineJS(t,i)}))}},{key:"showWait",value:function e(t){var i=this;var s=t.bxmsg=document.body.appendChild(o.Dom.create("DIV",{props:{id:"wait_".concat(t.id),className:"feed-add-post-loader-cont"},html:'<svg class="feed-add-post-loader" viewBox="25 25 50 50"><circle class="feed-add-post-loader-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"></circle><circle class="feed-add-post-loader-inner-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"></circle></svg>'}));setTimeout((function(){i.adjustWait(t)}),10);this.lastWait.push(s);return s}},{key:"showWaitTab",value:function e(){if(!BX("feed-add-post-more-icon")||!BX("feed-add-post-more-icon-waiter")){return}BX("feed-add-post-more-icon").style.display="none";BX("feed-add-post-more-icon-waiter").style.display="block"}},{key:"closeWait",value:function e(){var t=this.containerMicro.bxmsg;if(t&&t.parentNode){for(var i=0,s=this.lastWait.length;i<s;i++){if(t===this.lastWait[i]){this.lastWait=BX.util.deleteFromArray(this.lastWait,i);break}}t.parentNode.removeChild(t);if(this.containerMicro){this.containerMicro.bxmsg=null}o.Dom.clean(t);o.Dom.remove(t)}if(BX("feed-add-post-more-icon")&&BX("feed-add-post-more-icon-waiter")&&BX("feed-add-post-more-icon").style.display==="none"){BX("feed-add-post-more-icon").style.display="block";BX("feed-add-post-more-icon-waiter").style.display="none"}}},{key:"adjustWait",value:function e(t){if(!t.bxmsg){return}var i=BX.pos(t);var s=i.top+15;if(s<BX.GetDocElement().scrollTop){s=BX.GetDocElement().scrollTop+5}t.bxmsg.style.top="".concat(s+5,"px");if(t===BX.GetDocElement()){t.bxmsg.style.right="5px"}else{t.bxmsg.style.left="".concat(i.left+parseInt((i.width-t.bxmsg.offsetWidth)/2),"px")}}},{key:"tasksTaskEvent",value:function e(t){if(!o.Reflection.getClass("BX.UI.Notification.Center")){return}var i=o.Loc.getMessage("PATH_TO_USER_TASKS_TASK").replace("#user_id#",o.Loc.getMessage("USER_ID")).replace("#task_id#",t).replace("#action#","view");window.top.BX.UI.Notification.Center.notify({content:o.Loc.getMessage("BLOG_POST_EDIT_T_CREATE_TASK_SUCCESS_TITLE"),actions:[{title:o.Loc.getMessage("BLOG_POST_EDIT_T_CREATE_TASK_BUTTON_TITLE"),events:{click:function e(t,s,o){s.close();window.top.BX.SidePanel.Instance.open(i)}}}]})}}]);return e}();babelHelpers.defineProperty(r,"instance",null);var l=function(e){babelHelpers.inherits(i,e);babelHelpers.createClass(i,null,[{key:"setInstance",value:function e(t){i.instance=t}},{key:"getInstance",value:function e(){if(i.instance===null){new i}return i.instance}}]);function i(){var e;babelHelpers.classCallCheck(this,i);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"inited",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"tabs",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"bodies",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"active",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"animation",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"animationStartHeight",0);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"previousTab",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"menu",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"listsMenu",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"menuItems",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"lastWait",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"clickDisabled",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"tabContainer",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"arrow",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"config",{id:{message:"message",task:"tasks",calendar:"calendar",file:"file",gratitude:"grat",important:"important",vote:"vote",more:"more",listItem:"lists"}});e.setEventNamespace("BX.Socialnetwork.Livefeed.Post.Form.Tabs");e.init();e.emit("onInitialized",{tabsInstance:babelHelpers.assertThisInitialized(e)});i.setInstance(babelHelpers.assertThisInitialized(e));window.SBPETabs=babelHelpers.assertThisInitialized(e);return e}babelHelpers.createClass(i,[{key:"init",value:function e(){var t=this;this.tabContainer=document.getElementById("feed-add-post-form-tab");this.arrow=document.getElementById("feed-add-post-form-tab-arrow");this.tabs={};this.bodies={};var i=this.tabContainer&&this.tabContainer.querySelectorAll("span.feed-add-post-form-link");if(i){for(var s=0;s<i.length;s++){var n=i[s].getAttribute("id").replace("feed-add-post-form-tab-","");var a=i[s].getAttribute("limited");this.tabs[n]=i[s];if(this.tabs[n].style.display==="none"){this.menuItems.push({tabId:n,text:i[s].getAttribute("data-name"),className:"menu-popup-no-icon feed-add-post-form-".concat(n," feed-add-post-form-").concat(n,"-more"),onclick:this.createOnClick(n,i[s].getAttribute("data-name"),i[s].getAttribute("data-onclick"),i[s].getAttribute("data-limited")==="Y")});this.tabs[n]=this.tabs[n].parentNode}this.bodies[n]=document.getElementById("feed-add-post-content-".concat(n))}}if(!!this.tabs[this.config.id.file]){this.bodies[this.config.id.file]=[this.bodies[this.config.id.message]]}if(!!this.tabs[this.config.id.calendar]){this.bodies[this.config.id.calendar]=[this.bodies[this.config.id.calendar]]}if(!!this.tabs[this.config.id.vote]){this.bodies[this.config.id.vote]=[this.bodies[this.config.id.message],this.bodies[this.config.id.vote]]}if(!!this.tabs[this.config.id.more]){this.bodies[this.config.id.more]=null}if(!!this.tabs[this.config.id.important]){this.bodies[this.config.id.important]=[this.bodies[this.config.id.message],this.bodies[this.config.id.important]]}if(!!this.tabs[this.config.id.gratitude]){this.bodies[this.config.id.gratitude]=[this.bodies[this.config.id.message],this.bodies[this.config.id.gratitude]]}if(!!this.tabs[this.config.id.listItem]){this.bodies[this.config.id.listItem]=[this.bodies[this.config.id.listItem]]}if(!!this.tabs[this.config.id.task]){this.bodies[this.config.id.task]=[this.bodies[this.config.id.task]]}for(var r in this.bodies){if(this.bodies.hasOwnProperty(r)&&o.Type.isDomNode(this.bodies[r])){this.bodies[r]=[this.bodies[r]]}}this.inited=true;this.previousTab=false;var l=document.getElementById("bx-b-uploadfile-blogPostForm");if(l){l.setAttribute("bx-press","pressOut");o.Event.bind(l,"mousedown",(function(){l.setAttribute("bx-press",l.getAttribute("bx-press")=="pressOut"?"pressOn":"pressOut")}))}var d=document.getElementById("blogPostForm");if(!d){return}if(!d.changePostFormTab){d.appendChild(o.Dom.create("INPUT",{props:{type:"hidden",name:"changePostFormTab",value:""}}))}this.subscribe("changePostFormTab",(function(e){var i=e.getData(),s=i.type;if(s===t.config.id.more){return}d.changePostFormTab.value=s;if(d["UF_BLOG_POST_IMPRTNT"]){d["UF_BLOG_POST_IMPRTNT"].value=s===t.config.id.important?"1":"0"}}))}},{key:"createOnClick",value:function e(t,i,s,n){var a=this;return function(){var e=document.getElementById("feed-add-post-form-link-more");var r=document.getElementById("feed-add-post-form-link-text");if(!n){r.innerHTML=i;if(t!==a.config.id.listItem){e.className="feed-add-post-form-link feed-add-post-form-link-more feed-add-post-form-link-active feed-add-post-form-".concat(t,"-link");a.changePostFormTab(t,false)}else{e.className="feed-add-post-form-link feed-add-post-form-link-more feed-add-post-form-".concat(t,"-link")}}if(o.Type.isStringFilled(s)){BX.evalGlobal(s)}a.menu.popupWindow.close()}}},{key:"changePostFormTab",value:function e(t,i){if(this.clickDisabled){return false}return this.setActive(t,i)}},{key:"setActive",value:function e(t,i){var s=this;if(o.Type.isNull(t)||this.active===t&&t!==this.config.id.listItem){return this.active}else if(!this.tabs[t]){return false}var a=t!==this.config.id.task||this.isTaskTabLoaded();if(a){this.startAnimation()}for(var r in this.tabs){if(this.tabs.hasOwnProperty(r)&&r!==t){this.tabs[r].classList.remove("feed-add-post-form-link-active");if(this.bodies[r]==null||this.bodies[t]==null){continue}for(var l=0;l<this.bodies[r].length;l++){if(this.bodies[t][l]!=this.bodies[r][l]){o.Dom.adjust(this.bodies[r][l],{style:{display:"none"}})}}}}if(!!this.tabs[t]){this.active=t;var d=BX.pos(this.tabs[t],true);this.arrow.style.display="block";this.arrow.style.top="".concat(d.bottom,"px");var c=parseInt(this.arrow.style.left)||0;var u=parseInt(this.arrow.style.width)||0;new BX.easing({duration:200,start:{left:c,width:u},finish:{left:d.left,width:d.width},transition:BX.easing.makeEaseInOut(BX.easing.transitions.quart),step:function e(t){s.arrow.style.left="".concat(t.left,"px");s.arrow.style.width="".concat(t.width,"px")},complete:function e(){s.arrow.style.display="none";s.tabs[t].classList.add("feed-add-post-form-link-active")}}).animate();if(this.previousTab===this.config.id.file||t===this.config.id.file){var m=false;var f=false;var p=document.getElementById("divoPostFormLHE_blogPostForm");if(!!p&&!!p.childNodes&&p.childNodes.length>0){for(var h in p.childNodes){if(!p.childNodes.hasOwnProperty(h)){continue}if(p.childNodes[h].className==="file-selectdialog"){var b=p.childNodes[h];var g=b.querySelector(".file-placeholder-tbody");var v=b.querySelector(".feed-add-photo-block");if(g.rows>0||!!v&&v.length>1){m=true}}else if(o.Type.isStringFilled(p.childNodes[h].className)&&(p.childNodes[h].className.indexOf("wduf-selectdialog")>=0||p.childNodes[h].className.indexOf("diskuf-selectdialog")>=0)){var y=p.childNodes[h];var T=y.querySelectorAll(".wd-inline-file");f=!!T&&T.length>0}else if(o.Type.isDomNode(p.childNodes[h])&&p.childNodes[h].classList&&!p.childNodes[h].classList.contains("urlpreview")&&!p.childNodes[h].classList.contains("feed-add-post-strings-blocks")){o.Dom.adjust(p.childNodes[h],{style:{display:t===this.config.id.file?"none":""}})}}if(t===this.config.id.file){if(!!window["PlEditorblogPostForm"]&&!window["PlEditorblogPostForm"].SBPEBinded){window["PlEditorblogPostForm"].SBPEBinded=true;n.EventEmitter.subscribe(window["PlEditorblogPostForm"].eventNode,"onUploadsHasBeenChanged",(function(e){var t=e.getData()[1];if(t.dialogName==="AttachFileDialog"&&t.urlUpload.indexOf("&dropped=Y")<0){t.urlUpload=t.agent.uploadFileUrl=t.urlUpload.replace("&random_folder=Y","&dropped=Y")}document.getElementById("bx-b-uploadfile-blogPostForm").setAttribute("bx-press","pressOn");if(s.active!==s.config.id.file){s.changePostFormTab(s.config.id.message)}}))}window["PlEditorblogPostForm"].controllerInit("show");p.classList.add("feed-add-post-form","feed-add-post-edit-form","feed-add-post-edit-form-file")}else{p.classList.remove("feed-add-post-form","feed-add-post-edit-form","feed-add-post-edit-form-file");if(!m&&!f&&document.getElementById("bx-b-uploadfile-blogPostForm").getAttribute("bx-press")==="pressOut"&&!!window["PlEditorblogPostForm"]){window["PlEditorblogPostForm"].controllerInit("hide")}}}}var E=document.getElementById("divoPostFormLHE_blogPostForm");if(E&&E.style.display==="none"){n.EventEmitter.emit(E,"OnShowLHE",new n.BaseEvent({compatData:["justShow"]}))}if(t===this.config.id.listItem){n.EventEmitter.emit("onDisplayClaimLiveFeed",new n.BaseEvent({compatData:[i]}))}this.previousTab=t;if(!!this.bodies[t]){for(var I=0;I<this.bodies[t].length;I++){if(!!this.bodies[t][I]){o.Dom.adjust(this.bodies[t][I],{style:{display:"block"}})}}}}if(a){this.endAnimation()}if(t!==this.config.id.listItem){this.restoreMoreMenu()}this.emit("changePostFormTab",{type:t});return this.active}},{key:"isTaskTabLoaded",value:function e(){var t=document.getElementById("feed-add-post-content-tasks-container");return t&&t.children.length}},{key:"collapse",value:function e(){this.active=null;var t=false;var i=window!==top.window?BX.SidePanel.Instance.getSliderByWindow(window):null;if(window!==top.window){if(i&&i.url.match(/\/user\/(\d+)\/blog\/edit\//)){t=true}}if(!t){this.changePostFormTab("message");var s=r.getInstance();if(s&&o.Type.isDomNode(s.containerMicroInner)){s.containerMicroInner.style.display="block"}this.startAnimation()}var a=document.getElementById("divoPostFormLHE_blogPostForm");if(a){n.EventEmitter.emit(a,"OnShowLHE",new n.BaseEvent({compatData:[false]}))}n.EventEmitter.emit("onExtAutoSaveReset_blogPostForm",new n.BaseEvent({compatData:[]}));if(!t){this.endAnimation()}else{if(i){n.EventEmitter.emit(window.top,"SidePanel.Slider:onClose",new n.BaseEvent({compatData:[i.getEvent("onClose")]}))}BX.SidePanel.Instance.close()}}},{key:"startAnimation",value:function e(){if(this.animation){this.animation.stop()}var t=document.getElementById("microblog-form");if(!t){return}if(r.getInstance().animationStartHeight>0){this.animationStartHeight=r.getInstance().animationStartHeight;r.getInstance().animationStartHeight=0}else{this.animationStartHeight=t.parentNode.offsetHeight}t.parentNode.style.height="".concat(this.animationStartHeight,"px");t.parentNode.style.overflowY="hidden";t.parentNode.style.position="relative";t.style.opacity=0}},{key:"endAnimation",value:function e(){var t=this;var i=document.getElementById("microblog-form");if(!i){return}this.animation=new BX.easing({duration:500,start:{height:this.animationStartHeight,opacity:0},finish:{height:i.offsetHeight+i.offsetTop,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function e(t){i.parentNode.style.height="".concat(t.height,"px");i.style.opacity=t.opacity/100},complete:function e(){i.style.cssText="";i.parentNode.style.cssText="";t.animation=null}});this.animation.animate()}},{key:"showMoreMenu",value:function e(){if(!this.menu){this.menu=t.MenuManager.create("feed-add-post-form-popup",document.getElementById("feed-add-post-form-link-text"),this.menuItems,{className:"feed-add-post-form-popup",closeByEsc:true,offsetTop:5,offsetLeft:3,angle:true})}this.menu.popupWindow.show()}},{key:"restoreMoreMenu",value:function e(){var t=this.menuItems.length;if(t<1){return}for(var i=0;i<t;i++){if(this.active===this.menuItems[i]["tabId"]){return}}var s=document.getElementById("feed-add-post-form-link-more");var n=document.getElementById("feed-add-post-form-link-text");s.className="feed-add-post-form-link feed-add-post-form-link-more";n.innerHTML=o.Loc.getMessage("SBPE_MORE")}},{key:"getTaskForm",value:function e(){var t=this;var i=document.getElementById("feed-add-post-form-tab-tasks")&&document.getElementById("feed-add-post-form-tab-tasks").style.display!=="none"?document.getElementById("feed-add-post-form-tab-tasks"):document.getElementById("feed-add-post-form-link-more");var s=document.getElementById("feed-add-post-content-tasks");var a=document.getElementById("feed-add-post-content-tasks-container");if(a&&a.innerHTML.length<=0&&!this.clickDisabled){this.clickDisabled=true;r.getInstance().showWait(a);this.startAnimation();var l={GROUP_ID:o.Loc.getMessage("TASK_SOCNET_GROUP_ID"),PATH_TO_USER_TASKS:o.Loc.getMessage("PATH_TO_USER_TASKS"),PATH_TO_USER_TASKS_TASK:o.Loc.getMessage("PATH_TO_USER_TASKS_TASK"),PATH_TO_GROUP_TASKS:o.Loc.getMessage("PATH_TO_GROUP_TASKS"),PATH_TO_GROUP_TASKS_TASK:o.Loc.getMessage("PATH_TO_GROUP_TASKS_TASK"),PATH_TO_USER_PROFILE:o.Loc.getMessage("PATH_TO_USER_PROFILE"),PATH_TO_GROUP:o.Loc.getMessage("PATH_TO_GROUP"),PATH_TO_USER_TASKS_PROJECTS_OVERVIEW:o.Loc.getMessage("PATH_TO_USER_TASKS_PROJECTS_OVERVIEW"),PATH_TO_USER_TASKS_TEMPLATES:o.Loc.getMessage("PATH_TO_USER_TASKS_TEMPLATES"),PATH_TO_USER_TEMPLATES_TEMPLATE:o.Loc.getMessage("PATH_TO_USER_TEMPLATES_TEMPLATE"),ENABLE_FOOTER:"N",TEMPLATE_CONTROLLER_ID:"livefeed_task_form",ENABLE_FORM:"N",BACKURL:o.Loc.getMessage("TASK_SUBMIT_BACKURL")};o.ajax.runComponentAction("bitrix:tasks.task","uiEdit",{mode:"class",data:{parameters:{COMPONENT_PARAMETERS:l}}}).then((function(e){o.Runtime.html(a,e.data.html).then((function(){t.clickDisabled=false;t.closeWait(a);t.endAnimation();n.EventEmitter.emit(document.getElementById("divlivefeed_task_form"),"OnShowLHE",new n.BaseEvent({compatData:["justShow"]}))}));o.Dom.adjust(s,{style:{display:"block"}})}),(function(e){t.clickDisabled=false;t.closeWait(a);t.endAnimation();if(e.errors&&e.errors.length){var i=[];e.errors.forEach((function(e){i.push(e.message)}));throw new Error(i.join(" "))}}))}else{this.startAnimation();this.endAnimation()}}},{key:"closeWait",value:function e(t){var i=t.bxmsg;if(i&&i.parentNode){for(var s=0,n=this.lastWait.length;s<n;s++){if(i===this.lastWait[s]){this.lastWait=BX.util.deleteFromArray(this.lastWait,s);break}}i.parentNode.removeChild(i);if(t){t.bxmsg=null}o.Dom.clean(i);o.Dom.remove(i)}}},{key:"getLists",value:function e(){var t=this;var i=document.getElementById("feed-add-post-form-tab-lists")&&document.getElementById("feed-add-post-form-tab-lists").style.display!=="none"?document.getElementById("feed-add-post-form-tab-lists"):document.getElementById("feed-add-post-form-link-more");var s=i.querySelectorAll("span.feed-add-post-form-link-lists");var n=i.querySelectorAll("span.feed-add-post-form-link-lists-default");var a=[];var r=[];if(s.length){r=this.getMenuItems(s,this.createOnclickLists);a=this.getMenuItemsDefault(n);r=r.concat(a);this.showMoreMenuLists(r)}else{var l=null;if(document.getElementById("bx-lists-select-site-id")){l=document.getElementById("bx-lists-select-site-id").value}o.ajax({method:"POST",dataType:"json",url:"/bitrix/components/bitrix/socialnetwork.blog.post.edit/post.ajax.php",data:{bitrix_processes:1,siteId:l,sessid:o.Loc.getMessage("bitrix_sessid")},onsuccess:function e(l){if(l.success){for(var d in l.lists){if(!l.lists.hasOwnProperty(d)){continue}i.appendChild(o.Dom.create("span",{attrs:{"data-name":l.lists[d].NAME,"data-picture":l.lists[d].PICTURE,"data-description":l.lists[d].DESCRIPTION,"data-picture-small":l.lists[d].PICTURE_SMALL,"data-code":l.lists[d].CODE,iblockId:l.lists[d].ID},props:{className:"feed-add-post-form-link-lists",id:"feed-add-post-form-tab-lists"},style:{display:"none"}}))}s=i.querySelectorAll("span.feed-add-post-form-link-lists");r=t.getMenuItems(s,t.createOnclickLists);if(!n.length){for(var c in l.permissions){if(!l.permissions.hasOwnProperty(c)){continue}var u=void 0;if(c==="new"){u='document.location.href = "'.concat(document.getElementById("bx-lists-lists-page").value,'0/edit/"')}else if(c==="market"){if(l.admin&&document.getElementById("bx-lists-lists-page")){u='document.location.href = "'.concat(document.getElementById("bx-lists-lists-page").value,'?bp_catalog=y"')}else{if(document.getElementById("bx-lists-random-string")){u='BX.Lists["LiveFeedClass_'.concat(BX("bx-lists-random-string").value,'"].errorPopup("').concat(o.Loc.getMessage("LISTS_CATALOG_PROCESSES_ACCESS_DENIED"),'");')}}}else if(c==="settings"){u='document.location.href = "'.concat(BX("bx-lists-lists-page").value,'"')}i.appendChild(o.Dom.create("span",{attrs:{"data-name":l.permissions[c],"data-picture-small":"","data-key":c,"data-onclick":u},props:{className:"feed-add-post-form-link-lists-default",id:"feed-add-post-form-tab-lists"},style:{display:"none"}}))}n=i.querySelectorAll("span.feed-add-post-form-link-lists-default")}a=t.getMenuItemsDefault(n);r=r.concat(a);t.showMoreMenuLists(r)}else{i.appendChild(o.Dom.create("span",{attrs:{"data-name":l.error,"data-picture-small":""},props:{className:"feed-add-post-form-link-lists-default",id:"feed-add-post-form-tab-lists"},style:{display:"none"}}));s=i.querySelectorAll("span.feed-add-post-form-link-lists-default");r=t.getMenuItems(s,false);t.showMoreMenuLists(r)}}})}}},{key:"getMenuItems",value:function e(t,i){var s=[];for(var o=0;o<t.length;o++){var n=t[o].getAttribute("id").replace("feed-add-post-form-tab-","");if(i){s.push({tabId:n,text:BX.util.htmlspecialchars(t[o].getAttribute("data-name")),className:"feed-add-post-form-".concat(n," feed-add-post-form-").concat(n,"-item"),onclick:i(n,[t[o].getAttribute("iblockId"),t[o].getAttribute("data-name"),t[o].getAttribute("data-description"),t[o].getAttribute("data-picture"),t[o].getAttribute("data-code")])})}else{s.push({tabId:n,text:t[o].getAttribute("data-name"),className:"feed-add-post-form-".concat(n),onclick:""})}}return s}},{key:"getMenuItemsDefault",value:function e(t){var i=[];for(var s=0;s<t.length;s++){i.push({text:BX.util.htmlspecialchars(t[s].getAttribute("data-name")),className:"feed-add-post-form-lists-default-".concat(t[s].getAttribute("data-key")),onclick:t[s].getAttribute("data-onclick")})}return i}},{key:"showMoreMenuLists",value:function e(i){var s=document.getElementById("feed-add-post-form-tab-lists").style.display!=="none"?document.getElementById("feed-add-post-form-tab-lists"):document.getElementById("feed-add-post-form-link-more");this.listsMenu=t.MenuManager.create("lists",s,i,{closeByEsc:true,offsetTop:5,offsetLeft:12,angle:true});var o=document.getElementById("popup-window-content-menu-popup-lists").querySelectorAll("span.menu-popup-item-icon");var n=s.querySelectorAll("span.feed-add-post-form-link-lists");var a=s.querySelectorAll("span.feed-add-post-form-link-lists-default");n=Array.from(n).concat(Array.from(a));for(var r=0;r<o.length;r++){if(!n[r].getAttribute("data-picture-small")){continue}o[r].innerHTML=n[r].getAttribute("data-picture-small")}this.listsMenu.popupWindow.show()}},{key:"createOnclickLists",value:function e(t,s){return function(){i.getInstance().changePostFormTab(t,s);i.getInstance().listsMenu.popupWindow.close();i.getInstance().menu.popupWindow.close()}}}]);return i}(n.EventEmitter);babelHelpers.defineProperty(l,"instance",null);var d=function(){function e(){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"isInitialized",false);babelHelpers.defineProperty(this,"popupShowingPeriods",null);babelHelpers.defineProperty(this,"menuItems",[]);babelHelpers.defineProperty(this,"customDateStyleModifier","feed-add-post-expire-date-customize");babelHelpers.defineProperty(this,"customDatePopupOptionClass","js-custom-date-end");babelHelpers.defineProperty(this,"postExpireDateBlock",null);babelHelpers.defineProperty(this,"formUfInputDateCustom",null);babelHelpers.defineProperty(this,"formDateDuration",null);babelHelpers.defineProperty(this,"formDateTimeEditing",null);babelHelpers.defineProperty(this,"popupTrigger",null);babelHelpers.defineProperty(this,"customDateSelectedTitle",null);babelHelpers.defineProperty(this,"selectors",{postExpireDateBlock:".js-post-expire-date-block",postEndTime:".js-form-post-end-time",postEditingEndTime:".js-form-editing-post-end-time",postEndPeriod:".js-form-post-end-period",popupTrigger:".js-important-till-popup-trigger",customDateFinal:".js-date-post-showing-custom",durationOptionsContainer:".js-post-showing-duration-options-container",durationOption:".js-post-showing-duration-option"});this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){if(this.isInitialized){return}this.addEventHandlers();if(!this.formDateTimeEditing.value){this.customDateSelectedTitle.innerText=this.getCurrentDate()}this.isInitialized=true}},{key:"addEventHandlers",value:function e(){var t=this;this.postExpireDateBlock=document.querySelector(this.selectors.postExpireDateBlock);this.formUfInputDateCustom=document.querySelector(this.selectors.postEndTime);this.formDateDuration=document.querySelector(this.selectors.postEndPeriod);this.formDateTimeEditing=document.querySelector(this.selectors.postEditingEndTime);this.popupTrigger=document.querySelector(this.selectors.popupTrigger);if(this.popupTrigger){this.popupTrigger.addEventListener("click",(function(){t.showPostEndPeriodsPopup()}))}this.customDateSelectedTitle=document.querySelector(this.selectors.customDateFinal);if(this.customDateSelectedTitle){this.customDateSelectedTitle.addEventListener("click",(function(){var e=new Date;var i=Math.round(e/1e3)-e.getTimezoneOffset()*60;if(t.formDateTimeEditing.value){e=BX.parseDate(t.formDateTimeEditing.value);i=BX.date.convertToUTC(e)}BX.calendar({node:t.customDateSelectedTitle,form:"blogPostForm",value:i,bTime:false,callback:function e(){return true},callback_after:t.onEndDateSet.bind(t)})}))}}},{key:"showPostEndPeriodsPopup",value:function e(){if(!this.popupShowingPeriods){this.createPopupShowingPeriods()}this.popupShowingPeriods.popupWindow.show()}},{key:"createPopupShowingPeriods",value:function e(){if(this.menuItems.length<=0){this.menuItems=this.createPopupItems()}this.popupShowingPeriods=t.MenuManager.create("feed-add-post-form-popup42",document.getElementById("js-post-expire-date-wrapper"),this.menuItems,{className:"feed-add-post-expire-date-options",closeByEsc:true,angle:true})}},{key:"createPopupItems",value:function e(){var t=this;var i=[];var s=document.querySelector(this.selectors.durationOptionsContainer).querySelectorAll(this.selectors.durationOption);if(!s){return i}s.forEach((function(e){i.push({onclick:t.onPopupItemClick.bind(t),dataset:{value:e.getAttribute("data-value"),class:e.getAttribute("data-class")},text:e.getAttribute("data-text"),className:"menu-popup-item menu-popup-no-icon ".concat(e.getAttribute("data-class"))})}));return i}},{key:"onPopupItemClick",value:function e(t){var i=t.currentTarget;if(i.getAttribute("data-class")===this.customDatePopupOptionClass){this.postExpireDateBlock.classList.add(this.customDateStyleModifier);if(this.formDateTimeEditing.value){this.formUfInputDateCustom.value=this.formDateTimeEditing.value;this.customDateSelectedTitle.innerText=this.formDateTimeEditing.value}else{this.formUfInputDateCustom.value=this.getCurrentDate()}}else{this.postExpireDateBlock.classList.remove(this.customDateStyleModifier);this.formUfInputDateCustom.value=null}this.popupTrigger.innerText=i.innerText.toLowerCase();this.formDateDuration.value=i.getAttribute("data-value").toUpperCase();this.popupShowingPeriods.popupWindow.close()}},{key:"onEndDateSet",value:function e(t){if(!t){return}this.formDateTimeEditing.value=this.getFormattedDate(t);this.formUfInputDateCustom.value=this.getFormattedDate(t);this.customDateSelectedTitle.innerText=this.getFormattedDate(t)}},{key:"getFormattedDate",value:function e(t){return BX.date.format(BX.date.convertBitrixFormat(o.Loc.getMessage("FORMAT_DATE")),t)}},{key:"getCurrentDate",value:function e(){return this.getFormattedDate(new Date)}}]);return e}();var c=function(e){babelHelpers.inherits(s,e);babelHelpers.createClass(s,null,[{key:"setInstance",value:function e(t){s.instance=t}},{key:"getInstance",value:function e(){return s.instance}}]);function s(e){var t;babelHelpers.classCallCheck(this,s);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(s).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"popupWindow",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"sendEvent",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"gratsContentElement",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"itemSelectedImageItem",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"itemSelectedInput",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"gratsList",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"selector",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"config",{fields:{employeesValue:{name:"GRAT_DEST_DATA"}}});t.init(e);s.setInstance(babelHelpers.assertThisInitialized(t));return t}babelHelpers.createClass(s,[{key:"init",value:function e(t){var i=this;if(!t.name){t.name="lm"}this.itemSelectedImageItem[t.name]=t.itemSelectedImageItem;this.itemSelectedInput[t.name]=t.itemSelectedInput;this.gratsList[t.name]=t.gratsList;this.itemSelectedImageItem[t.name].addEventListener("click",(function(e){i.openDialog(t.name);e.preventDefault()}));this.createEntitySelector(t.entitySelectorParams)}},{key:"openDialog",value:function e(i){var s=this;if(!i){i="lm"}if(this.popupWindow!=null){this.popupWindow.close();return false}var n=[];for(var a=0;a<this.gratsList[i].length;a++){n[n.length]=o.Dom.create("span",{props:{className:"feed-add-grat-box ".concat(this.gratsList[i][a].style)},attrs:{"data-title":this.gratsList[i][a].title,"data-code":this.gratsList[i][a].code,"data-style":this.gratsList[i][a].style},events:{click:function e(t){var o=t.currentTarget;s.selectItem(i,o.getAttribute("data-code"),o.getAttribute("data-style"),o.getAttribute("data-title"));t.preventDefault()}}})}var r=[];var l=1;for(var d=0;d<n.length;d++){if(d>=n.length/2){l=2}if(o.Type.isNil(r[l])){r[l]=o.Dom.create("div",{props:{className:"feed-add-grat-list-row"}})}r[l].appendChild(n[d])}this.gratsContentElement=o.Dom.create("div",{children:[o.Dom.create("div",{props:{className:"feed-add-grat-list-title"},html:o.Loc.getMessage("BLOG_GRAT_POPUP_TITLE")}),o.Dom.create("div",{props:{className:"feed-add-grat-list"},children:r})]});this.popupWindow=new t.Popup("BXSocNetGratSelector",document.getElementById("feed-add-post-grat-type-selected"),{autoHide:true,offsetLeft:25,bindOptions:{forceBindPosition:true},closeByEsc:true,closeIcon:{top:"5px",right:"10px"},events:{onPopupClose:function e(){s.popupWindow.destroy()},onPopupDestroy:function e(){s.popupWindow=null}},content:this.gratsContentElement,angle:{position:"bottom",offset:20},lightShadow:true});this.popupWindow.setAngle({});this.popupWindow.show();return true}},{key:"selectItem",value:function e(t,i,s,o){var n=this.itemSelectedImageItem[t].querySelector("span");if(n){n.className="feed-add-grat-box ".concat(s)}this.itemSelectedImageItem[t].title=o;this.itemSelectedInput[t].value=i;this.popupWindow.close()}},{key:"createEntitySelector",value:function e(t){var s=this;this.selector=new i.TagSelector({id:t.id,dialogOptions:{id:t.id,context:"GRATITUDE",preselectedItems:o.Type.isArray(t.preselectedItems)?t.preselectedItems:[],events:{"Item:onSelect":function e(i){s.recalcValue(i.getTarget().getSelectedItems(),t.inputNodeId)},"Item:onDeselect":function e(i){s.recalcValue(i.getTarget().getSelectedItems(),t.inputNodeId)}},entities:[{id:"user",options:{emailUsers:false,inviteEmployeeLink:false,intranetUsersOnly:true}},{id:"department",options:{selectMode:"usersOnly"}}]},addButtonCaption:o.Loc.getMessage("BLOG_GRATMEDAL_1"),addButtonCaptionMore:o.Loc.getMessage("BLOG_GRATMEDAL_1")});this.selector.renderTo(document.getElementById(t.tagNodeId));this.selector.subscribe("onContainerClick",(function(){s.emit("Selector::onContainerClick")}))}},{key:"recalcValue",value:function e(t,i){if(!o.Type.isArray(t)||!document.getElementById(i)){return}var s=[];t.forEach((function(e){s.push([e.entityId,e.id])}));document.getElementById(i).value=JSON.stringify(s)}}]);return s}(n.EventEmitter);babelHelpers.defineProperty(c,"instance",null);var u=function(e){babelHelpers.inherits(t,e);babelHelpers.createClass(t,null,[{key:"setInstance",value:function e(i,s){t.instance[i]=s}},{key:"getInstance",value:function e(i){return t.instance[i]}}]);function t(e,i){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"disabled",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"formId","");s.init(e,i);t.setInstance(e,babelHelpers.assertThisInitialized(s));window["setBlogPostFormSubmitted"]=s.setBlogPostFormSubmitted.bind(babelHelpers.assertThisInitialized(s));window["submitBlogPostForm"]=s.submitBlogPostForm.bind(babelHelpers.assertThisInitialized(s));return s}babelHelpers.createClass(t,[{key:"init",value:function e(t,i){var s=this;this.disabled=false;this.formId=t;this.formParams={editorID:i.editorID,showTitle:!!i.showTitle,submitted:false,text:i.text,autoSave:i.autoSave,handler:LHEPostForm&&LHEPostForm.getHandler(i.editorID),editor:LHEPostForm&&LHEPostForm.getEditor(i.editorID),restoreAutosave:!!i.restoreAutosave,createdFromEmail:!!i.createdFromEmail};n.EventEmitter.subscribe("onInitialized",(function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,2),o=i[0],n=i[1];s.onHandlerInited(o,n)}));if(this.formParams.handler){this.onHandlerInited(this.formParams.handler,t)}n.EventEmitter.subscribe("OnEditorInitedAfter",(function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,1),o=i[0];s.onEditorInited(o)}));if(this.formParams.editor){this.onEditorInited(this.formParams.editor)}n.EventEmitter.subscribe("onSocNetLogMoveBody",(function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,1),o=i[0];if(o==="sonet_log_microblog_container"){s.reinit()}}));o.Event.ready((function(){if(o.Browser.isIE()&&document.getElementById("POST_TITLE")){var e=function e(){var t=document.getElementById("POST_TITLE");if(!t||t.value===t.getAttribute("placeholder")){t.value=t.getAttribute("placeholder");t.classList.remove("feed-add-post-inp-active")}};o.Event.bind(document.getElementById("POST_TITLE"),"blur",e);e();document.getElementById("POST_TITLE").__onchange=function(e){var t=document.getElementById("POST_TITLE");if(t.value===t.getAttribute("placeholder")){t.value=""}if(t.className.indexOf("feed-add-post-inp-active")<0){t.classList.add("feed-add-post-inp-active")}};o.Event.bind(document.getElementById("POST_TITLE"),"click",document.getElementById("POST_TITLE").__onchange);o.Event.bind(document.getElementById("POST_TITLE"),"keydown",document.getElementById("POST_TITLE").__onchange);o.Event.bind(document.getElementById("POST_TITLE").form,"submit",(function(){var e=document.getElementById("POST_TITLE");if(e.value===e.getAttribute("placeholder")){e.value=""}}))}if(i.activeTab!==""){l.getInstance().changePostFormTab(i.activeTab)}l.getInstance().subscribe("changePostFormTab",s.checkHideAlert.bind(s));if(c.getInstance()){c.getInstance().subscribe("Selector::onContainerClick",s.hideAlert.bind(s))}}))}},{key:"showPanelTitle",value:function e(t,i){t=t===true||t===false?t:document.getElementById("blog-title").style.display&&document.getElementById("blog-title").style.display==="none";i=i!==false;var s=this.formParams.showTitle;var o=document.getElementById("lhe_button_title_".concat(this.formId));var n=document.getElementById("feed-add-post-block".concat(this.formId));var a=document.getElementById("show_title")||{};if(t){BX.show(document.getElementById("blog-title"));if(document.getElementById("POST_TITLE")){document.getElementById("POST_TITLE").focus()}this.formParams.showTitle=true;a.value="Y";if(o){o.classList.add("feed-add-post-form-btn-active")}if(n){n.classList.add("blog-post-edit-open")}}else{BX.hide(document.getElementById("blog-title"));this.formParams.showTitle=false;a.value="N";if(o){o.classList.remove("feed-add-post-form-btn-active")}}if(i){BX.userOptions.save("socialnetwork","postEdit","showTitle",this.formParams.showTitle?"Y":"N")}else{this.formParams.showTitle=s}}},{key:"setBlogPostFormSubmitted",value:function e(t){if(document.getElementById("blog-submit-button-save")){if(t){document.getElementById("blog-submit-button-save").classList.add("ui-btn-clock")}else{document.getElementById("blog-submit-button-save").classList.remove("ui-btn-clock")}}this.formParams.submitted=t;this.disabled=t}},{key:"submitBlogPostForm",value:function e(t,i){var s=this;if(this.disabled){return}if(!o.Type.isObject(t)){i=t;t=LHEPostForm.getEditor(this.formParams.editorID)}if(t&&t.id===this.formParams.editorID){if(this.formParams.submitted){return false}t.SaveContent();if(!i){i="save"}if(document.getElementById("blog-title").style.display==="none"){document.getElementById("POST_TITLE").value=""}var n=this.getSubmitButton({buttonType:i});if(n){n.classList.add("ui-btn-clock");this.disabled=true;window.addEventListener("beforeunload",(function(e){setTimeout((function(){BX.removeClass(n,"ui-btn-clock");s.disabled=false;s.formParams.submitted=false}),3e3)}))}var a="";var r=l.getInstance().active;if(o.Type.isStringFilled(r)){a=document.getElementById(this.formId).action;o.Uri.removeParam(a,["b24statTab"]);o.Uri.addParam(a,{b24statTab:r});document.getElementById(this.formId).action=a}if([l.getInstance().config.id.message,l.getInstance().config.id.file,l.getInstance().config.id.gratitude,l.getInstance().config.id.important,l.getInstance().config.id.vote].includes(r)){if(!this.checkDestinationValue({buttonType:i})){return}}if(r===l.getInstance().config.id.gratitude&&c.getInstance()){if(!this.checkEmployeesValue({buttonType:i})){return}}setTimeout((function(){BX.submit(document.getElementById(s.formId),i);s.formParams.submitted=true}),100)}}},{key:"checkDestinationValue",value:function e(t){var i=t.buttonType;if(o.Type.isUndefined(MPFEntitySelector)){return true}var s=new MPFEntitySelector({id:"oPostFormLHE_".concat(this.formId)});if(!s||!o.Type.isArray(s.tags)||s.tags.length>0){return true}this.enableSubmitButton({buttonType:i});this.showBottomAlert({text:o.Loc.getMessage("BLOG_POST_EDIT_T_GRAT_ERROR_NO_DESTINATION")});s.subscribeOnce("onContainerClick",this.hideAlert);return false}},{key:"checkEmployeesValue",value:function e(t){var i=t.buttonType;var s=document.getElementById(this.formId).elements[c.getInstance().config.fields.employeesValue.name];if(s&&o.Type.isStringFilled(s.value)&&s.value!=="[]"){return true}this.enableSubmitButton({buttonType:i});this.showBottomAlert({text:o.Loc.getMessage("BLOG_POST_EDIT_T_GRAT_ERROR_NO_EMPLOYEES")});return false}},{key:"checkHideAlert",value:function e(t){var i=t.getData(),s=i.type;if(s===l.getInstance().config.id.gratitude){return}this.hideAlert()}},{key:"hideAlert",value:function e(){var t=document.getElementById("feed-add-post-bottom-alertblogPostForm");if(!t){return}o.Dom.clean(t)}},{key:"enableSubmitButton",value:function e(t){var i=t.buttonType;var s=this.getSubmitButton({buttonType:i});if(s){s.classList.remove("ui-btn-clock");this.disabled=false}}},{key:"getSubmitButton",value:function e(t){var i=t.buttonType;var s=null;if(i==="save"&&document.getElementById("blog-submit-button-save")){s=document.getElementById("blog-submit-button-save")}else if(i==="draft"&&document.getElementById("blog-submit-button-draft")){s=document.getElementById("blog-submit-button-draft")}return s}},{key:"showBottomAlert",value:function e(t){if(!o.Type.isPlainObject(t)||!o.Type.isStringFilled(t.text)){return}var i=document.getElementById("feed-add-post-bottom-alertblogPostForm");if(i){o.Dom.clean(i);i.appendChild(o.Dom.create("div",{props:{className:"ui-alert ui-alert-danger"},children:[o.Dom.create("span",{props:{className:"ui-alert-message"},text:t.text})]}))}}},{key:"onHandlerInited",value:function e(t,i){if(i!==this.formId){return}this.formParams.handler=t;n.EventEmitter.subscribe(t.eventNode,"OnControlClick",(function(){l.getInstance().changePostFormTab(l.getInstance().config.id.message)}));n.EventEmitter.subscribe(t.eventNode,"OnAfterShowLHE",this.OnAfterShowLHE.bind(this));n.EventEmitter.subscribe(t.eventNode,"OnAfterHideLHE",this.OnAfterHideLHE.bind(this));if(t.eventNode.style.display=="none"){this.OnAfterHideLHE()}else{this.OnAfterShowLHE()}}},{key:"OnAfterShowLHE",value:function e(){var t=[document.getElementById("feed-add-post-form-notice-blockblogPostForm"),document.getElementById("feed-add-buttons-blockblogPostForm"),document.getElementById("feed-add-post-bottom-alertblogPostForm"),document.getElementById("feed-add-post-content-message-add-ins")];for(var i=0;i<t.length;i++){if(!t[i]){continue}t[i].classList.remove("feed-post-form-block-hidden")}if(this.formParams.showTitle){this.showPanelTitle(true,false)}}},{key:"OnAfterHideLHE",value:function e(){var t=[document.getElementById("feed-add-post-form-notice-blockblogPostForm"),document.getElementById("feed-add-buttons-blockblogPostForm"),document.getElementById("feed-add-post-bottom-alertblogPostForm"),document.getElementById("feed-add-post-content-message-add-ins")];for(var i=0;i<t.length;i++){if(!t[i]){continue}t[i].classList.add("feed-post-form-block-hidden")}if(this.formParams.showTitle){this.showPanelTitle(false,false)}}},{key:"onEditorInited",value:function e(t){var i=this;if(r.getInstance().initedEditorsList.includes(t.id)){return}if(t.id!==this.formParams.editorID){return}this.formParams.editor=t;if(this.formParams.autoSave!=="N"){new m(this.formParams.autoSave,this.formParams.restoreAutosave)}var s=window[t.id+"Files"];var a=LHEPostForm.getHandler(t.id);var l=[];var d=null;var c=null;for(var u in a.controllers){if(!a.controllers.hasOwnProperty(u)){continue}if(a.controllers[u].parser&&a.controllers[u].parser.bxTag==="postimage"){c=a.controllers[u];break}}var f=function e(t,i){return function(){t.insertFile(i)}};var p=function e(t,i,s){return function(){if(c){c.deleteFile(i,{});o.Dom.remove(document.getElementById("wd-doc'".concat(i)));o.ajax({method:"GET",url:s})}else{t.deleteFile(i,s,t,{controlID:"common"})}}};for(var h in s){if(!s.hasOwnProperty(h)){continue}if(c){c.addFile(s[h])}else{var b=a.checkFile(h,"common",s[h]);l.push(h);if(!!b&&document.getElementById("wd-doc".concat(h))&&!document.getElementById("wd-doc".concat(h)).hasOwnProperty("bx-bound")){BX("wd-doc".concat(h)).setAttribute("bx-bound","Y");if((d=document.getElementById("wd-doc".concat(h)).querySelector(".feed-add-img-wrap"))&&d){o.Event.bind(d,"click",f(a,b));d.style.cursor="pointer"}if((d=document.getElementById("wd-doc".concat(h)).querySelector(".feed-add-img-title"))&&d){o.Event.bind(d,"click",f(a,b));d.style.cursor="pointer"}}}if((d=document.getElementById("wd-doc".concat(h)).querySelector(".feed-add-post-del-but"))&&d){o.Event.bind(d,"click",p(a,h,s[h].del_url));d.style.cursor="pointer"}}if(l.length>0){t.SaveContent();var g=t.GetContent();g=g.replace(new RegExp("\\&\\#91\\;IMG ID=("+l.join("|")+")([WIDTHHEIGHT=0-9 ]*)\\&\\#93\\;","gim"),"[IMG ID=$1$2]");t.SetContent(g);t.Focus()}r.getInstance().initedEditorsList.push(t.id);n.EventEmitter.subscribe(t,"OnSetViewAfter",(function(){if(i.formParams.createdFromEmail){if(t.GetContent()===""){t.SetContent("".concat(o.Loc.getMessage("CREATED_ON_THE_BASIC_OF_THE_MESSAGE")))}t.Focus(true)}}))}},{key:"reinit",value:function e(){if(!this.formParams.editorID){return}if(o.Type.isFunction(this.formParams.editor)){this.formParams.editor(this.formParams.text)}else{setTimeout(this.reinit,50)}}}]);return t}(n.EventEmitter);babelHelpers.defineProperty(u,"instance",{});var m=function(){function e(t,i){babelHelpers.classCallCheck(this,e);this.init(t,i)}babelHelpers.createClass(e,[{key:"init",value:function e(t,i){var s=this;var a="blogPostForm";var r=document.getElementById(a);var l="POST_TITLE";var d=document.getElementById(l);var c=r.TAGS;if(!r){return}i=!o.Type.isUndefined(i)?!!i:true;n.EventEmitter.subscribe(r,"onAutoSavePrepare",(function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,2),o=i[0],n=i[1];o.DISABLE_STANDARD_NOTIFY=true;var a=o;setTimeout((function(){s.bindLHEEvents(a)}),100)}));n.EventEmitter.subscribe(r,"onAutoSave",(function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,2),s=i[0],o=i[1];o.TAGS=c.value;delete o.POST_MESSAGE}));if(t=="Y"){n.EventEmitter.subscribe(r,"onAutoSaveRestoreFound",(function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,2),s=i[0],n=i[1];var r=n["text".concat(a)];r=o.Type.isStringFilled(r)?r.trim():"";var d=n[l];d=o.Type.isStringFilled(d)?d.trim():"";if(!o.Type.isStringFilled(r)&&!o.Type.isStringFilled(d)){return}s.Restore()}))}else{n.EventEmitter.subscribe(r,"onAutoSaveRestoreFound",(function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,2),s=i[0],n=i[1];var r=n["text".concat(a)];r=o.Type.isStringFilled(r)?r.trim():"";var d=n[l];d=o.Type.isStringFilled(d)?d.trim():"";if(!o.Type.isStringFilled(r)&&!o.Type.isStringFilled(d)){return}var c=document.getElementById("microoPostFormLHE_blogPostForm");var u=o.Dom.create("DIV",{attrs:{className:"feed-add-successfully"},children:[o.Dom.create("SPAN",{attrs:{className:"feed-add-info-icon"}}),o.Dom.create("A",{attrs:{className:"feed-add-info-text",href:"#"},events:{click:function e(){s.Restore();u.parentNode.removeChild(u);return false}},text:o.Loc.getMessage("BLOG_POST_AUTOSAVE2")})]});if(c){c.parentNode.insertBefore(u,c)}}))}if(i){n.EventEmitter.subscribe(r,"onAutoSaveRestore",(function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,2),r=i[0],c=i[1];d.value=c[l];if(o.Type.isStringFilled(c[l])&&c[l]!==d.getAttribute("placeholder")){if(document.getElementById("divoPostFormLHE_blogPostForm").style.display!=="none"){u.getInstance(a).showPanelTitle(true)}else{window.bShowTitle=true}if(o.Type.isFunction(d.__onchange)){d.__onchange()}}var m=window["BXPostFormTags_".concat(a)];if(c.TAGS.length>0&&m){var f=m.addTag(c.TAGS);if(f.length>0){BX.show(m.tagsArea)}}n.EventEmitter.emit("onAutoSaveRestoreDestination",new n.BaseEvent({compatData:[{formId:a,data:c}]}));s.bindLHEEvents(r)}))}}},{key:"bindLHEEvents",value:function e(t){var i=document.getElementById("blogPostForm");var s=document.getElementById("POST_TITLE");var n=i.TAGS;o.Event.bind(s,"keydown",t.Init.bind(t));o.Event.bind(n,"keydown",t.Init.bind(t))}}]);return e}();e.PostForm=r;e.PostFormTabs=l;e.PostFormDateEnd=d;e.PostFormGratSelector=c;e.PostFormAutoSave=m;e.PostFormEditor=u})(this.BX.Socialnetwork.Livefeed=this.BX.Socialnetwork.Livefeed||{},BX.Main,BX.UI.EntitySelector,BX.Main,BX,BX.Event);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.post.form/templates/.default/script.min.js?169761435670830";s:6:"source";s:69:"/bitrix/components/bitrix/main.post.form/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.post.form/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.post.form/templates/.default/script.map.js";}"*/
(function(){if(window["LHEPostForm"]){return}this.BX=this.BX||{};(function(e,t,i,n,r){"use strict";var a=function(){function e(t,i){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"id","SomeParser");babelHelpers.defineProperty(this,"buttonParams",{name:"Some parser name",iconClassName:"some-parser-class",disabledForTextarea:false,src:"/icon.png",toolbarSort:205});this.editor=t;this.htmlEditor=i;this.handler=this.handler.bind(this)}babelHelpers.createClass(e,[{key:"handler",value:function e(){}},{key:"parse",value:function e(t){return t}},{key:"unparse",value:function e(t,i){return""}},{key:"hasButton",value:function e(){return this.buttonParams!==null}},{key:"getButton",value:function e(){if(this.buttonParams===null){return null}return{id:this.id,name:this.buttonParams.name,iconClassName:this.buttonParams.iconClassName,disabledForTextarea:this.buttonParams.disabledForTextarea,src:this.buttonParams.src,toolbarSort:this.buttonParams.toolbarSort,handler:this.handler}}},{key:"getParser",value:function e(){var t=this;return{name:this.id,obj:{Parse:function e(i,n){return t.parse(n)},UnParse:this.unparse.bind(this)}}}}]);return e}();var o=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++){a[o]=arguments[o]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(a)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"id","spoiler");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"buttonParams",{name:r.Loc.getMessage("MPF_SPOILER"),iconClassName:"spoiler",disabledForTextarea:false,src:r.Loc.getMessage("MPF_TEMPLATE_FOLDER")+"/images/lhespoiler.svg",toolbarSort:205});return i}babelHelpers.createClass(t,[{key:"handler",value:function e(){var t;if(!this.htmlEditor.bbCode||!this.htmlEditor.synchro.IsFocusedOnTextarea()){t=this.htmlEditor.action.actions.formatBlock.exec("formatBlock","blockquote","bx-spoiler",false,{bxTagParams:{tag:"spoiler"}})}else{t=this.htmlEditor.action.actions.formatBbCode.exec("quote",{tag:"SPOILER"})}return t}},{key:"parse",value:function e(t,i){if(/\[spoiler(([^\]])*)\]/gi.test(t)){t=t.replace(/[\x01-\x02]/gi,"").replace(/\[spoiler([^\]]*)\]/gi,"\x01$1\x01").replace(/\[\/spoiler]/gi,"\x02");var n=/(?:\x01([^\x01]*)\x01)([^\x01-\x02]+)\x02/gi;while(t.match(n)){t=t.replace(n,function(e,t,i){t=t.replace(/^(="|='|=)/gi,"").replace(/("|')?$/gi,"");return'<blockquote class="bx-spoiler" id="'.concat(this.htmlEditor.SetBxTag(false,{tag:"spoiler"}),'" title="').concat(t,'">').concat(i,"</blockquote>")}.bind(this))}}t=t.replace(/\001([^\001]*)\001/gi,"[spoiler$1]").replace(/\002/gi,"[/spoiler]");return t}},{key:"unparse",value:function e(t,i){var n="";for(var r=0;r<i.node.childNodes.length;r++){n+=this.htmlEditor.bbParser.GetNodeHtml(i.node.childNodes[r])}n=n.trim();if(n!==""){return"[SPOILER"+(i.node.hasAttribute("title")?"="+i.node.getAttribute("title"):"")+"]"+n+"[/SPOILER]"}return""}}]);return t}(a);var s=function(e){babelHelpers.inherits(i,e);function i(e,n){var r;babelHelpers.classCallCheck(this,i);r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e,n));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"id","postuser");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"buttonParams",null);t.EventEmitter.subscribe(n,"OnIframeKeydown",(function(e){var t=babelHelpers.slicedToArray(e.compatData,1),i=t[0];if(window.onKeyDownHandler){window.onKeyDownHandler(i,n,n.formID)}}));t.EventEmitter.subscribe(n,"OnIframeKeyup",(function(e){var t=babelHelpers.slicedToArray(e.compatData,1),i=t[0];if(window.onKeyUpHandler){window.onKeyUpHandler(i,n,n.formID)}}));t.EventEmitter.subscribe(n,"OnIframeClick",(function(){if(window["BXfpdStopMent"+n.formID]){window["BXfpdStopMent"+n.formID]()}}));t.EventEmitter.subscribe(n,"OnTextareaKeyup",(function(e){var t=babelHelpers.slicedToArray(e.compatData,1),i=t[0];if(n.textareaView&&n.textareaView.GetCursorPosition&&window.onTextareaKeyUpHandler){window.onTextareaKeyUpHandler(i,n,n.formID)}}));t.EventEmitter.subscribe(n,"OnTextareaKeydown",(function(e){var t=babelHelpers.slicedToArray(e.compatData,1),i=t[0];if(n.textareaView&&n.textareaView.GetCursorPosition&&window.onTextareaKeyDownHandler){window.onTextareaKeyDownHandler(i,n,n.formID)}}));return r}babelHelpers.createClass(i,[{key:"parse",value:function e(t,i){var n=this;t=t.replace(/\[USER\s*=\s*(\d+)\](.*?)\[\/USER\]/gi,(function(e,t,i){i=i.trim();if(i===""){return""}var r=n.htmlEditor.SetBxTag(false,{tag:n.id,userId:t,userName:i});return'<span id="'.concat(r,'" class="bxhtmled-metion">').concat(i,"</span>")})).replace(/\[PROJECT\s*=\s*(\d+)\](.*?)\[\/PROJECT\]/gi,(function(e,t,i){i=i.trim();if(i===""){return""}var r=n.htmlEditor.SetBxTag(false,{tag:n.id,projectId:t,projectName:i});return'<span id="'.concat(r,'" class="bxhtmled-metion">').concat(i,"</span>")})).replace(/\[DEPARTMENT\s*=\s*(\d+)\](.*?)\[\/DEPARTMENT\]/gi,(function(e,t,i){i=i.trim();if(i===""){return""}var r=n.htmlEditor.SetBxTag(false,{tag:n.id,departmentId:t,departmentName:i});return'<span id="'.concat(r,'" class="bxhtmled-metion">').concat(i,"</span>")}));return t}},{key:"unparse",value:function e(t,i){var n=this;var a="";i.node.childNodes.forEach((function(e){a+=n.htmlEditor.bbParser.GetNodeHtml(e)}));a=String(a).trim();var o="";if(r.Type.isStringFilled(a)){if(!r.Type.isUndefined(t.userId)){o="[USER=".concat(t.userId,"]").concat(a,"[/USER]")}else if(!r.Type.isUndefined(t.projectId)){o="[PROJECT=".concat(t.projectId,"]").concat(a,"[/PROJECT]")}else if(!r.Type.isUndefined(t.departmentId)){o="[DEPARTMENT=".concat(t.departmentId,"]").concat(a,"[/DEPARTMENT]")}}return o}}]);return i}(a);var l=function(){function e(i,n,r){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"actionPool",[]);this.cid=i;this.container=n;this.editor=r;t.EventEmitter.subscribe(r.getEventObject(),"onShowControllers",(function(e){var i=e.data;t.EventEmitter.emit(n.parentNode,"BFileDLoadFormController",new t.BaseEvent({compatData:[i]}))}));t.EventEmitter.subscribe(r.getEventObject(),"onCollectControllers",(function(e){e.data[i]={values:[]}}))}babelHelpers.createClass(e,[{key:"exec",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(t){this.actionPool.push(t)}if(this.isReady){try{var i;while((i=this.actionPool.shift())&&i){i.apply(this)}}catch(e){console.log("error in attachments controllers: ",e)}}}},{key:"getId",value:function e(){return this.cid}},{key:"getFieldName",value:function e(){return null}},{key:"reinitFrom",value:function e(t){var i=this;this.exec((function(){if(!i.getFieldName()){return}i.container.querySelector('inptut[name="'.concat(i.getFieldName(),'"]')).forEach((function(e){e.parentNode.removeChild(e)}))}))}},{key:"isReady",get:function e(){return true}}]);return e}();var d=function(e){babelHelpers.inherits(i,e);function i(e,n,r){var a;babelHelpers.classCallCheck(this,i);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e,n,r));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"diskUfUploader",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"diskUfHandler",null);var o=function e(i){a.diskUfUploader=i;a.exec();var n=function e(i){t.EventEmitter.emit(r.getEventObject(),"onUploadsHasBeenChanged",i)};t.EventEmitter.subscribe(a.diskUfUploader,"onFileIsInited",n);t.EventEmitter.subscribe(a.diskUfUploader,"ChangeFileInput",n)};if(BX.UploaderManager.getById(e)){o(BX.UploaderManager.getById(e))}t.EventEmitter.subscribeOnce(n.parentNode,"DiskDLoadFormControllerInit",(function(t){var i=babelHelpers.slicedToArray(t.compatData,1),n=i[0];a.diskUfHandler=n;if(e===n.CID&&!a.diskUfUploader){o(n.agent)}}));t.EventEmitter.subscribe(r.getEventObject(),"onShowControllers",(function(e){var i=e.data;t.EventEmitter.emit(n.parentNode,"DiskLoadFormController",new t.BaseEvent({compatData:[i]}))}));return a}babelHelpers.createClass(i,[{key:"getFieldName",value:function e(){if(this.diskUfHandler){return this.diskUfHandler.params.controlName}return null}},{key:"reinitFrom",value:function e(t){var i=this;this.exec((function(){if(!i.getFieldName()){return}Array.from(i.container.querySelectorAll('inptut[name="'.concat(i.getFieldName(),'"]'))).forEach((function(e){e.parentNode.removeChild(e)}));var e=null;for(var n in t){if(t.hasOwnProperty(n)&&t[n]&&t[n]["USER_TYPE_ID"]==="disk_file"&&t[n]["FIELD_NAME"]===i.getFieldName()){e=t[n]["VALUE"]}}if(e){var r={};e.forEach((function(e){var t=document.querySelector("#disk-attach-"+e);if(t.tagName!=="A"){t=t.querySelector("img")}if(t){r["E"+e]={type:"file",id:e,name:t.getAttribute("data-bx-title")||t.getAttribute("data-title"),size:t.getAttribute("data-bx-size")||"",sizeInt:t.getAttribute("data-bx-size")||"",width:t.getAttribute("data-bx-width"),height:t.getAttribute("data-bx-height"),storage:"disk",previewUrl:t.tagName==="A"?"":t.getAttribute("data-bx-src")||t.getAttribute("data-src"),fileId:t.getAttribute("bx-attach-file-id")};if(t.hasAttribute("bx-attach-xml-id"))r["E"+e]["xmlId"]=t.getAttribute("bx-attach-xml-id");if(t.hasAttribute("bx-attach-file-type"))r["E"+e]["fileType"]=t.getAttribute("bx-attach-file-type")}}));i.diskUfHandler.selectFile({},{},r)}}))}},{key:"isReady",get:function e(){return!!this.diskUfUploader}}]);return i}(l);var c;var u=function(e){babelHelpers.inherits(i,e);function i(e,n){var a;babelHelpers.classCallCheck(this,i);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e,n));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"id","uploadfile");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"buttonParams",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"regexp",/\[FILE ID=((?:\s|\S)*?)?\]/gi);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"values",new Map);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"controllers",new Map);a.checkButtonsDebounced=r.Runtime.debounce(a.checkButtons,500,babelHelpers.assertThisInitialized(a));a.init();t.EventEmitter.subscribe(e.getEditor(),"OnContentChanged",a.checkButtons.bind(babelHelpers.assertThisInitialized(a)));t.EventEmitter.subscribe(e.getEventObject(),"onReinitializeBefore",(function(e){var t=babelHelpers.slicedToArray(e.data,2),i=t[0],n=t[1];a.reinit(i,n)}));return a}babelHelpers.createClass(i,[{key:"init",value:function e(){var i=this;Array.from(this.editor.getContainer().querySelectorAll(".file-selectdialog")).forEach((function(e,n){var r=e.id.replace("file-selectdialog-","");var a=i.controllers.get(r);if(!a){a=new l(r,e,i.editor);t.EventEmitter.subscribe(e.parentNode,"OnFileUploadSuccess",(function(t){var n=babelHelpers.slicedToArray(t.data,2),a=n[0].element_id,o=n[1],s=o.id,l=o.doc_prefix,d=o.CID;if(r===s){var c=document.querySelector("#"+i.editor.getFormId())?document.querySelector("#"+i.editor.getFormId()).querySelector("#upload-cid"):null;if(c){c.value=d}var u=i.parseFile(e.querySelector("#"+l+a)),f=babelHelpers.slicedToArray(u,2),p=f[0],h=f[1];i.values.set(p,h)}}));t.EventEmitter.subscribe(e.parentNode,"OnFileUploadRemove",(function(e){var t=babelHelpers.slicedToArray(e.compatData,2),n=t[0],a=t[1].id;if(r===a&&i.values.has(n)){i.values["delete"](n);i.deleteFile([n])}}));if(n===0){t.EventEmitter.subscribe(i.editor.getEventObject(),"onFilesHaveCaught",(function(e){e.stopImmediatePropagation();if(window["BfileFD"+r]){window["BfileFD"+r].agent.UploadDroppedFiles(babelHelpers.toConsumableArray(e.getData()))}}))}}if(e.querySelector("table.files-list")){Array.from(e.querySelector("table.files-list").querySelectorAll("tr")).forEach((function(e){var t=i.parseFile(e),n=babelHelpers.slicedToArray(t,2),r=n[0],a=n[1];i.values.set(r,a)}))}}))}},{key:"parseFile",value:function e(t){var i=this;var n=t.id.replace("wd-doc","");var a={id:n,name:t.querySelector('[data-role="name"]')?t.querySelector('[data-role="name"]').innerHTML:t.querySelector("span.f-wrap").innerHTML,node:t,buttonNode:t.querySelector('[data-role="button-insert"]'),image:{src:null,lowsrc:null,width:null,height:null}};var o=function e(){i.insertFile(n,t)};var s=t.querySelector(".f-wrap");if(s){s.addEventListener("click",o);s.style.cursor="pointer";s.title=r.Loc.getMessage("MPF_FILE")}var l=t.querySelector("img");if(l){l.addEventListener("click",o);l.title=r.Loc.getMessage("MPF_FILE");l.style.cursor="pointer";a.image.lowsrc=l.lowsrc||l.src;a.image.src=l.rel||l.src;a.image.width=l.getAttribute("data-bx-full-width");a.image.height=l.getAttribute("data-bx-full-height")}if(t instanceof HTMLTableRowElement&&t.querySelector(".files-info")){if(!a.buttonNode){a.buttonNode=r.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n<span type="button" onclick="','" data-role="button-insert" class="insert-btn">\n\t<span data-role="insert-btn" class="insert-btn-text">','</span>\n\t<span data-role="in-text-btn" class="insert-btn-text">',"</span>\n</span>"])),o,r.Loc.getMessage("MPF_FILE_INSERT_IN_TEXT"),r.Loc.getMessage("MPF_FILE_IN_TEXT"));t.querySelector(".files-info").appendChild(a.buttonNode);this.checkButtonsDebounced()}}return[n,a]}},{key:"buildHTML",value:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var r=this.htmlEditor.SetBxTag(false,{tag:this.id,fileId:t});var a='<span data-bx-file-id="'.concat(t,'" id="').concat(r,'" style="color: #2067B0; border-bottom: 1px dashed #2067B0; margin:0 2px;">').concat(i.name,"</span>");if(i.image.src){var o=[];if(n){o.push('style="width:'.concat(n.width,"px;height:").concat(n.height,'px;"'))}else if(i.image.width&&i.image.height){o.push('style="width:'.concat(i.image.width,"px;height:").concat(i.image.height,'px;" '));o.push("onload=\"this.style.width='auto';this.style.height='auto';\"")}a='<img style="max-width: 90%;"  data-bx-file-id="'.concat(t,'" id="').concat(r,'" src="').concat(i.image.src,'" lowsrc="').concat(i.image.lowsrc,'" ').concat(o.join(" "),"/>")}return a}},{key:"buildText",value:function e(t,i){return"[FILE ID=".concat(t).concat(i||"","]")}},{key:"insertFile",value:function e(i,n){var r=this.values.get(String(i));if(r){t.EventEmitter.emit(this.editor.getEventObject(),"OnInsertContent",[this.buildText(i),this.buildHTML(i,r)])}}},{key:"deleteFile",value:function e(t){var i=this.htmlEditor.GetContent();if(this.htmlEditor.GetViewMode()==="wysiwyg"){var n=this.htmlEditor.GetIframeDoc();for(var r in this.htmlEditor.bxTags){if(this.htmlEditor.bxTags.hasOwnProperty(r)&&babelHelpers["typeof"](this.htmlEditor.bxTags[r])==="object"&&this.htmlEditor.bxTags[r]["tag"]===this.id&&t.indexOf(String(this.htmlEditor.bxTags[r]["fileId"]))>=0&&n.getElementById(r)){var a=n.getElementById(r);a.parentNode.removeChild(a)}}this.htmlEditor.SaveContent()}else{var o=i.replace(this.regexp,(function(e,i){return t.indexOf(i)>=0?"":e}));this.htmlEditor.SetContent(o);this.htmlEditor.Focus()}}},{key:"checkButtons",value:function e(t){var i=t?t.compatData[0]:this.htmlEditor.GetContent();var n=babelHelpers.toConsumableArray(i.matchAll(this.regexp)).map((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],n=t[1];return n}));this.values.forEach((function(e,t){if(!e.buttonNode){return}var i=n.indexOf(t)>=0;if(i===true&&e.buttonNode.className!=="insert-text"){e.buttonNode.className="insert-text";e.buttonNode.querySelector('[data-role="insert-btn"]').style.display="none";e.buttonNode.querySelector('[data-role="in-text-btn"]').style.display=""}else if(i!==true&&e.buttonNode.className!=="insert-btn"){e.buttonNode.className="insert-btn";e.buttonNode.querySelector('[data-role="insert-btn"]').style.display="";e.buttonNode.querySelector('[data-role="in-text-btn"]').style.display="none"}}))}},{key:"reinit",value:function e(t,i){this.values.forEach((function(e,t){if(e.node&&e.node.parentNode){e.node.parentNode.removeChild(e.node)}}));this.values.clear();this.controllers.forEach((function(e){e.reinitFrom(i)}))}},{key:"parse",value:function e(t){if(!this.regexp.test(t)){return t}t=t.replace(this.regexp,function(e,t,i,n){if(this.values.has(t)){return this.buildHTML(t,this.values.get(t),i>0&&n>0?{width:i,height:n}:null)}return e}.bind(this));return t}},{key:"unparse",value:function e(t,i){var n=i.node;var r=parseInt(n.hasAttribute("width")?n.getAttribute("width"):0);var a=parseInt(n.hasAttribute("height")?n.getAttribute("height"):0);var o="";if(r>0&&a>0){o=" WIDTH="+r+" HEIGHT="+a}var s=n.getAttribute("data-bx-file-id");return this.buildText(s,o)}}]);return i}(a);var f=function(e){babelHelpers.inherits(i,e);function i(e,n){var r;babelHelpers.classCallCheck(this,i);r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e,n));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"id","uploadimage");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"buttonParams",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"regexp",/\[IMAGE ID=((?:\s|\S)*?)?\]/gi);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"values",new Map);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"controllers",new Map);r.init();console.log("PostImage: ");t.EventEmitter.subscribe(e.getEventObject(),"onReinitializeBefore",(function(e){var t=babelHelpers.slicedToArray(e.data,2),i=t[0],n=t[1];r.reinit(i,n)}));return r}babelHelpers.createClass(i,[{key:"init",value:function e(){var i=this;Array.from(this.editor.getContainer().querySelectorAll(".file-selectdialog")).forEach((function(e){var n=e.id.replace("file-selectdialog-","");var r=i.controllers.get(n);if(!r){r=new l(n,e,i.editor);t.EventEmitter.subscribe(e.parentNode,"OnFileUploadSuccess",(function(t){var r=babelHelpers.slicedToArray(t.data,2),a=r[0].element_id,o=r[1],s=o.id,l=o.doc_prefix,d=o.CID;if(n===s){var c=document.querySelector("#"+i.editor.getFormId())?document.querySelector("#"+i.editor.getFormId()).querySelector("#upload-cid"):null;if(c){c.value=d}var u=i.parseFile(e.querySelector("#"+l+a)),f=babelHelpers.slicedToArray(u,2),p=f[0],h=f[1];i.values.set(p,h)}}));t.EventEmitter.subscribe(e.parentNode,"OnFileUploadRemove",(function(e){var t=babelHelpers.slicedToArray(e.compatData,2),r=t[0],a=t[1].id;if(n===a&&i.values.has(r)){i.values["delete"](r)}}))}if(e.querySelector("table.files-list")){Array.from(e.querySelector("table.files-list").querySelectorAll("tr")).forEach((function(e){var t=i.parseFile(e),n=babelHelpers.slicedToArray(t,2),r=n[0],a=n[1];i.values.set(r,a)}))}}))}},{key:"parseFile",value:function e(t){var i=t.id.replace("wd-doc","");var n={id:i,name:t.querySelector('[data-role="name"]')?t.querySelector('[data-role="name"]').innerHTML:t.querySelector("span.f-wrap").innerHTML,node:t,image:{src:null,lowsrc:null,width:null,height:null}};return[i,n]}},{key:"reinit",value:function e(t,i){this.values.forEach((function(e,t){if(e.node&&e.node.parentNode){e.node.parentNode.removeChild(e.node)}}));this.values.clear();this.controllers.forEach((function(e){e.reinitFrom(i)}))}},{key:"parse",value:function e(t){return t}},{key:"unparse",value:function e(t,i){var n=i.node;return""}}]);return i}(a);var p;var h=function(e){babelHelpers.inherits(i,e);function i(){var e;var t;babelHelpers.classCallCheck(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++){r[a]=arguments[a]}t=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(i)).call.apply(e,[this].concat(r)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"id","diskfile");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"regexp",/\[(?:DOCUMENT ID|DISK FILE ID)=([n0-9]+)\]/gi);return t}babelHelpers.createClass(i,[{key:"init",value:function e(){var i=this;Array.from(this.editor.getContainer().querySelectorAll(".diskuf-selectdialog")).forEach((function(e,n){var r=e.id.replace("diskuf-selectdialog-","");var a=i.controllers.get(r);if(!a){a=new d(r,e,i.editor);i.controllers.set(r,a);t.EventEmitter.subscribe(e.parentNode,"OnFileUploadSuccess",(function(t){var n=babelHelpers.slicedToArray(t.data,3),r=n[0].element_id,o=n[1].CID,s=n[2];if(a.getId()!==o||i.values.has(r)){return}var l=i.parseFile(e.querySelector("#disk-edit-attach"+r)),d=babelHelpers.slicedToArray(l,3),c=d[0],u=d[1],f=d[2];i.values.set(c,f);if(c!==u){i.values.set(u,f)}if(s&&s["insertImageAfterUpload"]&&f.image.src){i.insertFile(c,f.node)}}));t.EventEmitter.subscribe(e.parentNode,"OnFileUploadRemove",(function(e){var t=babelHelpers.slicedToArray(e.compatData,2),n=t[0],r=t[1].CID;if(a.getId()===r&&i.values.has(n)){var o=i.values.get(n);i.values["delete"](o.id);i.values["delete"](o.fileId);i.deleteFile([o.id,o.fileId])}}));t.EventEmitter.subscribe(e.parentNode,"OnFileUploadFailed",(function(e){var t=babelHelpers.slicedToArray(e.compatData,3),n=t[0],r=t[1].CID,o=t[2];if(a.getId()===r&&o&&o["referrerToEditor"]){BX.onCustomEvent(o["referrerToEditor"],"OnImageDataUriCaughtFailed",[]);BX.onCustomEvent(i.editor,"OnImageDataUriCaughtFailed",[o["referrerToEditor"]])}}));if(n===0){b(i,a,e,i.editor);m(i,a,e,i.editor);t.EventEmitter.subscribe(i.editor.getEventObject(),"onFilesHaveCaught",(function(e){e.stopImmediatePropagation();a.diskUfUploader.onChange(babelHelpers.toConsumableArray(e.getData()))}))}}if(e.querySelector("table.files-list")){Array.from(e.querySelector("table.files-list").querySelectorAll("tr")).forEach((function(e){var t=i.parseFile(e),n=babelHelpers.slicedToArray(t,3),r=n[0],a=n[1],o=n[2];i.values.set(r,o);if(r!==a){i.values.set(a,o)}}))}}))}},{key:"parseFile",value:function e(t){var i=this;var n=String(t.id.replace("disk-edit-attach",""));var a={id:n,name:t.querySelector('[data-role="name"]')?t.querySelector('[data-role="name"]').innerHTML:t.querySelector("span.f-wrap").innerHTML,fileId:t.getAttribute("bx-attach-file-id"),node:t,buttonNode:t.querySelector('[data-role="button-insert"]'),image:{src:null,lowsrc:null,width:null,height:null}};var o=t.querySelector(".f-wrap");var s=function e(){i.insertFile(n,t)};if(o){o.addEventListener("click",s);o.style.cursor="pointer";o.title=r.Loc.getMessage("MPF_FILE")}var l=t.querySelector("img.files-preview");if(l&&(l.src.indexOf("bitrix/tools/disk/uf.php")>=0||l.src.indexOf("/disk/showFile/")>=0)){l.addEventListener("click",s);l.title=r.Loc.getMessage("MPF_FILE");l.style.cursor="pointer";a.image.lowsrc=l.lowsrc||l.src;a.image.src=(l.rel||l.getAttribute("data-bx-src")||l.src).replace(/&(width|height)=\d+/gi,"");var d=function e(){a.image.width=l.getAttribute("data-bx-full-width");a.image.height=l.getAttribute("data-bx-full-height")};l.addEventListener("load",d);if(l.complete){d()}}if(t instanceof HTMLTableRowElement&&!a.buttonNode){a.buttonNode=r.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n<span class="insert-btn" data-role="button-insert" onclick="','">\n\t<span data-role="insert-btn" class="insert-btn-text">','</span>\n\t<span data-role="in-text-btn" class="insert-btn-text" style="display: none;">',"</span>\n</span>"])),s,r.Loc.getMessage("MPF_FILE_INSERT_IN_TEXT"),r.Loc.getMessage("MPF_FILE_IN_TEXT"));setTimeout((function(){if(t.querySelector(".files-info")){t.querySelector(".files-info").appendChild(a.buttonNode);i.checkButtonsDebounced()}}))}return[n,a.fileId,a]}},{key:"buildText",value:function e(t,i){return"[DISK FILE ID=".concat(t).concat(i||"","]")}}]);return i}(u);function b(e,i,n,r){t.EventEmitter.subscribe(r.getEventObject(),"OnVideoHasCaught",(function(r){var a=r.getData();var o=function i(r){var o=babelHelpers.slicedToArray(r.data,3),s=o[0].element_id;babelHelpers.objectDestructuringEmpty(o[1]);var l=o[2];if(a===l&&e.values.has(s)){t.EventEmitter.unsubscribe(n.parentNode,"OnFileUploadSuccess",i);e.insertFile(s,e.values.get(s).node)}};t.EventEmitter.subscribe(n.parentNode,"OnFileUploadSuccess",o);i.exec((function(){i.diskUfUploader.onChange([a])}));r.stopImmediatePropagation()}))}function m(e,i,n,r){t.EventEmitter.subscribe(r.getEventObject(),"OnImageHasCaught",(function(r){r.stopImmediatePropagation();var a=r.getData();return new Promise((function(o,s){var l=function i(r){var s=babelHelpers.slicedToArray(r.data,3),l=s[0].element_id;babelHelpers.objectDestructuringEmpty(s[1]);var c=s[2];if(a===c&&e.values.has(l)){t.EventEmitter.unsubscribe(n.parentNode,"OnFileUploadSuccess",i);t.EventEmitter.unsubscribe(n.parentNode,"OnFileUploadFailed",d);var u=e.values.get(l);var f=e.buildHTML(l,u);o({image:u.image,html:f})}};var d=function e(i){var r=babelHelpers.slicedToArray(i.data,3),o=r[0];babelHelpers.objectDestructuringEmpty(r[1]);var d=r[2];if(a===d){t.EventEmitter.unsubscribe(n.parentNode,"OnFileUploadSuccess",l);t.EventEmitter.unsubscribe(n.parentNode,"OnFileUploadFailed",e);s()}};t.EventEmitter.subscribe(n.parentNode,"OnFileUploadSuccess",l);t.EventEmitter.subscribe(n.parentNode,"OnFileUploadFailed",d);i.exec((function(){i.diskUfUploader.onChange([r.getData()])}))}))}))}function v(e,t,i){if(e==="Spoiler"){return new o(t,i)}else if(e==="MentionUser"){return new s(t,i)}else if(e==="UploadImage"){return new f(t,i)}else if(e==="UploadFile"){return new u(t,i)}else if(babelHelpers["typeof"](e)==="object"&&e["disk_file"]){return new h(t,i)}return null}function E(e,t){if(!t){return}BX.addCustomEvent(t,"onAutoSavePrepare",(function(t){t.FORM.setAttribute("bx-lhe-autosave-prepared","Y");setTimeout((function(){BX.addCustomEvent(e,"OnContentChanged",(function(e){t["mpfTextContent"]=e;t.Init()}))}),1500)}));BX.addCustomEvent(t,"onAutoSave",(function(e,t){if(BX.type.isNotEmptyString(e["mpfTextContent"]))t["text"]=e["mpfTextContent"]}));BX.addCustomEvent(t,"onAutoSaveRestore",(function(t,i){if(i["text"]&&/[^\s]+/gi.test(i["text"])){e.CheckAndReInit(i["text"])}}));if(t.hasAttribute("bx-lhe-autosave-prepared")&&t.BXAUTOSAVE){t.removeAttribute("bx-lhe-autosave-prepared");setTimeout(t.BXAUTOSAVE.Prepare,100)}}function g(e,t,i){var n=false;if(i.showPanelEditor!==true&&i.showPanelEditor!==false){i.showPanelEditor=!t.toolbar.IsShown();n=true}e.exec((function(){var n=e.getContainer().querySelector('[data-bx-role="button-show-panel-editor"]');if(i.showPanelEditor){t.dom.toolbarCont.style.opacity="inherit";t.toolbar.Show();if(n){n.classList.add("feed-add-post-form-btn-active")}}else{t.toolbar.Hide();if(n){n.classList.remove("feed-add-post-form-btn-active")}}}));if(n!==false){BX.userOptions.save("main.post.form","postEdit","showBBCode",i.showPanelEditor?"Y":"N")}}function y(e,t){if(!(t.urlPreviewId&&window["BXUrlPreview"]&&BX(t.urlPreviewId))){return}var i=new BXUrlPreview(BX(t.urlPreviewId));var n=function e(t){i.attachUrlPreview({url:t})};var r=function e(t,n,r,a){if(n==="createLink"&&BX.type.isPlainObject(a)&&a.hasOwnProperty("href")){i.attachUrlPreview({url:a.href})}};BX.addCustomEvent(e,"OnAfterUrlConvert",n);BX.addCustomEvent(e,"OnAfterLinkInserted",n);BX.addCustomEvent(e,"OnBeforeCommandExec",r);BX.addCustomEvent(e,"OnReinitialize",(function(e,t){i.detachUrlPreview();var n;for(var r in t){if(t.hasOwnProperty(r)&&t[r].hasOwnProperty("USER_TYPE_ID")&&t[r]["USER_TYPE_ID"]==="url_preview"){n=t[r]["VALUE"];break}}if(n){i.attachUrlPreview({id:n})}}))}function w(e,t){e.exec((function(){t.contextMenu.items["postimage"]=t.contextMenu.items["postdocument"]=t.contextMenu.items["postfile"]=[{TEXT:r.Loc.getMessage("BXEdDelFromText"),bbMode:true,ACTION:function e(){var i=t.contextMenu.GetTargetItem("postimage");if(!i)i=t.contextMenu.GetTargetItem("postdocument");if(!i)i=t.contextMenu.GetTargetItem("postfile");if(i&&i.element){t.selection.RemoveNode(i.element)}t.contextMenu.Hide()}}];if(t.toolbar.controls&&t.toolbar.controls.FontSelector){t.toolbar.controls.FontSelector.SetWidth(45)}}))}function B(e){var i=document.querySelector("#lhe_button_submit_"+e.getFormId());if(i){i.addEventListener("click",(function(i){t.EventEmitter.emit(e.getEventObject(),"OnButtonClick",["submit"]);i.preventDefault();i.stopPropagation()}))}var n=document.querySelector("#lhe_button_cancel_"+e.getFormId());if(n){n.addEventListener("click",(function(i){t.EventEmitter.emit(e.getEventObject(),"OnButtonClick",["cancel"]);i.preventDefault();i.stopPropagation()}))}}function I(e,i){var n=e.getContainer().querySelector('[data-bx-role="toolbar"]');if(n.querySelector('[data-id="file"]')){var r=n.querySelector('[data-id="file"]');if(r){r.addEventListener("click",(function(){t.EventEmitter.emit(e.getEventObject(),"onShowControllers",r.hasAttribute("data-bx-button-status")?"hide":"show")}));t.EventEmitter.subscribe(e.getEventObject(),"onShowControllers",(function(e){var t=e.data;if(t.toString()==="show"){r.setAttribute("data-bx-button-status","active")}else{r.removeAttribute("data-bx-button-status")}}));r.setAttribute("data-bx-files-count",0);t.EventEmitter.subscribe(e.getEventObject(),"onShowControllers:File:Increment",(function(e){var t=e.data;var i=t>0?t:1;var n=Math.max(parseInt(r.getAttribute("data-bx-files-count")||0)+i,0);if(n>0){if(!r["counterObject"]){r["counterObject"]=new BX.UI.Counter({value:n,color:BX.UI.Counter.Color.GRAY,animate:true});var a=r.querySelector("span");a.appendChild(r["counterObject"].getContainer())}else{r["counterObject"].update(n)}}r.setAttribute("data-bx-files-count",n)}));t.EventEmitter.subscribe(e.getEventObject(),"onShowControllers:File:Decrement",(function(e){var t=e.data;var i=t>0?t:1;var n=Math.max(parseInt(r.getAttribute("data-bx-files-count")||0)-i,0);r.setAttribute("data-bx-files-count",n);if(r["counterObject"]){r["counterObject"].update(n)}}))}}if(n.querySelector('[data-id="search-tag"]')){window["BXPostFormTags_"+e.getFormId()]=new BXPostFormTags(e.getFormId(),n.querySelector('[data-id="search-tag"]'))}if(n.querySelector('[data-id="create-link"]')){n.querySelector('[data-id="create-link"]').addEventListener("click",(function(e){i.toolbar.controls.InsertLink.OnClick(e)}))}if(n.querySelector('[data-id="video"]')){n.querySelector('[data-id="video"]').addEventListener("click",(function(e){i.toolbar.controls.InsertVideo.OnClick(e)}))}if(n.querySelector('[data-id="quote"]')){var a=n.querySelector('[data-id="quote"]');a.setAttribute("data-bx-type","action");a.setAttribute("data-bx-action","quote");a.addEventListener("mousedown",(function(e){i.toolbar.controls.Quote.OnMouseDown.apply(i.toolbar.controls.Quote,[e]);i.CheckCommand(a)}))}if(e.getContainer().querySelector('[data-bx-role="button-show-panel-editor"]')){e.getContainer().querySelector('[data-bx-role="button-show-panel-editor"]').addEventListener("click",(function(){e.showPanelEditor()}))}}var S;var C;function T(e,t){if(!C){C=new IntersectionObserver((function(e){e.forEach((function(e){if(e.isIntersecting){C.unobserve(e.target);var t=e.target.observedCallback;delete e.target.observedCallback;setTimeout(t)}}))}),{threshold:0})}e.observedCallback=t;C.observe(e)}var P=0;var O=function(){function e(t,i){babelHelpers.classCallCheck(this,e);this.container=i.querySelector('[data-bx-role="toolbar"]');this.adjustMorePosition=this.adjustMorePosition.bind(this);this.moreItem=i.querySelector('[data-bx-role="toolbar-item-more"]');this.moreItem.addEventListener("click",this.showSubmenu.bind(this));T(this.container,this.adjustMorePosition);window.addEventListener("resize",this.adjustMorePosition)}babelHelpers.createClass(e,[{key:"insertAfter",value:function e(t,i){if(!r.Type.isElementNode(t["BODY"])&&!r.Type.isStringFilled(t["BODY"])){return}var n=r.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['<div class="main-post-form-toolbar-button" data-bx-role="toolbar-item"></div>'])));if(r.Type.isElementNode(t["BODY"])){n.appendChild(t["BODY"])}else{n.innerHTML=t["BODY"]}if(t["ID"]){n.setAttribute("data-id",t["ID"])}if(i!==null){var a=false;var o=null;Array.from(this.container.querySelectorAll('[data-bx-role="toolbar-item"]')).forEach((function(e){if(a===true&&o===null){o=e}else if(a===false&&e&&e.dataset&&e.dataset.id===i){a=true}}));if(o){o.parentNode.insertBefore(n,o)}}if(!n.parentNode){this.container.appendChild(n)}this.adjustMorePosition()}},{key:"getItems",value:function e(){return Array.from(this.container.querySelectorAll('[data-bx-role="toolbar-item"]'))}},{key:"getVisibleItems",value:function e(){var t=this;var i=[];Array.from(this.container.querySelectorAll('[data-bx-role="toolbar-item"]')).forEach((function(e){if(e.offsetTop>t.container.clientHeight/2){i.push(e)}}));return i}},{key:"getHiddenItems",value:function e(){var t=[];Array.from(this.container.querySelectorAll('[data-bx-role="toolbar-item"]')).forEach((function(e){if(e.offsetTop>0){t.push(e)}}));return t}},{key:"adjustMorePosition",value:function e(){var t=this.getVisibleItems().length;if(t<=0||t>=this.getItems().length){this.moreItem.style.display="none"}else{this.moreItem.style.display=""}}},{key:"getPopup",value:function e(){var t=this;if(!this.popup){this.popup=n.PopupManager.create({id:"main_post_form_toolbar_"+P++,className:"main-post-form-toolbar-popup",cacheable:false,content:this.getPopupContainer(),closeByEsc:true,autoHide:true,angle:true,bindElement:this.moreItem,offsetTop:-5,offsetLeft:5,events:{onClose:function e(){Array.from(t.getPopupContainer().querySelectorAll('[data-bx-role="toolbar-item"]')).forEach((function(e){t.container.appendChild(e)}));delete t.popup}}})}return this.popup}},{key:"getPopupContainer",value:function e(){if(!this.popupContainer){this.popupContainer=document.createElement("DIV")}return this.popupContainer}},{key:"showSubmenu",value:function e(){var t=this;var i=this.getHiddenItems();if(i.length<=0){return}i.forEach((function(e){t.getPopupContainer().appendChild(e)}));this.getPopup().show()}}]);return e}();var x=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"showPopup",value:function e(t){var i=n.PopupManager.getPopupById(this.getPopupId());if(!i){i=new n.Popup(this.getPopupId(),null,{content:this.getTasksLimitPopupContent(),lightShadow:false,offsetLeft:20,autoHide:false,angle:{position:"bottom"},closeByEsc:false,closeIcon:true})}i.setBindElement(t.bindPosition);i.show()}},{key:"getPopupId",value:function e(){return"bx-post-mention-tasks-limit-popup"}},{key:"getTasksLimitPopupContent",value:function e(){return r.Dom.create("DIV",{style:{width:"400px",padding:"10px"},children:[r.Dom.create("SPAN",{html:r.Loc.getMessage("MPF_MENTION_TASKS_LIMIT").replace("#A_BEGIN#",'<a href="javascript:void(0);" onclick="BX.Main.PostFormTasksLimit.onClickTasksLimitPopupSlider();">').replace("#A_END#","</a>")})]})}},{key:"onClickTasksLimitPopupSlider",value:function e(){this.hidePopup();BX.UI.InfoHelper.show("limit_tasks_observers_participants",{isLimit:true,limitAnalyticsLabels:{module:"tasks",source:"postForm",subject:"auditor"}})}},{key:"hidePopup",value:function e(){var t=n.PopupManager.getPopupById(this.getPopupId());if(t){t.close()}}}]);return e}();function X(e,t,i){H(e,t);k(i,"get");return F(e,i)}function k(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function H(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function F(e,t){if(t.get){return t.get.call(e)}return t.value}var A=function(){function e(i,n){var a=this;babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"jobs",new Map);babelHelpers.defineProperty(this,"editorParams",{height:100,ctrlEnterHandler:null,parsers:null,showPanelEditor:false,lazyLoad:true,urlPreviewId:null,tasksLimitExceeded:false});babelHelpers.defineProperty(this,"actionQueue",[]);this.id=i["id"];this.name=i["name"];this.formId=i["formId"];this.eventNode=i.eventNode||document.querySelector("#div"+(this.name||this.id));this.eventNode.dataset.bxHtmlEditable="Y";this.formEntityType=null;e.repo.set(this.getId(),this);if(!r.Type.isArray(n.parsers)&&r.Type.isPlainObject(n.parsers)){n.parsers=Object.values(n.parsers)}this.setEditorParams(n);this.bindEvents(window["BXHtmlEditor"]?window["BXHtmlEditor"].Get(this.getId()):null);this.toolbar=new O(this.getEventObject(),this.getContainer());this.inited=true;if(this.name!==null){window[this.name]=this}BX.onCustomEvent(this,"onInitialized",[this,this.getFormId()]);t.EventEmitter.subscribe(this.getEventObject(),"OnFileUploadSuccess",(function(e){var t=e.compatData;BX.onCustomEvent(a.getEventObject(),"onFileIsAdded",t)}));t.EventEmitter.subscribe(this.getEventObject(),"onBusy",(function(e){var i=e.data;if(a.jobs.size<=0){t.EventEmitter.emit(a.getEventObject(),"onLHEIsBusy")}a.jobs.set(i,(a.jobs.get(i)||0)+1)}));t.EventEmitter.subscribe(this.getEventObject(),"onReady",(function(e){var i=e.data;if(a.jobs.size<=0||!a.jobs.has(i)){return}var n=a.jobs.get(i);if(n<=1){a.jobs["delete"](i);if(a.jobs.size<=0){t.EventEmitter.emit(a.getEventObject(),"onLHEIsReady")}}else{a.jobs.set(i,--n)}}))}babelHelpers.createClass(e,[{key:"setEditorParams",value:function e(t){this.editorParams=Object.assign(this.editorParams,t)}},{key:"bindEvents",value:function e(){var i=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;this.events={};[["OnEditorInitedBefore",this.OnEditorInitedBefore.bind(this)],["OnCreateIframeAfter",this.OnCreateIframeAfter.bind(this)],["OnEditorInitedAfter",this.OnEditorInitedAfter.bind(this)]].forEach((function(e){var t=babelHelpers.slicedToArray(e,2),r=t[0],a=t[1];if(!n){i.events[r]=function(e){if(e.id===i.getId()){
//!it important to use deprecated eventEmitter
BX.removeCustomEvent(r,i.events[r]);delete i.events[r];a(e)}};//!it important to use deprecated eventEmitter
BX.addCustomEvent(r,i.events[r])}else{a(n)}}));t.EventEmitter.subscribe(this.getEventObject(),"OnShowLHE",this.OnShowLHE.bind(this));t.EventEmitter.subscribe(this.getEventObject(),"OnButtonClick",this.OnButtonClick.bind(this));t.EventEmitter.subscribe(this.getEventObject(),"OnParserRegister",(function(e){var t=e.data;i.addParser(t)}));t.EventEmitter.subscribe(this.getEventObject(),"OnGetHTMLEditor",(function(e){var t=e.data;t.htmlEditor=i.getEditor()}));t.EventEmitter.subscribe(this.getEventObject(),"OnInsertContent",(function(e){var t=babelHelpers.slicedToArray(e.data,2),n=t[0],r=t[1];i.insertContent(n,r)}));t.EventEmitter.subscribe(this.getEventObject(),"OnAddButton",(function(e){var t=babelHelpers.slicedToArray(e.data,2),n=t[0],r=t[1];i.getToolbar().insertAfter(n,r)}));B(this)}},{key:"getId",value:function e(){return this.id}},{key:"setEditor",value:function i(n){var a=this;if(this.htmlEditor===n){return}this.htmlEditor=n;n.formID=this.getFormId();t.EventEmitter.subscribe(n,"OnCtrlEnter",(function(){n.SaveContent();if(r.Type.isFunction(a.editorParams.ctrlEnterHandler)){a.editorParams.ctrlEnterHandler()}else if(r.Type.isStringFilled(a.editorParams.ctrlEnterHandler)&&window[a.editorParams.ctrlEnterHandler]){window[a.editorParams.ctrlEnterHandler]()}else if(document.forms[a.getFormId()]){BX.submit(document.forms[a.getFormId()])}}));this.editorParams["height"]=n.config["height"];console.groupCollapsed("main.post.form: parsers: ",this.getId());this.editorParams.parsers.forEach((function(e){var t=v(e,a,n);if(t){console.groupCollapsed(e);console.log(t);if(t.hasButton()){n.AddButton(t.getButton())}n.AddParser(t.getParser());console.groupEnd(e)}}));console.groupEnd("main.post.form: parsers: ",this.getId());t.EventEmitter.subscribe(n,"OnImageDataUriHandle",(function(e){var i=babelHelpers.slicedToArray(e.compatData,2),r=i[0],o=i[1];var s=BX.UploaderUtils.dataURLToBlob(o.src);if(s&&s.size>0&&s.type.indexOf("image/")===0){t.EventEmitter.emit(a.getEventObject(),"onShowControllers","show");s.name=s.name||o.title||"image."+s.type.substr(6);s.referrerToEditor=o;t.EventEmitter.emit(a.getEventObject(),"OnImageHasCaught",new t.BaseEvent({data:s})).forEach((function(e){e.then((function(e){var i=e.image,r=e.html;t.EventEmitter.emit(n,"OnImageDataUriCaughtUploaded",new t.BaseEvent({compatData:[o,i,{replacement:r}]}))}))["catch"]((function(){t.EventEmitter.emit(n,"OnImageDataUriCaughtFailed",new t.BaseEvent({compatData:[o]}))}))}))}}));t.EventEmitter.subscribe(t.EventEmitter.GLOBAL_TARGET,"onAddVideoMessage",(function(e){var i=babelHelpers.slicedToArray(e.compatData,2),n=i[0],r=i[1];if(!r||a.getFormId()!==r){return}t.EventEmitter.emit(a.getEventObject(),"onShowControllers","show");t.EventEmitter.emit(a.getEventObject(),"OnVideoHasCaught",new t.BaseEvent({data:n}))}));(function(){var i=BX("micro"+(a.name||a.id));var n=false;var r=0;var o=function e(t){t.preventDefault();t.stopPropagation();if(r>0){clearTimeout(r);r=0}if(n===true){return}var o=t&&t["dataTransfer"]&&t["dataTransfer"]["types"]&&t["dataTransfer"]["types"].indexOf("Files")>=0;if(o){n=true;a.getContainer().classList.add("feed-add-post-dnd-over");if(i){i.classList.add("feed-add-post-micro-dnd-ready")}}return true};var s=function e(t){t.preventDefault();t.stopPropagation();if(r>0){clearTimeout(r)}r=setTimeout((function(){n=false;a.getContainer().classList.remove("feed-add-post-dnd-over");if(i){i.classList.remove("feed-add-post-micro-dnd-ready")}}),100);return false};var l=function e(i){s(i);if(i&&i["dataTransfer"]&&i["dataTransfer"]["types"]&&i["dataTransfer"]["types"].indexOf("Files")>=0&&i["dataTransfer"]["files"]&&i["dataTransfer"]["files"].length>0){t.EventEmitter.emit(a.getEventObject(),"OnShowLHE",new t.BaseEvent({compatData:["justShow",{onShowControllers:"show"}]}));t.EventEmitter.emit(a.getEventObject(),"onFilesHaveCaught",new t.BaseEvent({data:i["dataTransfer"]["files"]}))}return false};a.getContainer().addEventListener("dragover",o);a.getContainer().addEventListener("dragenter",o);a.getContainer().addEventListener("dragleave",s);a.getContainer().addEventListener("dragexit",s);a.getContainer().addEventListener("drop",l);a.getContainer().setAttribute("dropzone","copy f:*/*");if(!document.body.hasAttribute("dropzone")){document.body.setAttribute("dropzone","copy f:*/*");document.body.addEventListener("dragover",(function(e){e.preventDefault();e.stopPropagation();return true}));document.body.addEventListener("drop",function(i){i.preventDefault();i.stopPropagation();if(i&&i["dataTransfer"]&&i["dataTransfer"]["types"]&&i["dataTransfer"]["types"].indexOf("Files")>=0&&i["dataTransfer"]["files"]&&i["dataTransfer"]["files"].length>0){var n;var r;var a=X(this.constructor,e,D).keys();while((r=a.next())&&r.done!==true&&r.value){n=r.value}if(n){t.EventEmitter.emit(n.getEventObject(),"OnShowLHE",new t.BaseEvent({compatData:["justShow",{onShowControllers:"show"}]}));t.EventEmitter.emit(n.getEventObject(),"onFilesHaveCaught",new t.BaseEvent({data:i["dataTransfer"]["files"]}))}}return false}.bind(a))}if(i){i.addEventListener("dragenter",(function(e){o(e);t.EventEmitter.emit(a.getEventObject(),"OnShowLHE",new t.BaseEvent({compatData:["justShow",{onShowControllers:"show"}]}))}))}t.EventEmitter.subscribe(a.getEditor(),"OnIframeDrop",(function(e){var t=babelHelpers.slicedToArray(e.data,1),i=t[0];return l(i)}));t.EventEmitter.subscribe(a.getEditor(),"OnIframeDragOver",(function(e){var t=babelHelpers.slicedToArray(e.data,1),i=t[0];return o(i)}));t.EventEmitter.subscribe(a.getEditor(),"OnIframeDragLeave",(function(e){var t=babelHelpers.slicedToArray(e.data,1),i=t[0];return s(i)}))})();t.EventEmitter.subscribe(n,"OnInsertContent",(function(e){var t=babelHelpers.slicedToArray(e.data,2),i=t[0],n=t[1];a.insertContent(i,n)}));g(this,n,this.editorParams);y(n,this.editorParams);w(this,n);E(n,BX(this.getFormId()));I(this,n);t.EventEmitter.subscribe(this.getEventObject(),"OnAfterShowLHE",(function(){a.getEditor().AllowBeforeUnloadHandler()}));t.EventEmitter.subscribe(this.getEventObject(),"OnAfterHideLHE",(function(){x.hidePopup();a.getEditor().DenyBeforeUnloadHandler()}));t.EventEmitter.subscribe(n,"OnIframeClick",(function(){var e=new MouseEvent("click",{bubbles:true,cancelable:true,view:window});n.iframeView.container.dispatchEvent(e)}))}},{key:"getEditor",value:function e(){return this.htmlEditor}},{key:"getFormId",value:function e(){return this.formId}},{key:"getEventObject",value:function e(){return this.eventNode}},{key:"getContainer",value:function e(){return this.eventNode}},{key:"getToolbar",value:function e(){return this.toolbar}},{key:"OnEditorInitedBefore",value:function e(t){this.setEditor(t)}},{key:"OnCreateIframeAfter",value:function e(){if(this.editorIsLoaded!==true){this.editorIsLoaded=true;this.exec();t.EventEmitter.emit(this,"OnEditorIsLoaded",[])}}},{key:"OnEditorInitedAfter",value:function e(i){if(!this.editorParams.lazyLoad){t.EventEmitter.emit(this.getEventObject(),"OnShowLHE",new t.BaseEvent({compatData:["justShow",i,false]}))}if(i.sandbox&&i.sandbox.inited){this.OnCreateIframeAfter()}}},{key:"addParser",value:function e(t){var i=this;this.exec((function(){t.init(i.getEditor());i.getEditor().AddParser({name:t.id,obj:{Parse:function e(i,n){return t.parse(n)},UnParse:t.unparse}});if(!i["addParserAfterDebounced"]){i.addParserAfterDebounced=r.Runtime.debounce((function(){i.getEditor().SetContent(i.getEditor().GetContent().replace(/&#91;/gi,"[").replace(/&#93;/gi,"]"),true)}),100)}i.addParserAfterDebounced()}))}},{key:"insertContent",value:function e(t){var i=this;var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;this.exec((function(){var e=i.getEditor().GetViewMode();if(e==="wysiwyg"){i.getEditor().InsertHtml(n||t);setTimeout(i.getEditor().AutoResizeSceleton.bind(i.getEditor()),500);setTimeout(i.getEditor().AutoResizeSceleton.bind(i.getEditor()),1e3)}else{i.getEditor().textareaView.Focus();if(!i.getEditor().bbCode){var r=i.getEditor().GetIframeDoc();var a=r.createElement("DIV");a.style.display="none";a.innerHTML=t;r.body.appendChild(a);t=i.getEditor().Parse(t,true,false);a.parentNode.removeChild(a)}i.getEditor().textareaView.WrapWith("","",t)}}))}},{key:"reinit",value:function e(i,n){var a="hide";if(r.Type.isPlainObject(n)&&Object.values(n).length){Object.values(n).forEach((function(e){if(e&&e["VALUE"]){a="show"}}))}t.EventEmitter.emit(this.getEventObject(),"onShowControllers",a);t.EventEmitter.emit(this.getEventObject(),"onReinitializeBefore",[i,n]);this.getEditor().CheckAndReInit(r.Type.isString(i)?i:"");BX.onCustomEvent(this.getEditor(),"onReinitialize",[this,i,n]);if(this.editorParams["height"]){this.oEditor.SetConfigHeight(this.editorParams["height"]);this.oEditor.ResizeSceleton()}}},{key:"OnShowLHE",value:function i(n){var a=this;var o=n.data,s=n.compatData;var l=o||s,d=babelHelpers.slicedToArray(l,3),c=d[0],u=d[1],f=d[2];if(!this.getEditor()&&window["BXHtmlEditor"]){window["BXHtmlEditor"].Get(this.getId()).Init()}c=c===false||c==="hide"||c==="justShow"?c:true;var p=BX("micro"+(this.name||this.id));if(p){p.style.display=c===true||c==="justShow"?"none":"block"}if(c==="hide"){X(this.constructor,e,D)["delete"](this);t.EventEmitter.emit(this.getEventObject(),"OnBeforeHideLHE");if(this.getContainer().style.display==="none"){t.EventEmitter.emit(this.getEventObject(),"OnAfterHideLHE");t.EventEmitter.emit(this.getEventObject(),"onShowControllers","hide")}else{new BX["easing"]({duration:200,start:{opacity:100,height:this.getContainer().scrollHeight},finish:{opacity:0,height:20},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function e(t){a.getContainer().style.height=t.height+"px";a.getContainer().style.opacity=t.opacity/100},complete:function e(){a.getContainer().style.cssText="";a.getContainer().style.display="none";t.EventEmitter.emit(a.getEventObject(),"OnAfterHideLHE");t.EventEmitter.emit(a.getEventObject(),"onShowControllers","hide")}}).animate()}}else if(c){X(this.constructor,e,D).set(this);this.formEntityType=r.Type.isArray(f)&&r.Type.isStringFilled(f[0])&&f[0].match(/^TASK_(\d+)$/i)?"task":null;if(u&&r.Type.isPlainObject(u)){if(u["onShowControllers"]){t.EventEmitter.emit(this.getEventObject(),"onShowControllers",u["onShowControllers"])}}t.EventEmitter.emit(this.getEventObject(),"OnBeforeShowLHE");if(c==="justShow"||this.getContainer().style.display==="block"){this.getContainer().style.display="block";t.EventEmitter.emit(this.getEventObject(),"OnAfterShowLHE");if(u!==false){this.getEditor().Focus()}}else{r.Dom.adjust(this.getContainer(),{style:{display:"block",overflow:"hidden",height:"20px",opacity:.1}});new BX["easing"]({duration:200,start:{opacity:10,height:20},finish:{opacity:100,height:this.getContainer().scrollHeight},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function e(t){a.getContainer().style.height=t.height+"px";a.getContainer().style.opacity=t.opacity/100},complete:function e(){t.EventEmitter.emit(a.getEventObject(),"OnAfterShowLHE");a.getEditor().Focus();a.getContainer().style.cssText=""}}).animate()}}else{X(this.constructor,e,D)["delete"](this);t.EventEmitter.emit(this.getEventObject(),"OnBeforeHideLHE");t.EventEmitter.emit(this.getEventObject(),"onShowControllers","hide");this.getContainer().style.display="none";t.EventEmitter.emit(this.getEventObject(),"OnAfterHideLHE")}}},{key:"OnButtonClick",value:function e(i){var n=babelHelpers.slicedToArray(i.data,1),r=n[0];if(r!=="cancel"){var a={result:true};t.EventEmitter.emit(this.getEventObject(),"OnClickBeforeSubmit",new t.BaseEvent({compatData:[this,a]}));if(a["result"]!==false){t.EventEmitter.emit(this.getEventObject(),"OnClickSubmit",new t.BaseEvent({compatData:[this]}))}}else{t.EventEmitter.emit(this.getEventObject(),"OnClickCancel",new t.BaseEvent({compatData:[this]}));t.EventEmitter.emit(this.getEventObject(),"OnShowLHE",new t.BaseEvent({compatData:["hide"]}))}}},{key:"exec",value:function e(t,i){if(typeof t=="function"){this.actionQueue.push([t,i])}if(this.editorIsLoaded===true){var n;while((n=this.actionQueue.shift())&&n){n[0].apply(this,n[1])}}}},{key:"showPanelEditor",value:function e(){g(this,this.getEditor(),{})}},{key:"getContent",value:function e(){return this.oEditor?this.oEditor.GetContent():""}},{key:"setContent",value:function e(t){if(this.getEditor()){this.getEditor().SetContent(t)}}},{key:"controllerInit",value:function e(i){t.EventEmitter.emit(this.getEventObject(),"onShowControllers",i==="hide"?"hide":"show")}},{key:"isReady",get:function e(){return this.editorIsLoaded}},{key:"oEditor",get:function e(){return this.getEditor()}},{key:"oEditorId",get:function e(){return this.getId()}},{key:"formID",get:function e(){return this.getFormId()}},{key:"params",get:function e(){return{formID:this.getFormId()}}},{key:"controllers",get:function e(){var i=new t.BaseEvent;var n={};i.setData(n);t.EventEmitter.emit(this.getEventObject(),"onCollectControllers",i);var a={};Object.keys(n).forEach((function(e){a[e]=Object.assign({},n[e]);a[e]["values"]={};if(r.Type.isArray(n[e]["values"])){n[e]["values"].forEach((function(t){a[e]["values"][t]={id:t}}))}else if(r.Type.isPlainObject(n[e]["values"])){a[e]["values"]=Object.assign({},n[e]["values"])}}));return a}},{key:"arFiles",get:function e(){var i=new t.BaseEvent;var n={};i.setData(n);t.EventEmitter.emit(this.getEventObject(),"onCollectControllers",i);var r={};Object.keys(n).forEach((function(e){if(n[e]["values"]){n[e]["values"].forEach((function(t){r[t]=[e]}))}}));return r}}]);return e}();babelHelpers.defineProperty(A,"repo",new Map);var D={writable:true,value:new Map};window["LHEPostForm"]={getEditor:function e(t){return window["BXHtmlEditor"]?window["BXHtmlEditor"].Get(babelHelpers["typeof"](t)=="object"?t.id:t):null},getHandler:function e(t){var i=r.Type.isStringFilled(t)?t:t.id;return A.repo.get(i)},getHandlerByFormId:function e(t){var i=null;A.repo.forEach((function(e){if(e.getFormId()===t){i=e}}));return i},reinitData:function e(t,i,n){var a={};if(!r.Type.isPlainObject(n)){n={}}Object.entries(n).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],n=t[1];if(r.Type.isPlainObject(n)&&n["USER_TYPE_ID"]&&n["VALUE"]&&Object.values(n["VALUE"]).length>0){a[i]=n}}));var o=this.getHandler(t);if(o&&(o.isReady||r.Type.isStringFilled(i)||Object.values(a).length>0)){o.exec(o.reinit,[i,a])}return false},reinitDataBefore:function e(i){var n=A.repo.get(i);if(n&&n.getEventObject()){t.EventEmitter.emit(n.getEventObject(),"onReinitializeBefore",[n])}}};e.PostForm=A;e.PostFormTasksLimit=x})(this.BX.Main=this.BX.Main||{},BX.Event,BX,BX.Main,BX);(function(){if(window["BXPostFormTags"])return;var e={selector:{},mentionParams:{}};window.BXPostFormTags=function(e,t){this.popup=null;this.formID=e;this.buttonID=t;this.sharpButton=null;this.addNewLink=null;this.tagsArea=null;this.hiddenField=null;this.popupContent=null;BX.ready(BX.proxy(this.init,this))};window.BXPostFormTags.prototype.init=function(){this.sharpButton=BX(this.buttonID);this.addNewLink=BX("post-tags-add-new-"+this.formID);this.tagsArea=BX("post-tags-block-"+this.formID);this.tagsContainer=BX("post-tags-container-"+this.formID);this.hiddenField=BX("post-tags-hidden-"+this.formID);this.popupContent=BX("post-tags-popup-content-"+this.formID);this.popupInput=BX.findChild(this.popupContent,{tag:"input"});var e=BX.findChildren(this.tagsContainer,{className:"feed-add-post-del-but"},true);for(var t=0,i=e.length;t<i;t++){BX.bind(e[t],"click",BX.proxy(this.onTagDelete,{obj:this,tagBox:e[t].parentNode,tagValue:e[t].parentNode.getAttribute("data-tag")}))}BX.bind(this.sharpButton,"click",BX.proxy(this.onButtonClick,this));BX.bind(this.addNewLink,"click",BX.proxy(this.onAddNewClick,this))};window.BXPostFormTags.prototype.onTagDelete=function(){BX.remove(this.tagBox);this.obj.hiddenField.value=this.obj.hiddenField.value.replace(this.tagValue+",","").replace("  "," ")};window.BXPostFormTags.prototype.show=function(){if(this.popup===null){this.popup=new BX.PopupWindow("bx-post-tag-popup",this.addNewLink,{content:this.popupContent,lightShadow:false,offsetTop:8,offsetLeft:10,autoHide:true,angle:true,closeByEsc:true,zIndex:-840,buttons:[new BX.PopupWindowButton({text:BX.message("TAG_ADD"),events:{click:BX.proxy(this.onTagAdd,this)}})]});BX.bind(this.popupInput,"keydown",BX.proxy(this.onKeyPress,this));BX.bind(this.popupInput,"keyup",BX.proxy(this.onKeyPress,this))}this.popup.show();BX.focus(this.popupInput)};window.BXPostFormTags.prototype.addTag=function(e){var t=BX.type.isNotEmptyString(e)?e.split(","):this.popupInput.value.split(",");var i=[];for(var n=0;n<t.length;n++){var r=BX.util.trim(t[n]);if(r.length>0){var a=this.hiddenField.value.split(",");if(!BX.util.in_array(r,a)){var o;var s=BX.create("span",{children:[o=BX.create("span",{attrs:{class:"feed-add-post-del-but"}})],attrs:{class:"feed-add-post-tags"}});s.insertBefore(document.createTextNode(r),o);this.tagsContainer.insertBefore(s,this.addNewLink);BX.bind(o,"click",BX.proxy(this.onTagDelete,{obj:this,tagBox:s,tagValue:r}));this.hiddenField.value+=r+",";i.push(r)}}}return i};window.BXPostFormTags.prototype.onTagAdd=function(){this.addTag();this.popupInput.value="";this.popup.close()};window.BXPostFormTags.prototype.onAddNewClick=function(e){e=e||window.event;this.show();BX.PreventDefault(e)};window.BXPostFormTags.prototype.onButtonClick=function(e){e=e||window.event;BX.show(this.tagsArea);this.show();BX.PreventDefault(e)};window.BXPostFormTags.prototype.onKeyPress=function(e){e=e||window.event;var t=e.keyCode?e.keyCode:e.which?e.which:null;if(t==13){setTimeout(BX.proxy(this.onTagAdd,this),0)}};window.BXPostFormImportant=function(e,t,i){if(i){this.formID=e;this.buttonID=t;this.inputName=i;this.fireButton=null;this.activeBlock=null;this.hiddenField=null;BX.ready(BX.proxy(this.init,this))}return false};window.BXPostFormImportant.prototype.init=function(){this.fireButton=BX(this.buttonID);this.activeBlock=BX(this.buttonID+"-active");var e=BX(this.formID);if(e){this.hiddenField=e[this.inputName];if(this.hiddenField&&this.hiddenField.value==1){this.showActive()}}BX.bind(this.fireButton,"click",BX.proxy((function(e){e=e||window.event;this.showActive();BX.PreventDefault(e)}),this));BX.bind(this.activeBlock,"click",BX.proxy((function(e){e=e||window.event;this.hideActive();BX.PreventDefault(e)}),this))};window.BXPostFormImportant.prototype.showActive=function(e){BX.hide(this.fireButton);BX.show(this.activeBlock,"inline-block");if(this.hiddenField){this.hiddenField.value=1}return false};window.BXPostFormImportant.prototype.hideActive=function(e){BX.hide(this.activeBlock);BX.show(this.fireButton,"inline-block");if(this.hiddenField){this.hiddenField.value=0}return false};var t=null;window.MPFbuttonShowWait=function(e){if(e&&!BX.type.isElementNode(e)){e=null}e=e||this;e=e?e.tagName=="A"?e:e.parentNode:e;if(e){BX.addClass(e,"ui-btn-clock");t=e;BX.defer((function(){e.disabled=true}))()}};var i={listen:false,plus:false,text:"",bSearch:false,node:null,mode:null};BX.addCustomEvent(window,"onInitialized",(function(e){if(e&&e.eventNode){BX.onCustomEvent(e.eventNode,"OnClickCancel",(function(){i.node=null}))}}));BX.addCustomEvent(window,"BX.MPF.MentionSelector:open",(function(t){var i=BX.Type.isStringFilled(t.formId)?t.formId:"";if(!BX.Type.isStringFilled(i)||BX.Type.isUndefined(e.mentionParams[i])){return}var n=BX.Type.isDomNode(t.bindNode)?t.bindNode:null;var r=BX.type.isNotEmptyObject(t.bindPosition)?t.bindPosition:null;var a=window.MPFgetSelectorId("bx-mention-"+i+"-id")+(n?"-withsearch":"");var o=BX.UI.EntitySelector.Dialog.getById(a);if(!o){window.MPFcreateSelectorDialog({formId:i,selectorId:a,enableSearch:!!n,params:e.mentionParams[i]});o=BX.UI.EntitySelector.Dialog.getById(a)}if(!o){return}o.deselectAll();o.search("");o.show();var s={};if(BX.Type.isDomNode(n)){o.focusSearch();o.popup.setBindElement(n);s.position="top"}else if(BX.type.isNotEmptyObject(r)){r.top-=5;o.popup.setBindElement(r)}o.popup.adjustPosition(s)}));window.onKeyDownHandler=function(e,t,r){var a=e.keyCode;if(!window["BXfpdStopMent"+r]){return true}var o=window.MPFgetSelectorId("bx-mention-"+r+"-id");if(a===t.KEY_CODES["backspace"]&&i.node){var s=BX.util.trim(t.util.GetTextContent(i.node));if(s==="+"||s==="@"||i.mode=="button"&&s.length==1){window["BXfpdStopMent"+r]()}else if(i.mode=="button"&&s.length==1){window["BXfpdStopMent"+r]()}}if(BX.util.in_array(a,[107,187])||(e.shiftKey||e.modifiers>3)&&BX.util.in_array(a,[50,43,61])||e.altKey&&BX.util.in_array(a,[76])||e.altKey&&e.ctrlKey&&BX.util.in_array(a,[81])&&e.key==="@"||e.altKey&&BX.util.in_array(a,[71,81])&&e.key==="@"||e.altKey&&BX.util.in_array(a,[50])&&e.key==="@"||BX.Type.isFunction(e.getModifierState)&&!!e.getModifierState("AltGraph")&&BX.util.in_array(a,[81,50,48])&&!BX.Type.isUndefined(e.key)&&e.key==="@"||BX.util.in_array(a,[192])&&e.key==="@"){setTimeout((function(){var e=t.selection.GetRange();var a=t.GetIframeDoc();var s=e?e.endContainer.textContent:"";var l=s?s.slice(e.endOffset-1,e.endOffset):"";var d=s?s.slice(e.endOffset-2,e.endOffset-1):"";if((l=="@"||l=="+")&&(!d||BX.util.in_array(d,["+","@",",","("])||d.length==1&&BX.util.trim(d)==="")){i.listen=true;i.listenFlag=true;i.text="";i.leaveContent=true;i.mode="plus";e.setStart(e.endContainer,e.endOffset-1);e.setEnd(e.endContainer,e.endOffset);t.selection.SetSelection(e);i.node=BX.create("SPAN",{props:{id:"bx-mention-node"}},a);t.selection.Surround(i.node,e);e.setStart(i.node,1);e.setEnd(i.node,1);t.selection.SetSelection(e);if(BX.Type.isStringFilled(o)){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{formId:r,bindPosition:n(i.node,t)}])}}}),10)}if(i.listen){var l=null;var d=BX.Type.isStringFilled(o)?BX.UI.EntitySelector.Dialog.getById(o):null;if(d&&d.getActiveTab()){l=d.getActiveTab().getId()}var c=null;switch(a){case t.KEY_CODES.enter:c="Enter";break;case 9:c="Tab";break;case t.KEY_CODES.up:c="ArrowUp";break;case t.KEY_CODES.down:c="ArrowDown";break;case t.KEY_CODES.left:if(l==="departments"){c="ArrowLeft"}break;case t.KEY_CODES.right:if(l==="departments"){c="ArrowRight"}break}if(c){var u=new KeyboardEvent("keydown",{key:c,keyCode:a,bubbles:true,cancelable:true,view:window});if(!document.dispatchEvent(u)){t.iframeKeyDownPreventDefault=true;e.stopPropagation();e.preventDefault()}}}if(!i.listen&&i.listenFlag&&a===t.KEY_CODES["enter"]){var f=t.selection.GetRange();if(f.collapsed){var p=f.endContainer;var h=t.GetIframeDoc();if(p){if(p.className!=="bxhtmled-metion"){p=BX.findParent(p,(function(e){return e.className=="bxhtmled-metion"}),h.body)}if(p&&p.className=="bxhtmled-metion"){t.selection.SetAfter(p)}}}}};window.onKeyUpHandler=function(e,t,n){var r=e.keyCode;var a;var o;if(!window["BXfpdStopMent"+n]){return true}if(i.listen===true){if(r==t.KEY_CODES.escape){var s=new KeyboardEvent("keyup",{key:"Escape",keyCode:r,bubbles:true,cancelable:true,view:window});if(!document.dispatchEvent(s)){e.stopPropagation();e.preventDefault()}window["BXfpdStopMent"+n]()}else if(r!==t.KEY_CODES.enter&&r!==t.KEY_CODES.left&&r!==t.KEY_CODES.right&&r!==t.KEY_CODES.up&&r!==t.KEY_CODES.down){if(BX(i.node)){o=BX.util.trim(t.util.GetTextContent(i.node));var l=o;o=o.replace(/^[\+@]*/,"");i.bSearch=BX.Type.isStringFilled(o);var d=window.MPFgetSelectorId("bx-mention-"+n+"-id");var c=BX.UI.EntitySelector.Dialog.getById(d);if(BX.Type.isStringFilled(o)&&c){c.search(o)}if(i.leaveContent&&i._lastText){if(l===""){window["BXfpdStopMent"+n]()}else if(l!==""&&o===""){i.bSearch=false;if(c){c.search("")}}}i.lastText=o;i._lastText=l}else{window["BXfpdStopMent"+n]()}}}else{if(!e.shiftKey&&(r===t.KEY_CODES["space"]||r===t.KEY_CODES["escape"]||r===188||r===190)){a=t.selection.GetRange();if(a.collapsed){var u=a.endContainer;var f=t.GetIframeDoc();if(u){if(u.className!=="bxhtmled-metion"){u=BX.findParent(u,(function(e){return e.className=="bxhtmled-metion"}),f.body)}if(u&&u.className=="bxhtmled-metion"){o=t.util.GetTextContent(u);var p=o.match(/[\s\.\,]$/);if(p||r===t.KEY_CODES["escape"]){u.innerHTML=o.replace(/[\s\.\,]$/,"");var h=BX.create("SPAN",{html:p||t.INVISIBLE_SPACE},f);t.util.InsertAfter(h,u);t.selection.SetAfter(h)}}}}}}};window.onTextareaKeyDownHandler=function(e,t,n){var r=e.keyCode;if(i.listen&&r==t.KEY_CODES.enter){t.textareaKeyDownPreventDefault=true;e.stopPropagation();e.preventDefault()}};window.onTextareaKeyUpHandler=function(e,t,n){var r=null;var a="";var o=e.keyCode;var s=window.MPFgetSelectorId("bx-mention-"+n+"-id");if(i.listen===true){if(o==27){window["BXfpdStopMent"+n]()}else if(o!==13){a=t.textareaView.GetValue(false);r=t.textareaView.GetCursorPosition();var l="";var d="";if(a.indexOf("+")!==-1||a.indexOf("@")!==-1){var c=a.substr(0,r);var u=Math.max(c.lastIndexOf("+"),c.lastIndexOf("@"));if(u>=0){l=c.substr(u);d=l;l=l.replace(/^[\+@]*/,"");i.bSearch=BX.Type.isStringFilled(l);var f=BX.UI.EntitySelector.Dialog.getById(s);if(BX.Type.isStringFilled(l)&&f){f.search(l)}}}if(i._lastText){if(d===""){window["BXfpdStopMent"+n]()}else if(d!==""&&l===""){i.bSearch=false;if(f){f.search("")}}}i.lastText=l;i._lastText=d}}else{if(o==16){var p=this;this.shiftPressed=true;if(this.shiftTimeout){this.shiftTimeout=clearTimeout(this.shiftTimeout)}this.shiftTimeout=setTimeout((function(){p.shiftPressed=false}),100)}if(o==107||(e.shiftKey||e.modifiers>3||this.shiftPressed)&&BX.util.in_array(o,[187,50,107,43,61])){r=t.textareaView.element.selectionStart;if(r>0){a=t.textareaView.element.value;var h=a.substr(r-1,1);if(h&&(h==="+"||h==="@")){i.listen=true;i.listenFlag=true;i.text="";i.textarea=true;i.bSearch=false;i.mode="plus";BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{formId:n,bindPosition:BX.pos(document.getElementById("bx-b-mention-"+n))}])}}}}};var n=function(e,t){var i=BX.pos(e);var n=BX.pos(t.dom.areaCont);var r=BX.GetWindowScrollPos(t.GetIframeDoc());var a=n.top+i.bottom-r.scrollTop+2;var o=n.left+i.right-r.scrollLeft;return{top:a,left:o}};window.BxInsertMention=function(e){var t=e.item;var r=e.type;var a=e.formID;var o=e.editorId;var s=e.bNeedComa;var l=LHEPostForm.getEditor(o);var d;if((r==="user"||r==="project"||r==="department")&&t&&t.entityId>0&&l){if(l.GetViewMode()=="wysiwyg"){var c=l.GetIframeDoc();var u=l.selection.GetRange();var f=BX.create("SPAN",{props:{className:"bxhtmled-metion"},text:BX.util.htmlspecialcharsback(t.name)},c);d=BX.create("SPAN",{html:s?",&nbsp;":"&nbsp;"},c);var p={tag:"postuser",params:{value:t.entityId}};switch(r){case"project":p.projectId=t.entityId;p.projectName=t.name;break;case"department":p.departmentId=t.entityId;p.departmentName=t.name;break;default:p.userId=t.entityId;p.userName=t.name}l.SetBxTag(f,p);if(BX(i.node)&&i.node.parentNode){l.util.ReplaceNode(i.node,f)}else{l.selection.InsertNode(f,u)}if(f&&f.parentNode){var h=BX.findParent(f,{className:"bxhtmled-metion"},c.body);if(h){l.util.InsertAfter(f,h)}}if(f&&f.parentNode){l.util.InsertAfter(d,f);l.selection.SetAfter(d)}}else if(l.GetViewMode()=="code"&&l.bbCode){l.textareaView.Focus();var b=l.textareaView.GetValue(false);var m=l.textareaView.GetCursorPosition();var v=b.substr(0,m);var E=Math.max(v.lastIndexOf("+"),v.lastIndexOf("@"));if(E>=0&&m>E){l.textareaView.SetValue(b.substr(0,E)+b.substr(m));l.textareaView.element.setSelectionRange(E,E)}var g="";switch(r){case"user":g="USER";break;case"project":g="PROJECT";break;case"department":g="DEPARTMENT";break;default:}l.textareaView.WrapWith(false,false,"["+g+"="+t.entityId+"]"+t.name+"[/"+g+"]"+(s?", ":" "))}if(e.fireAddEvent===true){BX.onCustomEvent(window,"onMentionAdd",[t,r])}if(window["BXfpdStopMent"+a]){window["BXfpdStopMent"+a]()}i["text"]="";if(l.GetViewMode()=="wysiwyg"){l.Focus();l.selection.SetAfter(d)}var y=LHEPostForm.getHandler(o);if(y&&y.formEntityType==="task"&&y.editorParams.tasksLimitExceeded){BX.Main.PostFormTasksLimit.showPopup({bindPosition:n(i.node,l)})}}};window.MPFgetSelectorId=function(e){var t=false;var i=BX(e);if(!i){return t}t=i.getAttribute("data-bx-selector-id");return t};window.MPFcreateSelectorDialog=function(e){new BX.UI.EntitySelector.Dialog({targetNode:"mpf-mention-"+e.formId,id:e.selectorId,context:"MENTION",multiple:false,enableSearch:e.enableSearch,clearSearchOnSelect:true,hideOnSelect:true,hideByEsc:true,entities:e.params.entities,height:300,width:400,compactView:true,events:{onShow:function(){window.BXfpdOnDialogOpen()},onHide:function(){window.BXfpdOnDialogClose({editorId:e.params.editorId})},"Item:onSelect":function(t){var i=t.getData().item;if(i){window["BXfpdSelectCallbackMent"+e.formId]({item:{name:i.getTitle(),entityId:i.getId()},entityType:i.getEntityId()})}}}})};window.MPFMentionInit=function(t,n){e.mentionParams[t]=n;if(n.initDestination===true){BX.addCustomEvent("onAutoSaveRestoreDestination",(function(e){if(BX.type.isNotEmptyObject(e)&&BX.type.isNotEmptyObject(e.data)&&BX.type.isNotEmptyString(e.data.DEST_DATA)&&BX.type.isNotEmptyString(e.formId)&&e.formId==t&&BX.UI.EntitySelector){var i=JSON.parse(e.data.DEST_DATA);if(!Array.isArray(i)){return}var n=BX.UI.EntitySelector.Dialog.getById("oPostFormLHE_blogPostForm");if(!BX.type.isNotEmptyObject(n)){return}n.preselectedItems=i;n.setPreselectedItems(i)}}));BX.addCustomEvent(window,"onMentionAdd",(function(e,t){var i=BX.UI.EntitySelector.Dialog.getById("oPostFormLHE_blogPostForm");if(!BX.type.isNotEmptyObject(i)){return}var n="";if(t==="user"){if(e.isExtranet==="Y"){n="extranet"}else if(e.isEmail==="Y"){n="email"}else{n="employee"}}else if(t==="project"){if(e.isExtranet==="Y"){n="extranet"}}i.addItem({avatar:e.avatar,customData:{email:BX.Type.isStringFilled(e.email)?e.email:""},entityId:t,entityType:n,id:e.entityId,title:e.name}).select()}))}window["BXfpdSelectCallbackMent"+t]=function(e){window.BxInsertMention({item:e.item,type:e.entityType.toLowerCase(),formID:t,editorId:n.editorId,fireAddEvent:n.initDestination})};window["BXfpdStopMent"+t]=function(){var e=window.MPFgetSelectorId("bx-mention-"+t+"-id");var i=BX.UI.EntitySelector.Dialog.getById(e);if(i){i.hide()}};if(BX(t)){BX.addCustomEvent(BX(t),"OnUCFormAfterShow",(function(e){if(!BX.type.isNotEmptyObject(e)||!BX.type.isArray(e.id)||!BX.Type.isStringFilled(e.id[0])){return}var t=new RegExp("EVENT_(\\d+)","i");if(!t.test(e.id[0])){return}}))}var r=LHEPostForm.getHandlerByFormId(t);if(r){r.exec()}BX.ready((function(){var e=BX("bx-b-mention-"+t);BX.bind(e,"click",(function(r){if(i.listen!==true){var a=LHEPostForm.getEditor(n.editorId);var o=a.GetIframeDoc();if(a.GetViewMode()=="wysiwyg"&&o){i.listen=true;i.listenFlag=true;i.text="";i.leaveContent=false;i.mode="button";var s=a.selection.GetRange();if(BX(i.node)){BX.remove(BX(i.node))}a.InsertHtml('<span id="bx-mention-node">'+a.INVISIBLE_SPACE+"</span>",s);setTimeout((function(){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{formId:t,bindNode:e}]);i.node=o.getElementById("bx-mention-node");if(i.node){s.setStart(i.node,0);if(i.node.firstChild&&i.node.firstChild.nodeType==3&&i.node.firstChild.nodeValue.length>0){s.setEnd(i.node,1)}else{s.setEnd(i.node,0)}a.selection.SetSelection(s)}a.Focus()}),100)}else if(a.GetViewMode()=="code"){i.listen=true;i.listenFlag=true;i.text="";i.leaveContent=false;i.mode="button";setTimeout((function(){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{formId:t,bindNode:e}])}),100)}BX.onCustomEvent(e,"mentionClick")}}))}))};window.BXfpdOnDialogOpen=function(){i.listen=true;i.listenFlag=true};window.BXfpdOnDialogClose=function(e){i.listen=false;setTimeout((function(){i.listenFlag=false;if(!i.listen){var t=LHEPostForm.getEditor(e.editorId);if(t){t.Focus()}}}),100)};MPFEntitySelector=function(t){this.selector=null;this.inputNode=null;this.messages={};if(!BX.Type.isStringFilled(t.id)){return null}if(e.selector[t.id]){return e.selector[t.id]}e.selector[t.id]=this.init(t)};MPFEntitySelector.prototype.init=function(e){if(!BX.type.isPlainObject(e)){e={}}if(!BX.Type.isStringFilled(e.id)||!BX.Type.isStringFilled(e.tagNodeId)||!BX(e.tagNodeId)){return null}if(BX.Type.isStringFilled(e.inputNodeId)&&BX(e.inputNodeId)){this.inputNode=BX(e.inputNodeId)}if(BX.type.isNotEmptyObject(e.messages)){this.messages=e.messages}this.selector=new BX.UI.EntitySelector.TagSelector({id:e.id,dialogOptions:{id:e.id,context:BX.Type.isStringFilled(e.context)?e.context:null,preselectedItems:BX.type.isArray(e.preselectedItems)?e.preselectedItems:[],events:{"Item:onSelect":function(){this.recalcValue(this.selector.getDialog().getSelectedItems())}.bind(this),"Item:onDeselect":function(){this.recalcValue(this.selector.getDialog().getSelectedItems())}.bind(this)},entities:[{id:"meta-user",options:{"all-users":{title:this.messages.allUsersTitle,allowView:BX.type.isBoolean(e.allowToAll)&&e.allowToAll}}},{id:"user",options:{emailUsers:BX.type.isBoolean(e.allowSearchEmailUsers)?e.allowSearchEmailUsers:false,inviteGuestLink:BX.type.isBoolean(e.allowSearchEmailUsers)?e.allowSearchEmailUsers:false,myEmailUsers:true}},{id:"project",options:{features:{blog:["premoderate_post","moderate_post","write_post","full_post"]}}},{id:"department",options:{selectMode:"usersAndDepartments",allowFlatDepartments:false}}]},addButtonCaption:BX.message("BX_FPD_LINK_1"),addButtonCaptionMore:BX.message("BX_FPD_LINK_2")});this.selector.renderTo(document.getElementById(e.tagNodeId));return this.selector};MPFEntitySelector.prototype.recalcValue=function(e){if(!BX.type.isArray(e)||!this.inputNode){return}var t=[];e.forEach((function(e){t.push([e.entityId,e.id])}));this.inputNode.value=JSON.stringify(t)};window.MPFEntitySelector=MPFEntitySelector})()})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/main.file.input/templates/drag_n_drop/script.min.js?169761435615242";s:6:"source";s:73:"/bitrix/components/bitrix/main.file.input/templates/drag_n_drop/script.js";s:3:"min";s:77:"/bitrix/components/bitrix/main.file.input/templates/drag_n_drop/script.min.js";s:3:"map";s:77:"/bitrix/components/bitrix/main.file.input/templates/drag_n_drop/script.map.js";}"*/
(function(){if(window.BlogBFileDialog)return;window.BlogBFileDialogUniqueID=[];window.BlogBFileDialog=function(e){this.dialogName="AttachmentsDialog";this.agent=false;this.uploadFileUrl=e.upload_path;this.id=!!e["id"]?e["id"]:this.getID();this.controlID=e["id"];this.enabled=true;this.controller=!!e.controller?e.controller:null;this.fileInput=e.fileInput;e.hAttachEvents=BX.delegate(this.InitAgent,this);this.msg=e.msg;this.dropAutoUpload=e.dropAutoUpload;this.CID=e.CID;this.multiple=!!e.multiple;e.caller=this;e.classes={uploaderParent:"file-uploader",uploader:"file-fileUploader",tpl_simple:"file-simple",tpl_extended:"file-extended",selector:"file-selector",selector_active:"file-selector-active"};e.doc_prefix="wd-doc";e.placeholder=BX.findChild(this.controller,{className:"file-placeholder-tbody"},true);this.doc_prefix=e.doc_prefix;this.values=e["values"]||[];if(!!BX.FileUploadAgent){this.agent=new BX.FileUploadAgent(e);BX.addCustomEvent(this,"ShowUploadedFile",BX.delegate(this.ShowUploadedFile,this));BX.addCustomEvent(this,"StopUpload",this.StopUpload.bind(this));BX.onCustomEvent(BX(this.controller.parentNode),"BFileDLoadFormControllerInit",[this])}else{BX.debug("/bitrix/components/bitrix/main.file.input/templates/drag_n_drop/script.js: BX.FileUploadAgent is not defined."+" You need to load /bitrix/js/main/file_upload_agent.js")}};window.BlogBFileDialog.prototype.getID=function(){return""+(new Date).getTime()};window.BlogBFileDialog.prototype.InitAgent=function(e){if(this.controller){e.placeholder=BX.findChild(this.controller,{className:"file-placeholder-tbody"},true)}};window.BlogBFileDialog.prototype.ShowUploadedFile=function(e){this.agent=e;var i=e.uploadResult;if(i&&i.element_id>0){var t=this.CreateFileRow(i);if(!!e.inputName&&e.inputName.length>0){var o=BX.create("INPUT",{props:{id:"file-doc"+i.element_id,type:"hidden",name:e.inputName+(this.multiple?"[]":""),value:i.element_id}});t.appendChild(o)}this.values.push(t);e._clearPlace();if(this.controller&&this.controller.parentNode){const e=(this.controller.closest("form")||this.controller.parentNode).querySelector("#upload-cid");if(e){e.value=this.CID}BX.onCustomEvent(this.controller.parentNode,"OnFileUploadSuccess",[i,this])}}else{var l=i&&i["error"]?i["error"]:this.msg.upload_error;e.ShowUploadError(l);if(this.controller&&this.controller.parentNode)BX.onCustomEvent(this.controller.parentNode,"OnFileUploadFail")}};window.BlogBFileDialog.prototype.CreateFileRow=function(e){var t=e;var o="file";if(!!t.element_content_type&&t.element_content_type.indexOf("image/")==0&&!!t.element_image&&t.element_image.length>0&&!!t.element_thumbnail&&t.element_thumbnail.length>0){o="image"}var l=BX.clone(BX("file-"+o+"-template"));BX.template(l,BX.delegate((function(e){this.tplFileRow(e,t)}),this));if(o=="image"){var n=null;for(i=0;i<l.children.length;i++){n=l.children[i];if(n.nodeType==1)break}n.setAttribute("id",this.doc_prefix+e.element_id);var a=BX.findChild(n,{className:"feed-add-post-del-but"},true);BX.bind(a,"click",BX.delegate((function(){var e=a;var i=e.parentNode;this.agent.StopUpload(i);BX.cleanNode(i,true)}),this));this.agent.AddNodeToPlaceholder(n);l=n}else{l.setAttribute("id",this.doc_prefix+e.element_id);this.agent.AddRowToPlaceholder(l);l=this.agent.placeholder.querySelector("#"+this.doc_prefix+e.element_id)}return l};window.BlogBFileDialog.prototype.GetUploadDialog=function(e){return new BlogBFileDialogUploader(this,e)};window.BlogBFileDialog.prototype.tplFileRow=function(e,i){for(id in e){if(!e.hasOwnProperty(id))continue;var t=e[id];if(id=="image"&&!!i.element_image&&i.element_image.length>0&&!!i.element_thumbnail&&i.element_thumbnail.length>0){t.setAttribute("src",i.element_image);t.setAttribute("rel",i.element_thumbnail)}else{if(!!i["element_"+id])t.innerHTML=i["element_"+id]}}};window.BlogBFileDialog.prototype._addUrlParam=function(e,i){if(!e)return null;if(e.indexOf(i)==-1)e+=(e.indexOf("?")==-1?"?":"&")+i;return e};window.BlogBFileDialog.prototype.LoadDialogs=function(e){if(!!this.agent)this.agent.LoadDialogs(e);else{var i=e;setTimeout(BX.delegate((function(){this.LoadDialogs(i)}),this),100)}};window.BlogBFileDialog.prototype.StopUpload=function(e,i){this.agent=e;var t=0;var o=new RegExp(this.doc_prefix+"(\\d+)");if(o.test(i.id)){var l=i.id.match(o);t=l[1]}if(this.controller&&this.controller.parentNode){BX.onCustomEvent(this.controller.parentNode,"OnFileUploadRemove",[t,this])}var n={fileID:t,sessid:BX.bitrix_sessid(),cid:this.CID,controlID:this.controlID,mfi_mode:"delete"};BX.ajax({method:"POST",dataType:"html",url:this.uploadFileUrl,processData:false,data:BX.ajax.prepareData(n),onsuccess:function(){}})};window.BlogBFileDialogDispatcher=function(e){this.id=this.getID();this.controller=e;BX.loadScript("/bitrix/js/main/core/core_dd.js",BX.delegate((function(){if(BX.type.isElementNode(this.controller)&&this.controller.parentNode&&this.controller.parentNode.parentNode){var e=this.controller.parentNode.parentNode;this.dropbox=new BX.DD.dropFiles(e);if(this.dropbox&&this.dropbox.supported()&&BX.ajax.FormData.isSupported()){this.hExpandUploader=BX.proxy(this.ExpandUploader,this);BX.addCustomEvent(this.dropbox,"dragEnter",this.hExpandUploader);BX.addCustomEvent(e,"UnbindDndDispatcher",BX.delegate(this.Unbind,this))}}}),this))};window.BlogBFileDialogDispatcher.prototype.getID=function(){return""+(new Date).getTime()};window.BlogBFileDialogDispatcher.prototype.ExpandUploader=function(){BX.onCustomEvent(BX(this.controller.parentNode),"BFileDLoadFormController",["show"])};window.BlogBFileDialogDispatcher.prototype.Unbind=function(){BX.removeCustomEvent(this.dropbox,"dragEnter",this.hExpandUploader)};window.BlogBFileDialogUploader=function(e,i){this.WDUploaded=false;this.WDUploadInProgress=false;this.documentExists=false;this.fileDropped=false;this.caller=e;this.agent=i;this.parentID=this.agent.id;this.id=this.caller.getID();this.msg=e.msg;this.dropAutoUpload=e.dropAutoUpload;this.uploadFileUrl=e.uploadFileUrl;this.CID=e.CID;this.controlID=e.controlID;this.CreateElements();this.fileInput=!!i.fileInput?i.fileInput:BX.type.isDomNode(i.fileInputID)?i.fileInputID:BX(e.fileInput);if(BX.type.isDomNode(this.fileInput)){this.fileInput.name="mfi_files[]"}this.fileList=this.__form;BX.loadScript("/bitrix/js/main/core/core_dd.js",BX.delegate((function(){var e=new BX.DD.dropFiles;if(e&&e.supported()&&BX.ajax.FormData.isSupported()){this.dropbox=e}this.agent.BindUploadEvents(this)}),this))};window.BlogBFileDialogUploader.prototype.CreateElements=function(){var e;do{e=Math.floor(Math.random()*99999)}while(BX("iframe-"+e));var i="iframe-"+this.id;var t=BX.create("IFRAME",{props:{name:i,id:i},style:{display:"none"}});document.body.appendChild(t);this.iframeUpload=t;var o=BX.create("FORM",{props:{id:"form-"+e,method:"POST",action:this.uploadFileUrl,enctype:"multipart/form-data",encoding:"multipart/form-data",target:i},style:{display:"none"},children:[BX.create("INPUT",{props:{type:"hidden",name:"sessid",value:BX.bitrix_sessid()}}),BX.create("INPUT",{props:{type:"hidden",name:"uniqueID",value:e}}),BX.create("INPUT",{props:{type:"hidden",name:"cid",value:this.CID}}),BX.create("INPUT",{props:{type:"hidden",name:"controlID",value:!!this.controlID?this.controlID:""}}),BX.create("INPUT",{props:{type:"hidden",name:"mfi_mode",value:"upload"}})]});document.body.appendChild(o);this.__form=o;window["FILE_UPLOADER_CALLBACK_"+e]=BX.proxy(this.Callback,this)};window.BlogBFileDialogUploader.prototype.GetUploadFileName=function(){var e="";if(this.fileInput&&this.fileInput.value.length>0){var e=this.fileInput.value;if(e.indexOf("\\")>-1)e=e.substr(e.lastIndexOf("\\")+1)}else{var i=this.fileList;if(i.file)e=i.file.fileName||i.file.name}return e};window.BlogBFileDialogUploader.prototype.Callback=function(e,i){if(BX.type.isArray(e)){e.forEach(function(e){var i={success:true,storage:"bfile",element_id:e.fileID,element_name:e.fileName,element_size:e.fileSize,element_url:e.fileURL,element_content_type:e.content_type||e.fileContentType,element_image:e.img_thumb_src||e.fileSrc,element_thumbnail:e.img_source_src||e.fileSrc};if(!!i.element_image)i.element_image=i.element_image.replace(/\/([^\/]+)$/,(function(e,i){return"/"+BX.util.urlencode(i)}));if(!!i.element_thumbnail)i.element_thumbnail=i.element_thumbnail.replace(/\/([^\/]+)$/,(function(e,i){return"/"+BX.util.urlencode(i)}));if(e["error"]||e["status"]==="error"){i["error"]=e["error"]||e["message"]}BX.onCustomEvent(this,"uploadFinish",[i])}.bind(this))}else{BX.onCustomEvent(this,"uploadFinish",[{success:false,messages:BX.type.isNotEmptyString(e)?e:this.msg.upload_error}])}window["FILE_UPLOADER_CALLBACK_"+i]=BX.DoNothing;BX.cleanNode(BX("iframe-"+i),true);BX.cleanNode(BX("form-"+i),true);this.agent.uploadDialog=null};window.BlogBFileDialogUploader.prototype.UploadResponse=function(e,i){this.WDUploadInProgress=false;BX.unbind(window,"beforeunload",BX.proxy(this.UploadLeave,this));if(!i||i.length<=0){this.onError()}};window.BlogBFileDialogUploader.prototype.UploadResponseIframe=function(e,i){this.WDUploadInProgress=false;BX.unbind(window,"beforeunload",BX.proxy(this.UploadLeave,this))};window.BlogBFileDialogUploader.prototype.UploadLeave=function(e){var e=e||window.event;var i="";if(this.WDUploadInProgress)i=this.msg.UploadInterrupt;else if(!this.WDUploaded&&this.fileInput&&this.fileInput.value.length>0)i=this.msg.UploadNotDone;if(i!=""){if(e)e.returnValue=i;return i}return};window.BlogBFileDialogUploader.prototype.UpdateListFiles=function(e){if(this&&e){if(e.length<1)return;var i=this.fileList;i.file=e[0];this.WDUploadInProgress=true;this.fileDropped=true;this.CallSubmit()}};window.BlogBFileDialogUploader.prototype.GetInputData=function(e){var i=[];var t={};i=i.concat(BX.findChildren(e,{tag:"input"},true),BX.findChildren(e,{tag:"textarea"},true),BX.findChildren(e,{tag:"select"},true));for(var o=0;o<i.length;o++){var l=i[o];if(!l||l.disabled||l.name.length<1)continue;switch(l.type.toLowerCase()){case"text":case"textarea":case"password":case"hidden":case"select-one":t[l.name]=l.value;break;case"radio":if(l.checked)t[l.name]=l.value;break;case"checkbox":t[l.name]=l.checked?"Y":"N";break;case"select-multiple":var n=l.options.length;if(n>0)t[l.name]=new Array;for(j=0;j<n;j++)if(l.options[j].selected)t[l.name].push(l.options[j].value);break;default:break}}return t};window.BlogBFileDialogUploader.prototype.SetFileInput=function(e){if(!!this.__form.mfi_save)return;if(this.fileInput&&this.fileInput!=e)BX.remove(this.fileInput);this.__form.appendChild(e);this.fileInput=e};window.BlogBFileDialogUploader.prototype.CallSubmit=function(){if(!!this.__form.mfi_save)return;BX.onCustomEvent(this,"uploadStart",[this]);BX.bind(window,"beforeunload",BX.proxy(this.UploadLeave,this));BX.bind(this.iframeUpload,"load",BX.delegate(this.UploadResponseIframe,this));if(this.dropbox){this.onProgress(.15);if(this.fileInput&&this.fileInput.files.length>0){var e=this.fileList;e.file=this.fileInput.files[0]}var t=this.GetInputData(this.__form);this.fileNodes=[this.fileList];for(i in this.fileNodes){if(this.fileNodes[i].file){var o=new BX.ajax.FormData;for(item in this.fileNodes[i].data){o.append(item,this.fileNodes[i].data[item])}if(!!Object&&!!Object.keys){var l=Object.keys(t);for(var n in l){var a=l[n];var r=t[a];o.append(a,r)}}else{for(item in t){o.append(item,t[item])}}o.append("mfi_files[]",this.fileNodes[i].file);o.send(this.uploadFileUrl,BX.delegate((function(e){this.UploadResponse(null,e)}),this),BX.delegate(this.onProgress,this))}}}else{this.onProgress(.15);this.WDUploadInProgress=true;var s=this.__form.id;BX.submit(this.__form,"mfi_save","Y")}};window.BlogBFileDialogUploader.prototype.onProgress=function(e){if(isNaN(e))return;BX.onCustomEvent(this,"progress",[e])};window.BlogBFileDialogUploader.prototype.onError=function(){BX.onCustomEvent(this,"uploadFinish",[{success:false,messages:this.msg.upload_error}])};top.BlogBFileDialog=window.BlogBFileDialog;top.BlogBFileDialogUploader=window.BlogBFileDialogUploader;top.BlogBFileDialogDispatcher=window.BlogBFileDialogDispatcher;window.MFIDD=function(e){BX.loadCSS("/bitrix/components/bitrix/main.file.input/templates/drag_n_drop/style.css");var i=e["status"]==="show"?"show":e["status"]==="hide"?"hide":"switch";if(i=="switch")i=e["controller"].style.display!="none"?"hide":"show";var t=function(i){if(i=="show"){BX.fx.show(e["controller"],"fade",{time:.2});if(e["switcher"]&&e["switcher"].style.display!="none")BX.fx.hide(e["switcher"],"fade",{time:.1});if(!!window["BfileUnbindDispatcher"+e["uid"]])window["BfileUnbindDispatcher"+e["uid"]]()}else if(e["controller"].style.display!=="none"){BX.fx.hide(e["controller"],"fade",{time:.2})}};if(!e["controller"].loaded){e["controller"].loaded=true;var o=new BX.DD.dropFiles,l=o&&o.supported()&&BX.ajax.FormData.isSupported()?"extended":"simple";top["BfileFD"+e["uid"]]=window["BfileFD"+e["uid"]]=new BlogBFileDialog({mode:l,CID:e["CID"],id:e["id"],upload_path:e["upload_path"],multiple:e["multiple"],controller:e["controller"],inputName:e["inputName"],fileInput:"file-fileUploader-"+e["uid"],fileInputName:"mfi_files[]",values:BX.findChildren(BX("file-selectdialog-"+e["uid"]),{className:"file-inline-file"},true),msg:{loading:BX.message("loading"),file_exists:BX.message("file_exists"),upload_error:BX.message("upload_error"),access_denied:BX.message("access_denied")}});t(i);window["BfileFD"+e["uid"]].LoadDialogs("DropInterface");BX.onCustomEvent("BFileDSelectFileDialogLoaded",[window["BfileFD"+e["uid"]]])}else t(i)};window.BlogBFileJustDialog=function(e){this.dialogName="AttachmentsDialog";this.agent=false;this.id=!!e["id"]?e["id"]:this.getID();this.controlID=e["id"];this.enabled=true;this.uploadFileUrl=e.upload_path;this.controller=!!e.controller?e.controller:null;this.CID=e.CID;e.caller=this;e.doc_prefix="wd-doc";e._mkFileInput=BX.DoNothing;e.mode="extended";e.classes={tpl_simple:"file-simple",tpl_extended:"file-extended"};this.doc_prefix=e.doc_prefix;if(!!BX.FileUploadAgent){this.agent=new BX.FileUploadAgent(e);BX.addCustomEvent(this,"StopUpload",BX.delegate(this.StopUpload,this));BX.onCustomEvent(BX(this.controller.parentNode),"BFileDLoadFormControllerInit",[this])}else{BX.debug("/bitrix/components/bitrix/main.file.input/templates/drag_n_drop/script.js: BX.FileUploadAgent is not defined."+" You need to load /bitrix/js/main/file_upload_agent.js")}};window.BlogBFileJustDialog.prototype.StopUpload=function(e,i){this.agent=e;id=false;mID=i.id.match(new RegExp(this.doc_prefix+"(\\d+)"));if(!!mID){id=mID[1]}if(this.controller&&this.controller.parentNode)BX.onCustomEvent(this.controller.parentNode,"OnFileUploadRemove",[id,this]);var t={fileID:id,sessid:BX.bitrix_sessid(),cid:this.CID,controlID:this.controlID,mfi_mode:"delete"};BX.ajax.post(this.uploadFileUrl,t)};window.MFIS=function(e){if(!e["controller"].loaded){e["controller"].loaded=true;top["BfileFD"+e["uid"]]=window["BfileFD"+e["uid"]]=new BlogBFileJustDialog({CID:e["CID"],id:e["id"],upload_path:e["upload_path"],controller:e["controller"],values:BX.findChildren(BX("file-selectdialog-"+e["uid"]),{className:"file-inline-file"},true)});BX.fx.show(e["controller"],"fade",{time:.2});BX.onCustomEvent("BFileDSelectFileDialogLoaded",[window["BfileFD"+e["uid"]]])}}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:71:"/bitrix/components/bitrix/system.field.edit/script.min.js?1697614356814";s:6:"source";s:53:"/bitrix/components/bitrix/system.field.edit/script.js";s:3:"min";s:57:"/bitrix/components/bitrix/system.field.edit/script.min.js";s:3:"map";s:57:"/bitrix/components/bitrix/system.field.edit/script.map.js";}"*/
function addElement(e,n){if(document.getElementById("main_"+e)){var d=document.getElementById("main_"+e).getElementsByTagName("div");if(d&&d.length>0&&d[0]){var t=d[0].parentNode;t.appendChild(d[d.length-1].cloneNode(true))}}}function addElementFile(e,n){var d=document.getElementById("main_"+e);var t=document.getElementById("main_add_"+e);if(d&&t){t=t.cloneNode(true);t.id="";t.style.display="";d.appendChild(t)}}function addElementDate(e,n){var d=document.getElementById("date_container_"+n);var t=document.getElementById("hidden_"+n).innerHTML;if(d&&t){var a=e[n].fieldName;var i=e[n].index;t=t.replace(/[#]FIELD_NAME[#]/g,a+"["+i+"]");t=t.replace(/[\%]23FIELD_NAME[\%]23/g,escape(a+"["+i+"]"));var l=d.appendChild(document.createElement("DIV"));l.innerHTML+=t;e[n].index++}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:88:"/bitrix/components/bitrix/search.tags.input/templates/.default/script.js?169761759213020";s:6:"source";s:72:"/bitrix/components/bitrix/search.tags.input/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
var Errors = {
	"result_unval" : "Error in result",
	"result_empty" : "Empty result"
};

function JsTc(oHandler, sParams, sParser) // TC = TagCloud
{
	var t = this;

	t.oObj = typeof oHandler == 'object' ? oHandler : document.getElementById("TAGS");
	t.sParams = sParams;
	// Arrays for data
	if (sParser)
	{
		t.sExp = new RegExp("["+sParser+"]+", "i");
	}
	else
	{
		t.sExp = new RegExp(",");
	}
	t.oLast = {"str":false, "arr":false};
	t.oThis = {"str":false, "arr":false};
	t.oEl = {"start":false, "end":false};
	t.oUnfinedWords = {};
	// Flags
	t.bReady = true;
	t.eFocus = true;
	// Array with results & it`s showing
	t.aDiv = null;
	t.oDiv = null;
	// Pointers
	t.oActive = null;
	t.oPointer = [];
	t.oPointer_default = [];
	t.oPointer_this = 'input_field';

	t.oObj.onblur = function()
	{
		t.eFocus = false;
	};

	t.oObj.onfocus = function()
	{
		if (!t.eFocus)
		{
			t.eFocus = true;
			setTimeout(function(){t.CheckModif('focus')}, 500);
		}
	};

	t.oLast["arr"] = t.oObj.value.split(t.sExp);
	t.oLast["str"] = t.oLast["arr"].join(":");

	setTimeout(function(){t.CheckModif('this')}, 500);

	this.CheckModif = function(__data)
	{
		var
			sThis = false, tmp = 0,
			bUnfined = false, word = "",
			cursor = {};

		if (!t.eFocus)
			return;

		if (t.bReady && t.oObj.value.length > 0)
		{
			// Preparing input data
			t.oThis["arr"] = t.oObj.value.split(t.sExp);
			t.oThis["str"] = t.oThis["arr"].join(":");

			// Getting modificated element
			if (t.oThis["str"] && (t.oThis["str"] != t.oLast["str"]))
			{
				cursor['position'] = TCJsUtils.getCursorPosition(t.oObj);
				if (cursor['position']['end'] > 0 && !t.sExp.test(t.oObj.value.substr(cursor['position']['end']-1, 1)))
				{
					cursor['arr'] = t.oObj.value.substr(0, cursor['position']['end']).split(t.sExp);
					sThis = t.oThis["arr"][cursor['arr'].length - 1];

					t.oEl['start'] = cursor['position']['end'] - cursor['arr'][cursor['arr'].length - 1].length;
					t.oEl['end'] = t.oEl['start'] + sThis.length;
					t.oEl['content'] = sThis;

					t.oLast["arr"] = t.oThis["arr"];
					t.oLast["str"] = t.oThis["str"];
				}
			}
			if (sThis)
			{
				// Checking for UnfinedWords
				for (tmp = 2; tmp <= sThis.length; tmp++)
				{
					word = sThis.substr(0, tmp);
					if (t.oUnfinedWords[word] == '!fined')
					{
						bUnfined = true;
						break;
					}
				}
				if (!bUnfined)
					t.Send(sThis);
			}
		}
		setTimeout(function(){t.CheckModif('this')}, 500);
	};

	t.Send = function(sSearch)
	{
		if (!sSearch)
			return false;

		var oError = [];
		t.bReady = false;
		if (BX('wait_container'))
		{
			BX('wait_container').innerHTML = BX.message('JS_CORE_LOADING');
			BX.show(BX('wait_container'));
		}
		BX.ajax.post(
			'/bitrix/components/bitrix/search.tags.input/search.php',
			{"search":sSearch, "params":t.sParams},
			function(data)
			{
				var result = {};
				t.bReady = true;

				try
				{
					eval("result = " + data + ";");
				}
				catch(e)
				{
					oError['result_unval'] = e;
				}

				if (TCJsUtils.empty(result))
					oError['result_empty'] = Errors['result_empty'];

				try
				{
					if (TCJsUtils.empty(oError) && (typeof result == 'object'))
					{
						if (!(result.length == 1 && result[0]['NAME'] == t.oEl['content']))
						{
							t.Show(result);
							return;
						}
					}
					else
					{
						t.oUnfinedWords[t.oEl['content']] = '!fined';
					}
				}
				catch(e)
				{
					oError['unknown_error'] = e;
				}

				if(BX('wait_container'))
					BX.hide(BX('wait_container'));
			}
		);
	};

	t.Show = function(result)
	{
		t.Destroy();
		t.oDiv = document.body.appendChild(document.createElement("DIV"));
		t.oDiv.id = t.oObj.id+'_div';

		t.oDiv.className = "search-popup";
		t.oDiv.style.position = 'absolute';

		t.aDiv = t.Print(result);
		var pos = TCJsUtils.GetRealPos(t.oObj);
		t.oDiv.style.width = parseInt(pos["width"]) + "px";
		TCJsUtils.show(t.oDiv, pos["left"], pos["bottom"]);
		TCJsUtils.addEvent(document, "click", t.CheckMouse);
		TCJsUtils.addEvent(document, "keydown", t.CheckKeyword);
	};

	t.Print = function(aArr)
	{
		var aEl = null;
		var aResult = [];
		var aRes = [];
		var iCnt = 0;
		var oDiv = null;
		var oSpan = null;
		var sPrefix = t.oDiv.id;

		for (var tmp_ in aArr)
		{
			// Math
			if (aArr.hasOwnProperty(tmp_))
			{
				aEl = aArr[tmp_];
				aRes = [];
				aRes['ID'] = (aEl['ID'] && aEl['ID'].length > 0) ? aEl['ID'] : iCnt++;
				aRes['GID'] = sPrefix + '_' + aRes['ID'];
				aRes['NAME'] = TCJsUtils.htmlspecialcharsEx(aEl['NAME']);
				aRes['~NAME'] = aEl['NAME'];
				aRes['CNT'] = aEl['CNT'];
				aResult[aRes['GID']] = aRes;
				t.oPointer.push(aRes['GID']);
				// Graph
				oDiv = t.oDiv.appendChild(document.createElement("DIV"));
				oDiv.id = aRes['GID'];
				oDiv.name = sPrefix + '_div';

				oDiv.className = 'search-popup-row';

				oDiv.onmouseover = function(){t.Init(); this.className='search-popup-row-active';};
				oDiv.onmouseout = function(){t.Init(); this.className='search-popup-row';};
				oDiv.onclick = function(e){
						t.oActive = this.id;
						t.Replace();
						t.Destroy();
						BX.PreventDefault(e);
					};

				oSpan = oDiv.appendChild(document.createElement("DIV"));
				oSpan.id = oDiv.id + '_NAME';
				oSpan.className = "search-popup-el search-popup-el-cnt";
				oSpan.innerHTML = aRes['CNT'];

				oSpan = oDiv.appendChild(document.createElement("DIV"));
				oSpan.id = oDiv.id + '_NAME';
				oSpan.className = "search-popup-el search-popup-el-name";
				oSpan.innerHTML = aRes['NAME'];
			}
		}
		t.oPointer.push('input_field');
		t.oPointer_default = t.oPointer;
		return aResult;
	};

	t.Destroy = function()
	{
		try
		{
			TCJsUtils.hide(t.oDiv);
			t.oDiv.parentNode.removeChild(t.oDiv);
		}
		catch(e)
		{}
		t.aDiv = [];
		t.oPointer = [];
		t.oPointer_default = [];
		t.oPointer_this = 'input_field';
		t.bReady = true;
		t.eFocus = true;
		t.oActive = null;

		TCJsUtils.removeEvent(document, "click", t.CheckMouse);
		TCJsUtils.removeEvent(document, "keydown", t.CheckKeyword);
	};

	t.Replace = function()
	{
		if (typeof t.oActive == 'string')
		{
			var tmp = t.aDiv[t.oActive];
			var tmp1 = '';
			if (typeof tmp == 'object')
			{
				var elEntities = document.createElement("textarea");
				elEntities.innerHTML = tmp['~NAME'];
				tmp1 = elEntities.value;
			}
			//this preserves leading spaces
			var start = t.oEl['start'];
			while(start < t.oObj.value.length && t.oObj.value.substring(start, start+1) == " ")
				start++;

			t.oObj.value = t.oObj.value.substring(0, start) + tmp1 + t.oObj.value.substr(t.oEl['end']);
			TCJsUtils.setCursorPosition(t.oObj, start + tmp1.length);
		}
	};

	t.Init = function()
	{
		t.oActive = false;
		t.oPointer = t.oPointer_default;
		t.Clear();
		t.oPointer_this = 'input_pointer';
	};

	t.Clear = function()
	{
		var oEl = t.oDiv.getElementsByTagName("div");
		if (oEl.length > 0 && typeof oEl == 'object')
		{
			for (var ii in oEl)
			{
				if (oEl.hasOwnProperty(ii))
				{
					var oE = oEl[ii];
					if (oE && (typeof oE == 'object') && (oE.name == t.oDiv.id + '_div'))
					{
						oE.className = "search-popup-row";
					}
				}
			}
		}
	};

	t.CheckMouse = function()
	{
		t.Replace();
		t.Destroy();
	};

	t.CheckKeyword = function(e)
	{
		if (!e)
			e = window.event;
		var oP = null;
		var oEl = null;
		if ((37 < e.keyCode && e.keyCode <41) || (e.keyCode == 13))
		{
			t.Clear();

			switch (e.keyCode)
			{
				case 38:
					oP = t.oPointer.pop();
					if (t.oPointer_this == oP)
					{
						t.oPointer.unshift(oP);
						oP = t.oPointer.pop();
					}

					if (oP != 'input_field')
					{
						t.oActive = oP;
						oEl = document.getElementById(oP);
						if (typeof oEl == 'object')
						{
							oEl.className = "search-popup-row-active";
						}
					}
					t.oPointer.unshift(oP);
					break;
				case 40:
					oP = t.oPointer.shift();
					if (t.oPointer_this == oP)
					{
						t.oPointer.push(oP);
						oP = t.oPointer.shift();
					}
					if (oP != 'input_field')
					{
						t.oActive = oP;
						oEl = document.getElementById(oP);
						if (typeof oEl == 'object')
						{
							oEl.className = "search-popup-row-active";
						}
					}
					t.oPointer.push(oP);
					break;
				case 39:
					t.Replace();
					t.Destroy();
					break;
				case 13:
					t.Replace();
					t.Destroy();
					if (TCJsUtils.IsIE())
					{
						e.returnValue = false;
						e.cancelBubble = true;
					}
					else
					{
						e.preventDefault();
						e.stopPropagation();
					}
					break;
			}
			t.oPointer_this	= oP;
		}
		else
		{
			t.Destroy();
		}
	}
}

var TCJsUtils =
{
	arEvents:  [],

	addEvent: function(el, evname, func)
	{
		if(el.attachEvent) // IE
			el.attachEvent("on" + evname, func);
		else if(el.addEventListener) // Gecko / W3C
			el.addEventListener(evname, func, false);
		else
			el["on" + evname] = func;
		this.arEvents[this.arEvents.length] = {'element': el, 'event': evname, 'fn': func};
	},

	removeEvent: function(el, evname, func)
	{
		if(el.detachEvent) // IE
			el.detachEvent("on" + evname, func);
		else if(el.removeEventListener) // Gecko / W3C
			el.removeEventListener(evname, func, false);
		else
			el["on" + evname] = null;
	},

	getCursorPosition: function(oObj)
	{
		var result = {'start': 0, 'end': 0};
		if (!oObj || (typeof oObj != 'object'))
			return result;
		try
		{
			if (document.selection != null && oObj.selectionStart == null)
			{
				oObj.focus();
				var oRange = document.selection.createRange();
				var oParent = oRange.parentElement();
				var sBookmark = oRange.getBookmark();
				var sContents_ = oObj.value;
				var sContents = sContents_;
				var sMarker = '__' + Math.random() + '__';

				while(sContents.indexOf(sMarker) != -1)
				{
					sMarker = '__' + Math.random() + '__';
				}

				if (!oParent || oParent == null || (oParent.type != "textarea" && oParent.type != "text"))
				{
					return result;
				}

				oRange.text = sMarker + oRange.text + sMarker;
				sContents = oObj.value;
				result['start'] = sContents.indexOf(sMarker);
				sContents = sContents.replace(sMarker, "");
				result['end'] = sContents.indexOf(sMarker);
				oObj.value = sContents_;
				oRange.moveToBookmark(sBookmark);
				oRange.select();
				return result;
			}
			else
			{
				return {
					'start': oObj.selectionStart,
					'end': oObj.selectionEnd
				};
			}
		}
		catch(e){}
		return result;
	},

	setCursorPosition: function(oObj, iPosition)
	{
		if (typeof oObj != 'object')
			return false;

		oObj.focus();

		try
		{
			if (document.selection != null && oObj.selectionStart == null)
			{
				var oRange = document.selection.createRange();
				oRange.select();
			}
			else
			{
				oObj.selectionStart = iPosition;
				oObj.selectionEnd = iPosition;
			}
			return true;
		}
		catch(e)
		{
			return false;
		}
	},

	printArray: function (oObj, sParser, iLevel)
	{
		try
		{
			var result = '';
			var space = '';

			if (iLevel==undefined)
				iLevel = 0;
			if (!sParser)
				sParser = "\n";

			for (var j=0; j<=iLevel; j++)
				space += '  ';

			for (var i in oObj)
			{
				if (oObj.hasOwnProperty(i))
				{
					if (typeof oObj[i] == 'object')
						result += space+i + " = {"+ sParser + TCJsUtils.printArray(oObj[i], sParser, iLevel+1) + ", " + sParser + "}" + sParser;
					else
						result += space+i + " = " + oObj[i] + "; " + sParser;
				}
			}
			return result;
		}
		catch(e)
		{
		}
	},

	empty: function(oObj)
	{
		if (oObj)
		{
			for (var i in oObj)
			{
				if (oObj.hasOwnProperty(i))
				{
					return false;
				}
			}
		}
		return true;
	},

	show: function(oDiv, iLeft, iTop)
	{
		if (typeof oDiv != 'object')
			return;
		var zIndex = parseInt(oDiv.style.zIndex);
		if(zIndex <= 0 || isNaN(zIndex))
			zIndex = 2200;
		oDiv.style.zIndex = zIndex;
		oDiv.style.left = iLeft + "px";
		oDiv.style.top = iTop + "px";
		return oDiv;
	},

	hide: function(oDiv)
	{
		if (oDiv)
			oDiv.style.display = 'none';
	},

	GetRealPos: function(el)
	{
		if(!el || !el.offsetParent)
			return false;

		var res = {};
		var objParent = el.offsetParent;
		res["left"] = el.offsetLeft;
		res["top"] = el.offsetTop;
		while(objParent && objParent.tagName != "BODY")
		{
			res["left"] += objParent.offsetLeft;
			res["top"] += objParent.offsetTop;
			objParent = objParent.offsetParent;
		}
		res["right"]=res["left"] + el.offsetWidth;
		res["bottom"]=res["top"] + el.offsetHeight;
		res["width"]=el.offsetWidth;
		res["height"]=el.offsetHeight;

		return res;
	},

	IsIE: function()
	{
		return (document.attachEvent && !TCJsUtils.IsOpera());
	},

	IsOpera: function()
	{
		return (navigator.userAgent.toLowerCase().indexOf('opera') != -1);
	},

	htmlspecialcharsEx: function(str)
	{
		return str.replace(/&amp;/g, '&amp;amp;').replace(/&lt;/g, '&amp;lt;').replace(/&gt;/g, '&amp;gt;').replace(/&quot;/g, '&amp;quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
	},

	htmlspecialcharsback: function(str)
	{
		return str.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;;/g, '"').replace(/&amp;/g, '&');
	}
};

/* End */
;
; /* Start:"a:4:{s:4:"full";s:84:"/bitrix/components/bitrix/voting.uf/templates/.default/script.min.js?169761763711231";s:6:"source";s:64:"/bitrix/components/bitrix/voting.uf/templates/.default/script.js";s:3:"min";s:68:"/bitrix/components/bitrix/voting.uf/templates/.default/script.min.js";s:3:"map";s:68:"/bitrix/components/bitrix/voting.uf/templates/.default/script.map.js";}"*/
(function(t){var e=t.BX;if(e["Vote"])return;var i=t["app"]?e.message("SITE_DIR")+"mobile/?mobile_action=vote":"/bitrix/tools/vote/uf.php";e.Vote=function(){var a=function(i,s){this.node=i;this.form=e.findChild(this.node,{tagName:"FORM"},true);this.id=s["id"];this.voteId=s["voteId"];this.params=s;var a,o,r;this.errorNode=e.findChild(this.node,{attribute:{"data-bx-vote-role":"error"}},true);for(var n in this.buttons){if(this.buttons.hasOwnProperty(n)){a=e.findChild(this.node,{attribute:{"data-bx-vote-button":n}},true);if(a&&e.type.isFunction(this[n])){this[n]=e.delegate(this[n],this);this.buttons[n]=a;e.bind(a,"click",this[n])}}}a=e.findChildren(this.node,{tagName:"TR"},true);while(a&&(o=a.pop())&&o&&o.hasAttribute("data-bx-vote-answer")){r=e.findChild(o,{tagName:"A",attribute:{"data-bx-vote-result":"counter"}},true);if(r){if(t["app"]){e.bind(o,"click",e.proxy(this.checkMobileUsers,this))}else{e.bind(r,"click",e.proxy(this.checkUsers,this));e.adjust(r,{attrs:{"data-bx-vote-answer":o.getAttribute("data-bx-vote-answer")}})}}}this.onPullEvent=e.delegate((function(t,i){if(t=="voting"&&!!i&&i["VOTE_ID"]==this.voteId&&e(this.node)){this.adjustResults(i)}}),this);if(t["app"]){app.onCustomEvent("onPullExtendWatch",{id:"VOTE_"+this.voteId});e.addCustomEvent("onPull-vote",this.onPullEvent)}else if(e["PULL"]){e.PULL.extendWatch("VOTE_"+this.voteId);e.addCustomEvent("onPullEvent-vote",this.onPullEvent)}};a.prototype={buttons:{showVoteForm:null,showResults:null,actVoting:null,stopOrResume:null,exportXls:null},params:{},url:i,showVoteForm:function(t){if(this.node.getAttribute("data-bx-vote-lamp")=="green"){var i=e.proxy((function(t){if(t&&t.data&&t.data.event)this.adjustBallot(t.data.attach,t.data.event);this.node.setAttribute("data-bx-vote-form","shown")}),this),s=e.proxy((function(t){this.node.setAttribute("data-bx-vote-form","shown")}),this);this.send({action:"getBallot"},t.target,i,s)}e.eventCancelBubble(t);return e.PreventDefault(t)},showResults:function(t){this.node.setAttribute("data-bx-vote-result",this.node.getAttribute("data-bx-vote-result")=="shown"?"hidden":"shown");e.eventCancelBubble(t);return e.PreventDefault(t)},stopOrResume:function(t){this.send({action:this.node.getAttribute("data-bx-vote-lamp")=="red"?"resume":"stop"},t.target,e.proxy((function(t){if(t["action"]=="stop"){this.node.setAttribute("data-bx-vote-result","shown");this.node.setAttribute("data-bx-vote-form","hidden");this.node.setAttribute("data-bx-vote-lamp","red")}else{if(this.node.getAttribute("data-bx-vote-status")!=="voted")this.node.setAttribute("data-bx-vote-form","shown");this.node.setAttribute("data-bx-vote-lamp","green")}if(t["data"]&&t["data"]["attach"])this.adjustResults(t["data"]["attach"])}),this));e.eventCancelBubble(t);return e.PreventDefault(t)},exportXls:function(t){e.eventCancelBubble(t);top.location.href=e.util.add_url_param(this.url,{action:"exportXls",attachId:this.id,sessid:e.bitrix_sessid()});return e.PreventDefault(t)},actVoting:function(t){var i=e.ajax.prepareForm(this.form).data;i["action"]="vote";this.send(i,t.target,e.proxy((function(t){this.node.setAttribute("data-bx-vote-form","hidden");this.node.setAttribute("data-bx-vote-result","shown");this.adjustResults(t.data.attach)}),this),e.proxy((function(){this.node.setAttribute("data-bx-vote-form","shown")}),this));e.eventCancelBubble(t);return e.PreventDefault(t)},send:function(t,i,s,a){e.addClass(i,"ui-btn-clock");t["sessid"]=e.bitrix_sessid();t["attachId"]=this.id;e.ajax({method:"POST",url:e.util.add_url_param(this.url,{action:t["action"],attachId:this.id}),data:t,dataType:"json",onsuccess:e.proxy((function(t){e.removeClass(i,"ui-btn-clock");if(t.status=="success"){this.showError(null);if(e.type.isFunction(s))s.apply(this,arguments)}else{if(t.status=="error"&&t["errors"])this.showError(t["errors"]);if(e.type.isFunction(a))a.apply(this,arguments)}}),this),onfailure:e.proxy((function(){e.removeClass(i,"ui-btn-clock");if(e.type.isFunction(a))a.apply(this,arguments)}),this)})},adjustBallot:function(t,i){var s,a,o,r,n,u,l,h,p,d=t["QUESTIONS"],c=i["ballot"],f=i["extras"];for(s in d){if(d.hasOwnProperty(s)){l=d[s];o=[l["FIELD_NAME"],l["FIELD_NAME"]+"[]"];p=c[s]||{};while(r=o.shift()){if(this.form.elements[r]){u=e(this.form.elements[r])?[this.form.elements[r]]:this.form.elements[r];for(r=0;r<u.length;r++){if(p[u[r].value]){u[r].checked="checked"}else{delete u[r].checked}}}}for(a in d[s]["ANSWERS"]){if(d[s]["ANSWERS"].hasOwnProperty(a)){h=d[s]["ANSWERS"][a];if(h["FIELD_TYPE"]>=4){if(this.form.elements[h["MESSAGE_FIELD_NAME"]])this.form.elements[h["MESSAGE_FIELD_NAME"]].value=c[s]&&c[s][a]&&c[s][a]["MESSAGE"]?c[s][a]["MESSAGE"]:"";else this.form.elements[h["FIELD_NAME"]].value=c[s]&&c[s][a]&&c[s][a]["MESSAGE"]?c[s][a]["MESSAGE"]:""}}}}}for(r in f){if(f.hasOwnProperty(r)&&(s=e(this.form.elements[String(t["FIELD_NAME"]).replace("#ENTITY_ID#",r)]))){if(s.value==f[r])s.checked=true;else delete s.checked}}},adjustResults:function(t){var i=t["QUESTIONS"];e.onCustomEvent(this.node,"OnBeforeChangeData");var s,a,o,r,n,u;for(r in i){if(i.hasOwnProperty(r)){s=e.findChild(this.node,{attr:{id:"question"+r}},true);if(s){for(o in i[r]["ANSWERS"]){if(i[r]["ANSWERS"].hasOwnProperty(o)){a=e.findChild(s,{attr:{"data-bx-vote-answer":o}},true);if(!!a){n=parseInt(i[r]["ANSWERS"][o]["PERCENT"]);n=isNaN(n)?0:n;u=e.findChild(a,{attribute:{"data-bx-vote-result":"counter"}},true);e.adjust(u,{html:i[r]["ANSWERS"][o]["COUNTER"]+""});delete u["VOTED_USER_OBJ"];e.adjust(e.findChild(a,{tagName:"SPAN",attribute:{"data-bx-vote-result":"percent"}},true),{html:n+"%"});e.adjust(e.findChild(a,{tagName:"DIV",attribute:{"data-bx-vote-result":"bar"}},true),{style:{width:n+"%"}})}}}}}}u=e.findChild(this.node,{tagName:"DIV",attribute:{"data-bx-vote-result":"counter"}},true);e.adjust(u,{html:t["COUNTER"]+""});e.onCustomEvent(this.controller,"OnAfterChangeData")},checkUsers:function(t){var i=t?e(t.currentTarget):null;if(i.hasAttribute("data-bx-vote-answer")){if(!i["VOTED_USER_OBJ"]){i.VOTED_USER_OBJ=new s(i.getAttribute("data-bx-vote-answer"),i,{nameTemplate:this.params["nameTemplate"],urlTemplate:this.params["urlTemplate"],attachId:this.id})}i.VOTED_USER_OBJ.click()}},checkMobileUsers:function(t){if(this.node&&this.node.getAttribute("data-bx-vote-form")!=="shown"){var i=e.proxy_context,s=e.findChild(i,{tagName:"A",attribute:{"data-bx-vote-result":"counter"}},true);if(s&&parseInt(s.innerHTML)>0){e.PreventDefault(t);app.openBXTable({url:e.util.add_url_param(this.url,{action:"getMobileVoted",attachId:this.id,answerId:i.getAttribute("data-bx-vote-answer"),sessid:e.bitrix_sessid()}),TABLE_SETTINGS:{markmode:false,cache:false}});return false}}return true},showError:function(t){var i="";if(e.type.isArray(t)){var s=[];for(var a=0;a<t.length;a++){s.push(t[a]["message"])}s=s.join("<br />");i=s===""?"Unknown error":s;this.errorNode.innerHTML=i;this.node.setAttribute("data-bx-vote-error","shown")}else{this.errorNode.innerHTML="";this.node.setAttribute("data-bx-vote-error","hidden")}}};return a}();var s=function(){var t=function(t,e,i){this.id=["vote",t,(new Date).getTime()].join("-");this.answerId=t;this.node=e;this.status="ready";this.iNumPage=0;this.urlTemplate=i["urlTemplate"];this.nameTemplate=i["nameTemplate"];this.attachId=i["attachId"];this.data=[];this.queue=[];this.popup=null;this.popupScrollCheck=this.popupScrollCheck.bind(this)};t.prototype={url:i,click:function(){var t=parseInt(this.node.innerHTML);if(t>0){this.showPopup().then((()=>{if(this.data.length>0){this.buildVoters(this.data)}}))}},buildVoters:function(t){var i=this.popup?this.popup.getPopupContainer():null;if(i===null){return}var s=i.querySelector(".bx-ilike-popup");i.querySelector(".bx-ilike-wrap-block").removeAttribute("style");var a=false;t.forEach((t=>{var i=e.util.htmlspecialchars(t["ID"]);var o=e.util.htmlspecialchars(t["FULL_NAME"]);var r=e.type.isNotEmptyString(t["PHOTO_SRC"])?encodeURI(e.util.htmlspecialchars(t["PHOTO_SRC"])):null;var n=e.type.isNotEmptyString(t["TYPE"])?e.util.htmlspecialchars(t["TYPE"]):null;var u=["a",this.answerId,"u",i].join("");if(s.querySelector("a#"+u)===null){var l=['<span class="bx-ilike-popup-avatar-new">','<img src="',r??"/bitrix/images/main/blank.gif",'" class="bx-ilike-popup-avatar-img',r?"":" bx-ilike-popup-avatar-img-default",'" />','<span class="bx-ilike-popup-avatar-status-icon"></span>',"</span>",'<span class="bx-ilike-popup-name-new">',o,"</span>"].join("");s.appendChild(e.create(t["ID"]!=="HIDDEN"&&this.urlTemplate?"A":"SPAN",{attrs:{id:u},props:{href:this.urlTemplate.replace(/#(USER_ID|ID)#/i,i),target:"_blank",className:"bx-ilike-popup-img"+(n?" bx-ilike-popup-img-"+n:"")},html:l}))}a=true}));if(a){this.popup.adjustPosition({forceBindPosition:true});this.popupScrollCheck({currentTarget:s})}},makeError:function(t){var i=this.popup?this.popup.getPopupContainer():null;if(i===null){return}var s=(t||[{message:e.message("VOTE_ERROR_DEFAULT")}]).map((t=>t.message)).join("");i.innerHTML='<div class="bx-vote-popup-error-block">'+s+"</div>";this.popup.adjustPosition({forceBindPosition:true})},showPopup:function(){return new Promise((t=>{var e=this.getPopup();e.show();e.setAngle({position:"bottom"});e.adjustPosition({forceBindPosition:true});t(e)}))},getPopup:function(){if(this.popup){return this.popup}this.popup=new e.PopupWindow("bx-vote-popup-cont-"+this.id,this.node,{lightShadow:true,offsetTop:-2,offsetLeft:3,autoHide:true,closeByEsc:true,cacheable:false,bindOptions:{position:"top"},content:['<span class="bx-ilike-wrap-block" style="display: none;">'+'<span class="bx-ilike-popup"><span class="bx-ilike-bottom_scroll"></span></span>'+"</span>",'<span class="bx-ilike-wait"></span>'].join(""),events:{onFirstShow:()=>{this.send();e.bind(this.popup.contentContainer.querySelector(".bx-ilike-popup"),"scroll",this.popupScrollCheck)},onClose:()=>{this.popup=null}}});return this.popup},popupScrollCheck:function(){var t=this.popup?this.popup.contentContainer:null;if(t===null){return}var e=t.querySelector(".bx-ilike-popup");if(e.scrollTop>(e.scrollHeight-e.offsetHeight)/1.5||t.offsetHeight>e.offsetHeight){this.send()}},send:function(){if(this.status!=="ready"){if(this.status==="busy"){this.queue.push(this.send.bind(this))}else if(this.status==="done"){this.finalize()}return}this.status="busy";e.ajax({url:e.util.add_url_param(this.url,{action:"getVoted",attachId:this.attachId,answerId:this.answerId}),method:"POST",dataType:"json",data:{iNumPage:++this.iNumPage,nameTemplate:this.nameTemplate,sessid:e.bitrix_sessid()},onsuccess:function(t){if(t&&t.status==="success"){t=t.data;this.buildVoters(t.items);this.data=this.data.concat(t.items);if(t["statusPage"]==="done"||t.items.length<=0){this.status="done";this.finalize()}else{this.status="ready";var e=this.queue.shift();if(e){e.call(this)}}}else{this.status="error";this.makeError(t.errors);this.finalize()}}.bind(this),onfailure:function(){this.status="error";this.makeError();this.finalize()}.bind(this)})},finalize:function(){this.queue=[];var t=this.popup?this.popup.getPopupContainer():null;if(t===null){return}t.querySelector(".bx-ilike-wait").style.display="none";e.unbind(t.querySelector(".bx-ilike-popup"),"scroll",this.popupScrollCheck)}};return t}()})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/voting.vote.edit/templates/.default/script.min.js?169761763612569";s:6:"source";s:71:"/bitrix/components/bitrix/voting.vote.edit/templates/.default/script.js";s:3:"min";s:75:"/bitrix/components/bitrix/voting.vote.edit/templates/.default/script.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/voting.vote.edit/templates/.default/script.map.js";}"*/
(function(){if(window.BVoteConstructor)return;BX.addCustomEvent("onClickMulti",(function(t){var e=BX.findChildren(t.parentNode.previousSibling,{attribute:{"data-bx-answer-field":"field-type"}},true);for(var i=0;i<e.length;i++){e[i].value=t.checked?"1":"0"}}));var t=function(t){this.map=new Map;this.maxSort=0;this.currentId=0;t=t||{};this.maxCount=parseInt(t["maxCount"]||0);this.onEntityHasBeenDeleted=this.onEntityHasBeenDeleted.bind(this)};t.prototype={set:function(t,e){this.map.set(t,e);BX.addCustomEvent(e,"onEntityHasBeenDeleted",this.onEntityHasBeenDeleted);this.maxSort=Math.max(this.maxSort,e.getSort());this.currentId++},get:function(t){return this.map.get(t)},keys:function(){return this.map.keys()},delete:function(t){return this.map.delete(t)},onEntityHasBeenDeleted:function(t,e,i){this.delete(t);if(this.maxSort===parseInt(e)){var s=0;this.map.forEach((function(t){s=Math.max(s,parseInt(t.getSort()))}));this.maxSort=s}},getNextId:function(){return this.currentId},getMaxSort:function(){return this.maxSort},canAdd:function(){return!(this.maxCount>0&&this.maxCount<=this.map.size)}};var e=function(t,i){this.id=[i["groupId"]||"vote",t.getAttribute("data-bx-number").toString()];this.eventObject=i["eventObject"];this.nodes={main:t,sort:null};this.delete=this.delete.bind(this);this.__sortDD=this.__sortDD.bind(this);this.onbxdragstart=this.onbxdragstart.bind(this);this.onbxdragstop=this.onbxdragstop.bind(this);this.onbxdrag=this.onbxdrag.bind(this);this.onbxdraghout=this.onbxdraghout.bind(this);this.onbxdestdraghover=this.onbxdestdraghover.bind(this);this.onbxdestdraghout=this.onbxdestdraghout.bind(this);this.onbxdestdragfinish=this.onbxdestdragfinish.bind(this);BX.addCustomEvent(this.eventObject,"onEntityHasBeenSorted",this.__sortDD);this.init(i);e.repo.set(this.id,this)};e.repo=new Map;e.getByFullId=function(t){return e.repo.get(t)};e.deleteByFullId=function(t){return e.repo.delete(t)};e.prototype={init:function(t){},bind:function(t){var e,i,s;if(BX(t)){e=BX.findChildren(t,{attribute:"data-bx-action"},true);if(t.hasAttribute("data-bx-action")){e.unshift(t)}}else{e=BX.findChildren(this.nodes.main,{attribute:"data-bx-action"},true)}for(i=0;i<e.length;i++){if(!e[i].hasAttribute("data-bx-bo und")){s="__"+e[i].getAttribute("data-bx-action");if(typeof this[s]==="function"){e[i].setAttribute("data-bx-bound","Y");BX.bind(e[i],"click",this[s].bind(this))}}}this.nodes.main["entityId"]=this.getFullId()},initDD:function(){if(window["jsDD"]&&!this.nodes.main.hasAttribute("data-bx-drag-sensitive")){var t=BX.findChildren(this.nodes.main,{attribute:"data-bx-action"},true),e;for(e=0;e<t.length;e++){if(t[e].getAttribute("data-bx-action")==="sortDD"&&!t[e].hasAttribute("data-bx-bound-dd")&&t[e].getAttribute("data-bx-bound")==="Y"){BX.unbindAll(t[e],"click");this.nodes.dd=t[e];this.nodes.dd.setAttribute("data-bx-bound-dd","Y");this.nodes.dd["entityId"]=this.getFullId();BX.addClass(this.nodes.dd,"bx-drag-draggable");this.nodes.main.hasAttribute("data-bx-drag-sensitive","Y");BX.addClass(this.nodes.main,"bx-drag-drag-sensitive");window.jsDD.registerObject(this.nodes.dd);this.nodes.dd.onbxdragstart=this.onbxdragstart;this.nodes.dd.onbxdragstop=this.onbxdragstop;this.nodes.dd.onbxdrag=this.onbxdrag;this.nodes.dd.onbxdraghout=this.onbxdraghout;window.jsDD.registerDest(this.nodes.main);this.nodes.main.onbxdestdraghover=this.onbxdestdraghover;this.nodes.main.onbxdestdraghout=this.onbxdestdraghout;this.nodes.main.onbxdestdragfinish=this.onbxdestdragfinish;var i=BX.findChild(this.nodes.main,{tagName:"INPUT",props:{type:"text"}},true,true);for(e=0;e<=i.length;e++){BX.bind(i[e],"mousedown",BX.eventCancelBubble)}}}}},getSort:function(){if(!this.__sort)this.__sort=parseInt(this.nodes["sort"].value);return this.__sort},setSort:function(t){this.__sort=this.nodes["sort"].value=parseInt(t)},__sortDD:function(t,e,i,s){if(BX.type.isInteger(t)&&i.getGroupId()===this.getGroupId()){if(this===i){this.setSort(e)}else if(t>e){if(e<=this.getSort()&&this.getSort()<=t){this.setSort(this.getSort()+10)}}else if(t<e){if(t<this.getSort()&&this.getSort()<=e){this.setSort(this.getSort()-10)}}}},__sortDown:function(){if(this.nodes.main.nextSibling&&this.nodes.main.nextSibling["entityId"]){var t=e.getByFullId(this.nodes.main.nextSibling["entityId"]);this.nodes.main.parentNode.insertBefore(this.nodes.main.nextSibling,this.nodes.main);BX.onCustomEvent(this.eventObject,"onEntityHasBeenSorted",[this.getSort(),t.getSort(),this,t])}},__sortUp:function(){if(this.nodes.main.previousSibling&&this.nodes.main.previousSibling["entityId"]){var t=e.getByFullId(this.nodes.main.previousSibling["entityId"]);this.nodes.main.parentNode.insertBefore(this.nodes.main,this.nodes.main.previousSibling);BX.onCustomEvent(this.eventObject,"onEntityHasBeenSorted",[this.getSort(),t.getSort(),this,t])}},getFullId:function(t){return t===true?this.id.join("_"):this.id},getId:function(){return this.id[1]},getGroupId:function(){return this.id[0]},delete:function(){var t=[],i,s=this.getSort();for(i in this.nodes){if(this.nodes.hasOwnProperty(i)){t.push(i)}}for(i=0;i<=t.length;i++){if(this.nodes.hasOwnProperty(t[i])){this.nodes[t[i]]=null;delete this.nodes[t[i]]}}e.deleteByFullId(this.getFullId());BX.onCustomEvent(this,"onEntityHasBeenDeleted",[this.getFullId(),s,this])},onbxdragstart:function(){var t=BX.create("DIV",{attrs:{className:"bx-drag-object"},style:{position:"absolute",zIndex:10,width:this.nodes.main.parentNode.clientWidth+"px"},html:this.nodes.main.outerHTML.replace(new RegExp(this.nodes.main.getAttribute("id"),"gi"),"DragCopy")});this.nodes.drag=t;this.nodes.dd["entitySort"]=this.getSort();this.dragPos={main:BX.pos(this.nodes.main),parent:BX.pos(this.nodes.main.parentNode)};document.body.appendChild(this.nodes.drag);BX.addClass(this.nodes.main,"bx-drag-source");t=null},onbxdragstop:function(){if(this.dragPos){BX.removeClass(this.nodes.main,"bx-drag-source");this.nodes.drag.parentNode.removeChild(this.nodes.drag);this.nodes.drag=null;delete this.nodes.drag;delete this.dragPos}return true},onbxdrag:function(t,e){if(this.nodes.drag){if(this.dragPos){if(!this.dragPos.main.deltaX)this.dragPos.main.deltaX=this.dragPos.main.left-t;if(!this.dragPos.main.deltaY)this.dragPos.main.deltaY=this.dragPos.main.top-e;t+=this.dragPos.main.deltaX;e+=this.dragPos.main.deltaY;e=Math.min(Math.max(e,this.dragPos.parent.top),this.dragPos.parent.bottom)}this.nodes.drag.style.left=t+"px";this.nodes.drag.style.top=e+"px"}},onbxdraghout:function(){},onbxdestdraghover:function(t){if(this.nodes.dd!==t){var e=parseInt(t["entitySort"]);if(this.getSort()<e)BX.addClass(this.nodes.main,"bx-drag-over-up");else BX.addClass(this.nodes.main,"bx-drag-over-down")}},onbxdestdraghout:function(){BX.removeClass(this.nodes.main,"bx-drag-over-up");BX.removeClass(this.nodes.main,"bx-drag-over-down")},onbxdestdragfinish:function(t){BX.removeClass(this.nodes.main,"bx-drag-over-up");BX.removeClass(this.nodes.main,"bx-drag-over-down");if(this.nodes.dd!==t){var i=e.getByFullId(t["entityId"]);if(i.getGroupId()===this.getGroupId()){var s=parseInt(t["entitySort"]);if(this.getSort()<s){this.nodes.main.parentNode.insertBefore(i.nodes.main,this.nodes.main);BX.onCustomEvent(this.eventObject,"onEntityHasBeenSorted",[i.getSort(),this.getSort(),i,this])}else{if(this.nodes.main.nextSibling)this.nodes.main.parentNode.insertBefore(i.nodes.main,this.nodes.main.nextSibling);else this.nodes.main.parentNode.appendChild(i.nodes.main);BX.onCustomEvent(this.eventObject,"onEntityHasBeenSorted",[i.getSort(),this.getSort(),i,this])}}}}};var i=function(e,s){this.answers=new t({maxCount:s["maxAnswersCount"]});this.visibleId=0;i.superclass.constructor.apply(this,arguments);this.nodes.sort=BX.findChild(this.nodes["main"],{attribute:{"data-bx-question-field":"C_SORT"}},true)};BX.extend(i,e);i.prototype.init=function(t){this.nodes.answerList=BX.findChild(this.nodes.main,{attribute:{"data-bx-role":"answer-list"}},true);var e=BX.findChild(this.nodes.answerList,{tagName:"LI",attribute:{"data-bx-role":"answer"}},false,true),i,n;for(i=0;i<e.length;i++){n=new s(e[i],{eventObject:t["eventObject"],groupId:this.getId()});this.answers.set(n.getId(),n);this.visibleId++}this.bind();this.initDD();this.addAnswer=this.addAnswer.bind(this);this.toggleAddNode=this.toggleAddNode.bind(this);this.toggleAddNode(null,null);BX.addCustomEvent(this.eventObject,"onAnswerHasBeenAdded",this.toggleAddNode);BX.addCustomEvent(this.eventObject,"onAnswerHasBeenDeleted",this.toggleAddNode)};i.prototype.toggleAddNode=function(t,e){if(e===null||e.getGroupId()===this.getId()){var i=BX.findChild(this.nodes["main"],{attribute:{"data-bx-action":"adda"}},true,true),s;for(s=0;s<i.length;s++){BX.unbind(i[s],"focus",this.addAnswer)}if(this.answers.canAdd()){BX.bind(i[i.length-1],"focus",this.addAnswer)}}};i.prototype.addAnswer=function(){var t=this.answers.getNextId(),e={"#Q#":this.getId(),"#A#":t,"#A_FIELD_TYPE#":BX("multi_"+this.getId())&&BX("multi_"+this.getId()).checked?"1":"0","#A_VALUE#":"","#A_C_SORT#":this.answers.getMaxSort()+10,"#A_PH#":++this.visibleId},i=BX.message("VOTE_TEMPLATE_ANSWER"),n;for(n in e){if(e.hasOwnProperty(n)){i=i.replace(new RegExp(n,"gi"),e[n])}}var d=BX.create("DIV",{html:i}).firstChild;this.nodes.answerList.appendChild(d);var o=new s(d,{eventObject:this.eventObject,groupId:this.getId()});this.bind(d);this.initDD(d);this.answers.set(o.getId(),o);BX.onCustomEvent(this.eventObject,"onAnswerHasBeenAdded",[o.getFullId(),o])};i.prototype.__delq=function(){var t=BX.findChild(this.nodes.main,{attribute:{"data-bx-question-field":"MESSAGE"}},true);if(!t||t.value===""||confirm(BX.message("VVE_QUESTION_DELETE"))){var e=this.answers.keys(),i=e.next();t=this.nodes.main;while(!i.done){this.answers.get(i.value).delete();i=e.next()}this.delete();t.parentNode.removeChild(t);BX.onCustomEvent(this.eventObject,"onQuestionHasBeenDeleted",[this.getFullId(),this])}};var s=function(t,e){s.superclass.constructor.apply(this,arguments);this.nodes.sort=BX.findChild(this.nodes["main"],{attribute:{"data-bx-answer-field":"C_SORT"}},true)};BX.extend(s,e);s.prototype.init=function(t){this.bind();this.initDD(this.nodes.main)};s.prototype.__dela=function(t){var e=BX.findChild(this.nodes.main,{attribute:{"data-bx-answer-field":"MESSAGE"}},true),i;if(!e||e.value===""||confirm(BX.message("VVE_ANS_DELETE"))){e=this.nodes.main;this.delete();e.parentNode.removeChild(e);BX.onCustomEvent(this.eventObject,"onAnswerHasBeenDeleted",[this.getFullId(),this])}};top.BVoteConstructor=window.BVoteConstructor=function(e){this.controller=e.controller;this.questions=new t({maxCount:e["maxQ"]});this.nodes={questionList:BX.findChild(this.controller,{attribute:{"data-bx-role":"question-list"}},true),action:BX.findChild(this.controller,{attribute:{"data-bx-action":"addq"}},true)};this.toggleAddNode=this.toggleAddNode.bind(this);this.visibleId=0;this.maxAnswersCount=e["maxA"];this.init(e)};window.BVoteConstructor.prototype.init=function(){var t=BX.findChild(this.controller,{tagName:"LI",attribute:{"data-bx-role":"question"}},true,true),e,s;for(e=0;e<t.length;e++){s=new i(t[e],{eventObject:this,maxAnswersCount:this.maxAnswersCount});this.questions.set(s.getId(),s)}this.toggleAddNode();BX.addCustomEvent(this,"onQuestionHasBeenAdded",this.toggleAddNode);BX.addCustomEvent(this,"onQuestionHasBeenDeleted",this.toggleAddNode);BX.bind(this.nodes.action,"click",this.addq.bind(this))};window.BVoteConstructor.prototype.toggleAddNode=function(){if(!this.questions.canAdd()){this.nodes.action.style.display="none"}else if(this.nodes.action.style.display==="none"){delete this.nodes.action.style.display}};window.BVoteConstructor.prototype.addq=function(t){BX.PreventDefault(t);if(this.questions.canAdd()){var e=BX.message("VOTE_TEMPLATE_ANSWER").replace(/#A#/gi,0).replace(/#A_PH#/gi,1).replace(/#A_FIELD_TYPE#/gi,"0").replace(/#A_C_SORT#/gi,"10").replace(/#A_VALUE#/gi,"")+BX.message("VOTE_TEMPLATE_ANSWER").replace(/#A#/gi,1).replace(/#A_PH#/gi,2).replace(/#A_FIELD_TYPE#/gi,"0").replace(/#A_C_SORT#/gi,"20").replace(/#A_VALUE#/gi,"");e=BX.create("DIV",{html:BX.message("VOTE_TEMPLATE_QUESTION").replace(/#ANSWERS#/gi,e).replace(/#Q#/gi,this.questions.getNextId()).replace(/#Q_C_SORT#/gi,this.questions.getMaxSort()+10).replace(/#Q_PH#/gi,++this.visibleId).replace(/#Q_VALUE#/gi,"").replace(/#Q_MULTY#/gi,"")});var s=new i(e.firstChild,{eventObject:this,maxAnswersCount:this.maxAnswersCount});s.visibleId=2;this.questions.set(s.getId(),s);this.nodes.questionList.appendChild(e.firstChild);BX.onCustomEvent(this,"onQuestionHasBeenAdded",[s.getFullId(),s])}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:99:"/bitrix/components/bitrix/socialnetwork.log.filter/templates/.default/script.min.js?169761761211024";s:6:"source";s:79:"/bitrix/components/bitrix/socialnetwork.log.filter/templates/.default/script.js";s:3:"min";s:83:"/bitrix/components/bitrix/socialnetwork.log.filter/templates/.default/script.min.js";s:3:"map";s:83:"/bitrix/components/bitrix/socialnetwork.log.filter/templates/.default/script.map.js";}"*/
__logOnDateChange=function(e){var t=false,n=false,i=false,a=false;if(e.value=="interval")t=n=i=true;else if(e.value=="before")n=true;else if(e.value=="after"||e.value=="exact")t=true;else if(e.value=="days")a=true;BX("flt_date_from_span").style.display=t?"":"none";BX("flt_date_to_span").style.display=n?"":"none";BX("flt_date_hellip_span").style.display=i?"":"none";BX("flt_date_day_span").style.display=a?"inline-block":"none";BX("flt_date_day_text_span").style.display=a?"inline-block":"none"};function __logOnReload(e){if(BX("menu-popup-lenta-sort-popup")){var t=BX.findChildren(BX("menu-popup-lenta-sort-popup"),{className:"lenta-sort-item"},true);if(!BX.hasClass(t[0],"lenta-sort-item-selected")){for(var n=0;n<t.length;n++){if(n==0)BX.addClass(t[n],"lenta-sort-item-selected");else if(n!=t.length-1)BX.removeClass(t[n],"lenta-sort-item-selected")}}}if(BX("lenta-sort-button")){var i=BX.findChild(BX("lenta-sort-button"),{className:"lenta-sort-button-text-internal"},true,false);if(i)i.innerHTML=BX.message("sonetLFAllMessages")}var a=BX("sonet_log_counter_preset",true);if(a){if(parseInt(e)>0){a.style.display="inline-block";a.innerHTML=e}else{a.innerHTML="";a.style.display="none"}}}BitrixLFFilter=function(){this.id=null;this.filterPopup=false;this.currentName=null;this.obInputName={};this.obSearchInput={};this.obInputContainerName={};this.obContainerInput={};this.popupMenu=null;this.menuItems=[];this.actualSearchString="";this.minSearchStringLength=2};BitrixLFFilter.prototype.initLentaMenu=function(e){if(typeof e.menuItems!="undefined"){this.menuItems=e.menuItems}};BitrixLFFilter.prototype.showLentaMenu=function(e){var t=typeof e.short!="undefined"&&e.short,n=typeof e.bindElement!="undefined"?BX(e.bindElement):null;if(!n){return false}if(typeof e.siteTemplateId=="undefined"||e.siteTemplateId!="bitrix24"){BX.addClass(n,"lenta-sort-button-active")}const i=BX.util.array_merge(!t?BX.util.array_merge(this.menuItems.preset,this.menuItems.filter):[],this.menuItems.actions);if(!BX.Type.isArrayFilled(i)){return false}this.popupMenu=BX.PopupMenu.create("lenta-sort-popup",n,i,{offsetTop:e.siteTemplateId=="bitrix24"?-5:2,offsetLeft:e.siteTemplateId=="bitrix24"?17:43,angle:true,events:{onPopupClose:function(){if(typeof e.siteTemplateId!="undefined"||e.siteTemplateId!="bitrix24"){BX.removeClass(n,"lenta-sort-button-active")}}}});this.popupMenu.show();return false};BitrixLFFilter.prototype.initFilter=function(e){var t=typeof e!="undefined"&&typeof e.version!="undefined"?parseInt(e.version):0;var n=typeof e!="undefined"&&typeof e.filterId!="undefined"?e.filterId:"LIVEFEED";this.id=n;if(t>=2){if(typeof e!="undefined"&&typeof e.minSearchStringLength!="undefined"&&parseInt(e.minSearchStringLength)>0){this.minSearchStringLength=parseInt(e.minSearchStringLength)}var i=BX.Main.filterManager.getById(n);if(i&&(i.getSearch().getSquares().length>0||i.getSearch().getSearchString().length>0)){var a=BX.findParent(BX(n+"_filter_container"),{className:"pagetitle-wrap"});if(a){BX.addClass(a,"pagetitle-wrap-filter-opened")}}BX.addCustomEvent("BX.Livefeed:refresh",BX.delegate((function(){var e=BX.Main.filterManager.getById(n);if(e){e.getPreset().resetPreset(true);e.getSearch().clearForm()}}),this));BX.addCustomEvent("BX.Main.Filter:beforeApply",BX.delegate((function(e,t,i,a){if(e!=n||this.actualSearchString.length>0&&this.actualSearchString.length<this.minSearchStringLength){return}BX.onCustomEvent(window,"BX.Livefeed.Filter:beforeApply",[t,a])}),this));BX.addCustomEvent("BX.Main.Filter:apply",BX.delegate((function(e,t,i,a,o){if(e!=n||this.actualSearchString.length>0&&this.actualSearchString.length<this.minSearchStringLength){return}BX.onCustomEvent(window,"BX.Livefeed.Filter:apply",[t,a,o])}),this));BX.addCustomEvent("BX.Filter.Search:input",BX.delegate((function(e,t){if(e==n){this.actualSearchString=typeof t!="undefined"?BX.util.trim(t):"";if(this.actualSearchString.length>0&&this.actualSearchString.length>=this.minSearchStringLength){BX.onCustomEvent(window,"BX.Livefeed.Filter:searchInput",[t])}}}),this));BX.addCustomEvent("BX.Main.Filter:blur",BX.delegate((function(e){if(e.getParam("FILTER_ID")==n&&e.getSearch().getSquares().length<=0&&e.getSearch().getSearchString().length<=0){var t=BX.findParent(BX(n+"_filter_container"),{className:"pagetitle-wrap"});if(t){BX.removeClass(t,"pagetitle-wrap-filter-opened")}}})));if(BX(this.id+"_filter_container")){var o=BX.delegate((function(e){var t=BX.findParent(e.target,{className:"pagetitle-wrap"});if(t&&!BX.hasClass(t,"pagetitle-wrap-filter-opened")){BX.addClass(t,"pagetitle-wrap-filter-opened")}}),this);BX.bind(BX(this.id+"_search_container"),"click",o)}}else{__logOnDateChange(document.forms["log_filter"].flt_date_datesel);BX("flt_date_from_span").onclick=function(){BX.calendar({node:this,field:BX("flt_date_from"),bTime:false})};BX("flt_date_to_span").onclick=function(){BX.calendar({node:this,field:BX("flt_date_to"),bTime:false})}}};BitrixLFFilter.prototype.initDestination=function(e){this.obInputName[e.name]=e.inputName;this.obSearchInput[e.name]=BX(e.inputName);this.obInputContainerName[e.name]=e.inputContainerName;this.obContainerInput[e.name]=BX(e.inputContainerName);if(typeof e.items!="undefined"&&typeof e.items.department!="undefined"){if(typeof e.items.extranetRoot!="undefined"){for(var t in e.items.extranetRoot){if(e.items.extranetRoot.hasOwnProperty(t)){e.items.department[t]=e.items.extranetRoot[t]}}}if(!e.items.departmentRelation){e.items.departmentRelation=BX.SocNetLogDestination.buildDepartmentRelation(e.items.department)}}BX.SocNetLogDestination.init({name:e.name,pathToAjax:typeof e.pathToAjax!="undefined"?e.pathToAjax:false,searchInput:this.obSearchInput[e.name],extranetUser:!!e.extranetUser,departmentSelectDisable:!!e.departmentSelectDisable,bindMainPopup:{node:e.bindNode,offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:e.bindNode,offsetTop:"5px",offsetLeft:"15px"},callback:{select:BX.proxy(this.onSelectDestination,{name:e.name,containerInput:BX(e.inputContainerName),inputContainerName:e.inputContainerName,inputName:e.inputName,searchInput:BX(e.inputName),resultFieldName:e.resultFieldName}),unSelect:BX.proxy(this.onUnSelectDestination,{name:e.name,inputContainerName:e.inputContainerName,inputName:e.inputName,searchInput:BX(e.inputName)})},items:e.items,itemsLast:e.itemsLast,itemsSelected:e.itemsSelected,itemsSelectedUndeleted:typeof e.itemsSelectedUndeleted!="undefined"?e.itemsSelectedUndeleted:{},isCrmFeed:false,useClientDatabase:true,destSort:e.destSort,allowAddUser:false,allowSearchEmailUsers:!e.extranetUser,userNameTemplate:e.userNameTemplate});BX.bind(this.obSearchInput[e.name],"click",(function(t){oLFFilter.currentName=e.name;BX.SocNetLogDestination.openDialog(e.name);return BX.PreventDefault(t)}));BX.bind(this.obSearchInput[e.name],"keyup",BX.delegate(BX.SocNetLogDestination.BXfpSearch,{formName:e.name,inputName:oLFFilter.obInputName[e.name]}));BX.bind(this.obSearchInput[e.name],"keydown",BX.delegate(BX.SocNetLogDestination.BXfpSearchBefore,{formName:e.name,inputName:oLFFilter.obInputName[e.name]}))};BitrixLFFilter.prototype.clearInput=function(){if(this.obContainerInput[this.currentName]){var e=BX.findChildren(this.obContainerInput[this.currentName],{className:"feed-add-post-destination"},false);for(var t=0;t<e.length;t++){BX.SocNetLogDestination.deleteItem(e[t].attributes["data-id"].value,e[t].attributes["data-type"].value,this.currentName)}}};BitrixLFFilter.prototype.onSelectDestination=function(e,t,n,i){oLFFilter.clearInput();BX.SocNetLogDestination.BXfpSelectCallback({formName:this.name,item:e,type:t,search:n,bUndeleted:i,containerInput:this.containerInput,valueInput:this.searchInput,varName:this.resultFieldName});this.searchInput.style.display="none";if(this.name=="feed-filter-created-by"&&BX("flt_comments_cont")){BX("flt_comments_cont").style.display="block"}BX.SocNetLogDestination.closeDialog();BX.SocNetLogDestination.closeSearch()};BitrixLFFilter.prototype.onUnSelectDestination=function(e){var t=BX.findChildren(BX(this.inputContainerName),{attribute:{"data-id":""+e.id+""}},true);if(t!==null){for(var n=0;n<t.length;n++){BX.remove(t[n])}}BX(this.inputName).value="";this.searchInput.style.display="inline-block";if(this.name=="feed-filter-created-by"&&BX("flt_comments_cont")){BX("flt_comments_cont").style.display="none"}};BitrixLFFilter.prototype.ShowFilterPopup=function(e){if(!oLFFilter.filterPopup){BX.ajax.get(BX.message("sonetLFAjaxPath"),(function(t){BX.closeWait(e);oLFFilter.filterPopup=new BX.PopupWindow("bx_log_filter_popup",e,{closeIcon:false,offsetTop:5,autoHide:true,zIndex:-100,className:"sonet-log-filter-popup-window",events:{onPopupClose:function(){if(!BX.hasClass(this.bindElement,"pagetitle-menu-filter-set"))BX.removeClass(this.bindElement,"pagetitle-menu-filter-selected")},onPopupShow:function(){BX.addClass(this.bindElement,"pagetitle-menu-filter-selected")}}});var n=BX.create("DIV",{html:BX.util.trim(t)});oLFFilter.filterPopup.setContent(n.firstChild);oLFFilter.filterPopup.show()}))}else{oLFFilter.filterPopup.show()}};BitrixLFFilter.prototype.__SLFShowInfoPopup=function(e){var t=[BX.create("BUTTON",{props:{className:"ui-btn ui-btn-md ui-btn-success"},text:BX.message("sonetLFDialogRead"),events:{click:function(){BX.ajax({method:"POST",dataType:"json",url:BX.message("ajaxControllerURL"),data:{sessid:BX.bitrix_sessid(),popupType:e.type,closePopup:"Y"},onsuccess:function(t){if(typeof t!="undefined"&&typeof t.SUCCESS!="undefined"&&t.SUCCESS=="Y"){a.close();if(e.reload){top.location=top.location.href}}}})}}})];if(BX.type.isArray(e.buttonsAdd)){var n=0;for(var i=0;i<e.buttonsAdd.length;i++){n=e.buttonsAdd[i];t.push(BX.create("BUTTON",{props:{className:"ui-btn ui-btn-md ui-btn-"+n.type},text:n.title,events:{click:n.click}}))}}var a=new BX.PopupWindow(e.name,e.bindObj,{closeByEsc:false,closeIcon:false,autoHide:false,overlay:true,events:{},buttons:[],zIndex:0,content:BX.create("DIV",{children:[BX.create("DIV",{props:{className:"bx-slf-popup-title"},text:e.title}),BX.create("DIV",{props:{className:"bx-slf-popup-content"},children:[BX.create("DIV",{props:{className:"bx-slf-popup-cont-title"},html:e.description1}),BX.create("DIV",{props:{className:"bx-slf-popup-descript"},children:[BX.type.isNotEmptyString(e.description2)?BX.create("DIV",{html:e.description2}):null,BX.type.isPlainObject(e.descriptionImage)&&BX.type.isNotEmptyString(e.descriptionImage.src)?BX.create("IMG",{props:{className:"bx-slf-popup-descript-img"},attrs:{src:e.descriptionImage.src,width:e.descriptionImage.width,height:e.descriptionImage.height}}):null]})]}),BX.create("DIV",{props:{className:"popup-window-buttons"},children:t})]})});a.show();return a};BitrixLFFilter.prototype.onClickMenuItem=function(e){if(typeof e.menuItem!="undefined"){BX.toggleClass(e.menuItem,"lenta-sort-item-selected")}this.popupMenu.close();if(typeof e.href!="undefined"){top.location.href=e.href}};BitrixLFFilter.prototype.closeHint=function(e){};oLFFilter=new BitrixLFFilter;window.oLFFilter=oLFFilter;
/* End */
;; /* /bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?16976176062527*/
; /* /bitrix/components/bitrix/socialnetwork.log.ex/templates/.default/script.min.js?16976176072044*/
; /* /bitrix/components/bitrix/socialnetwork.log.entry/templates/.default/scripts.min.js?16976176069164*/
; /* /bitrix/components/bitrix/socialnetwork.blog.post.edit/templates/.default/script.min.js?169761760650105*/
; /* /bitrix/components/bitrix/main.post.form/templates/.default/script.min.js?169761435670830*/
; /* /bitrix/components/bitrix/main.file.input/templates/drag_n_drop/script.min.js?169761435615242*/
; /* /bitrix/components/bitrix/system.field.edit/script.min.js?1697614356814*/
; /* /bitrix/components/bitrix/search.tags.input/templates/.default/script.js?169761759213020*/
; /* /bitrix/components/bitrix/voting.uf/templates/.default/script.min.js?169761763711231*/
; /* /bitrix/components/bitrix/voting.vote.edit/templates/.default/script.min.js?169761763612569*/
; /* /bitrix/components/bitrix/socialnetwork.log.filter/templates/.default/script.min.js?169761761211024*/
; /* /bitrix/components/bitrix/desktop/script.min.js?169761435611184*/

//# sourceMappingURL=page_live_feed_v2.map.js